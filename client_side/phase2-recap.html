<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>Phase 2: Rank Code Snippets</title>
  <style>
    body {
      font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
      margin: 0 40px 40px 40px; /* top right bottom left */
      background-color: #f4f4f4;
      color: #333;
    }
    .instructions {
      background-color: #fff;
      padding: 20px;
      border-radius: 8px;
      margin-bottom: 20px;
      box-shadow: 0 2px 8px rgba(0,0,0,0.1);
    }
    .ranking-row {
      display: flex;
      gap: 10px;
      overflow-x: auto;
      margin-bottom: 20px;
    }
    .ranking-row-numbers {
      display: flex;
      gap: 10px;
      margin-bottom: 0;
    }
    .ranking-slot {
      flex: 1 1 100px;
      background: #e8f5e9;
      border: 2px dashed #4CAF50;
      border-radius: 6px;
      padding: 10px;
      min-height: 80px;
      text-align: center;
    }

    .ranking-number {
      flex: 1; 
      text-align: center;
      color: #009999;
    }
    .card {
      background: #fff;
      border: 1px solid #ccc;
      border-radius: 6px;
      padding: 8px;
      margin: 5px;
      cursor: grab;
    }
    .card.dragging {
      opacity: 0.5;
    }
    .preview-area {
      display: flex;
      gap: 20px;
      flex-wrap: wrap;
      margin-top: 20px;
    }
    .snippet-preview-box {
      flex: 1 1 45%;
      min-width: 300px;
      border-radius: 8px;
      overflow: hidden;
      box-shadow: 0 2px 8px rgba(0, 0, 0, 0.1);
      background-color: #ffffff;
      border: 1px solid #ddd;
    }
    .snippet-header {
      background-color: #f5f5f5;
      padding: 10px 15px;
      font-weight: bold;
      font-size: 16px;
      border-bottom: 1px solid #ccc;
    }
    .code-box {
      font-family: 'Courier New', Courier, monospace;
      white-space: pre-wrap;
      overflow-x: auto;
      padding: 15px;
      font-size: 14px;
      color: #333;
      background-color: #f9f9f9;
    }
    #theme-toggle {
      background-color: #333;
      color: white;
      border: none;
      padding: 6px 12px;
      border-radius: 5px;
      cursor: pointer;
      margin-bottom: 20px;
    }

    #continueBtn {
        background-color: #4CAF50;
        color: white;
        border: none;
        padding: 12px 24px;
        font-size: 16px;
        border-radius: 6px;
        cursor: pointer;
        box-shadow: 0 0 10px #4CAF50;
      }

      #continueBtn:hover {
      background-color: #45a049;
      animation: glowPulse 1.5s infinite alternate;
    }

    @keyframes glowPulse {
      0% {
        box-shadow: 0 0 10px #4CAF50;
      }
      100% {
        box-shadow: 0 0 20px #4CAF50, 0 0 30px #4CAF50;
      }
    }

    /*.status-bar {
      background-color: #333;
      color: white;
      padding: 10px 20px;
      display: flex;
      justify-content: center;
      gap: 30px;
      margin-top: 0;
      position: static; 
    }*/

.status-bar {
  background-color: #333;
  color: white;
  padding: 10px 20px;
  display: flex;
  justify-content: center;
  gap: 30px;
  position: fixed;
  top: 0;
  left: 0;
  right: 0;
  z-index: 1000;
}

.phase-link {
  color: white;
  text-decoration: none;
  font-weight: bold;
  padding: 8px 12px;
  border-radius: 4px;
  transition: background-color 0.2s;
}

    .phase-link:hover:not(.disabled) {
      background-color: #4CAF50;
    }

    .phase-link.active {
      background-color: #4CAF50;
    }

    .phase-link.disabled {
      pointer-events: none;
      opacity: 0.5;
      cursor: not-allowed;
    }

    /*For snippet cards*/
    #cards {
      display: flex;
      gap: 8px;
      overflow-x: auto;
      padding: 10px 0;
      flex-wrap: nowrap;
    }

    button {
      padding: 10px 20px;
      margin-right: 10px;
      font-size: 16px;
      border: none;
      border-radius: 5px;
      background-color: #4CAF50;
      color: white;
      cursor: pointer;
  }
  button:hover {
      background-color: #45a049;
  }
  button[disabled] {
      background-color: #888;
      cursor: not-allowed;
  }

    /*dark/light mode*/
    /* Light mode preview styles */
  /* === Default (light mode) === */
  .card {
    background-color: #ffffff;
    border-color: #ccc;
    color: #333;
  }

  .snippet-preview-box {
    background-color: #fefefe;
    border: 1px solid #bbb;
  }

  .code-box {
    background-color: #f9f9f9;
    color: #222;
  }

/* === Dark mode overrides === */
  body.dark-mode .card {
    background-color: #2a2a2a;
    border-color: #555;
    color: #ddd;
  }

  body.dark-mode .snippet-preview-box {
    background-color: #1e1e1e;
    border: 1px solid #444;
  }

  body.dark-mode .code-box {
    background-color: #2d2d2d;
    color: #ddd;
  }


    /*code box*/
  /* Basic syntax highlighting classes */
  .keyword     { color: #0000ff; font-weight: bold; }
  .type        { color: #007070; }
  .function    { color: #7928a1; font-weight: bold; }
  .literal     { color: #009999; }
  .string      { color: #a31515; }
  .comment     { color: #6a9955; font-style: italic; }
  .number      { color: #098658; }

    /* Dark mode overrides */
  .dark-mode .keyword  { color: #82aaff; }
  .dark-mode .type     { color: #89ddff; }
  .dark-mode .function { color: #c792ea; }
  .dark-mode .literal  { color: #ffcb6b; }
  .dark-mode .string   { color: #c3e88d; }
  .dark-mode .comment  { color: #7f848e; }
  .dark-mode .number   { color: #f78c6c; }

  html {
  scroll-behavior: smooth;
  }
  a {
    color: #4CAF50;
    text-decoration: none;
  }
  a:hover {
    text-decoration: underline;
  }


</style>
</head>
<body>

<div class="status-bar">
  <div class="user-dropdown" style="position: relative;">
    <div style="padding: 8px 12px; color: gainsboro; font-weight: bold;"><span id="user-info"></span> (<button onclick="logout()" style="color: white; background: none; border: none; cursor: pointer; margin: 0;padding: 0;">üö™ Logout</button>)</div>
  </div>
    <a href="index.html" class="phase-link" id="link-home">üè† Home</a>
    <a href="phase1-recap.html" class="phase-link" id="link-phase1">Phase 1</a>
    <a href="phase2-recap.html" class="phase-link disabled" id="link-phase2">Phase 2</a>
    <a href="phase3-recap.html" class="phase-link disabled" id="link-phase3">Phase 3</a>
    <a href="review.html" class="phase-link disabled" id="link-review">Review & Submit</a>
</div>

<div id="instructions-box" style="background-color: #fff; padding: 20px; border-radius: 8px; margin-bottom: 20px; box-shadow: 0 2px 8px rgba(0,0,0,0.1); margin-top: 80px;">
  <div style="display: flex; justify-content: space-between; align-items: center;">
    <h2 style="margin: 0;">Phase 2: Ranking Code Snippets by Comprehension Difficulty</h2>
    <button onclick="toggleInstructions()" style="padding: 6px 12px; font-size: 14px; border-radius: 5px; background-color: #ddd; border: none; cursor: pointer;">Hide</button>
  </div>

  <div id="instructions-content" style="margin-top: 15px;">
    <p>In this phase, you will rank the 8 code snippets based on how easy or difficult they are to understand.</p>
    <ol>
      <li><strong>Rank the snippets:</strong> Drag and drop each snippet (white) card into the 8 green boxes, which represent ranking positions.</li>
      <li><strong>Understand the scale:</strong>
        <ul>
          <li><strong>Position 1</strong> (leftmost): it should contain the snippets that are easiest to understand.</li>
          <li><strong>Position 8</strong> (rightmost): it should contain the snippets that are easiest to understand.</li>
        </ul>
      </li>
      <li><strong>Equal ranking:</strong> You may place multiple snippets in the same position if they are similarly easy/difficult to understand.</li>
      <li><strong>Empty positions:</strong> it is possible to have empty positions (e.g., when grouping multiple snippets in one position).</li>
      <li><strong>Comparing snippets:</strong> You can compare the code of multiple snippets by clicking their "View" checkboxes, which display the snippets' code.</li>
    </ol>
    <!-- <p><strong>Important:</strong> Please fill the ranking positions from left to right. If you leave any positions empty (e.g., due to grouping multiple snippets in one position), leave the rightmost positions empty.</p> -->
     
          <p><strong>Please complete this phase using your own judgment</strong>. <span style="color:red;"><strong>Do not consult with anyone else or use generative AI tools (ChatGPT, GitHub Copilot, etc.), search engines, or external websites</strong></span>. Your judgment is essential to the validity of our study.</p>
  </div>
</div>


  <div class="ranking-row-numbers" id="rankingRow">
    <p class="ranking-number">Position 1 <span style="color: green;">(easiest)</span></p>
    <p class="ranking-number">Position 2</p>
    <p class="ranking-number">Position 3</p>
    <p class="ranking-number">Position 4</p>
    <p class="ranking-number">Position 5</p>
    <p class="ranking-number">Position 6</p>
    <p class="ranking-number">Position 7</p>
    <p class="ranking-number">Position 8 <span style="color: red;">(hardest)</span></p> 
  </div>
  <div class="ranking-row" id="rankingRow">
    <!-- 8 drop zones -->
    <div class="ranking-slot" data-rank="1"></div>
    <div class="ranking-slot" data-rank="2"></div>
    <div class="ranking-slot" data-rank="3"></div>
    <div class="ranking-slot" data-rank="4"></div>
    <div class="ranking-slot" data-rank="5"></div>
    <div class="ranking-slot" data-rank="6"></div>
    <div class="ranking-slot" data-rank="7"></div>
    <div class="ranking-slot" data-rank="8"></div>
  </div>

  <div id="cards" style="margin-bottom: 20px;"></div>

  <div id="snippet-bar" style="display: flex; justify-content: space-between; align-items: center; padding: 10px 15px; background-color: #f5f5f5; border-radius: 6px; margin-bottom: 15px; box-shadow: 0 1px 3px rgba(0,0,0,0.1);">
    <h3 style="margin: 0; font-size: 16px; color: #333;">
      üîç Snippet Preview & Compare <span style="font-weight: normal;">(click on view checkboxes to preview or compare snippets)</span>
    </h3>
        <button id="theme-toggle" onclick="toggleTheme()" style="padding: 6px 12px; font-size: 14px; border-radius: 5px; background-color: #333; color: white; border: none; cursor: pointer;">
      Switch to Dark Mode
    </button>
  </div>
  
  <div class="phase-section"></div>
  
  <div class="preview-area" id="previewArea"></div>

  <div style="margin-top: 30px;">
    <button id="continueBtn" onclick="goToPhase3()" style="padding: 10px 20px; font-size: 16px; border: none; border-radius: 5px; background-color: gray; color: white; cursor: pointer;">Continue to Phase 3 ‚û°Ô∏è</button>
  </div>

  <div id="validation-modal" style="
  display: none;
  position: fixed;
  top: 30%;
  left: 50%;
  transform: translate(-50%, -50%);
  background-color: #fff0f0;
  color: #660000;
  border: 1px solid #ff9999;
  padding: 20px;
  border-radius: 10px;
  width: 440px;
  box-shadow: 0 4px 16px rgba(0,0,0,0.2);
  z-index: 1002;
  text-align: center;
  font-family: 'Segoe UI', Tahoma, sans-serif;
  ">
    <p id="validation-message" style="font-weight: bold;"></p>
    <button onclick="document.getElementById('validation-modal').style.display = 'none';" style="
      margin-top: 15px;
      padding: 8px 14px;
      background-color: #ff9999;
      color: white;
      border: none;
      border-radius: 5px;
      cursor: pointer;
    ">OK</button>
  </div>


  <script>

const participantRankings = [
    {
      id: 1,
      name: "Nadeeshan",
      html: `<div class="participant-section">
    <h3>Nadeeshan</h3>
    <div class="ranking-labels">
      <div class="ranking-label">1 (easiest)</div>
      <div class="ranking-label">2</div>
      <div class="ranking-label">3</div>
      <div class="ranking-label">4</div>
      <div class="ranking-label">5</div>
      <div class="ranking-label">6</div>
      <div class="ranking-label">7</div>
      <div class="ranking-label">8 (hardest)</div>
    </div>
    <div class="ranking-row">
      <div class="ranking-slot" style="position: relative;">
        <button class="snippet-1" onclick="show_snippet(1)">Snippet 1</button>
        <button class="snippet-2" onclick="show_snippet(2)">Snippet 2</button>
        <div class="reasoning-point" onclick="compare([1], [2])" style="position: absolute; top: -4px; right: 60px;"></div>
        <div class="tooltip-box" style="position: absolute; top: 25px; right: 10px;">
           Because both of them are equally understandable to me. Has similar LOC, clear and simple logical separation.
        </div>
      </div>
  
      <div class="ranking-slot"></div>
  
      <div class="ranking-slot" style="position: relative;">
        <button class="snippet-4" onclick="show_snippet(4)">Snippet 4</button>
        <div class="reasoning-point" onclick="compare([4], [3])" style="top: 50px; right: -12px;"></div>
        <div class="tooltip-box" style="top: 60px; right: -160px;">
          üí° <strong>Reason:</strong><br>
          Snippet 3 requires more context understanding than Snippet 4. Also, there is weird syntax in Snippet 3; line 11 takes an argument in a getter, which is not common and passing null looks unnecessary.
        </div>
      </div>
  
      <div class="ranking-slot" style="position: relative;">
        <button class="snippet-3" onclick="show_snippet(3)">Snippet 3</button>
        <div class="reasoning-point" onclick="compare([3], [8])" style="top: 50px; right: -12px;"></div>
        <div class="tooltip-box" style="top: 60px; right: -160px;">
          üí° <strong>Reason:</strong><br>
          Snippet 8 requires the mathematical definition of "atan".
        </div>
      </div>
  
      <div class="ranking-slot" style="position: relative;">
        <button class="snippet-8" onclick="show_snippet(8)">Snippet 8</button>
        <div class="reasoning-point" onclick="compare([8], [5])" style="top: 50px; right: -12px;"></div>
        <div class="tooltip-box" style="top: 60px; right: -160px;">
          üí° <strong>Reason:</strong><br>
          Snippet 5 has a clear logic: delete files/directories recursively. It does not need to have a specific mathematical definition to understand the logic like in Snippet 8.
        </div>
      </div>
  
      <div class="ranking-slot" style="position: relative;">
        <button class="snippet-5" onclick="show_snippet(5)">Snippet 5</button>
        <div class="reasoning-point" onclick="compare([5], [6])" style="top: 50px; right: -12px;"></div>
        <div class="tooltip-box" style="top: 60px; right: -160px;">
          üí° <strong>Reason:</strong><br>
          The logic used in Snippet 6's encoding is hard to understand. I do not remember the hexadecimal meaning of 0x8 and 0x7.
        </div>
      </div>
  
      <div class="ranking-slot" style="position: relative;">
        <button class="snippet-6" onclick="show_snippet(6)">Snippet 6</button>
        <div class="reasoning-point" onclick="compare([6], [7])" style="top: 50px; right: -12px;"></div>
        <div class="tooltip-box" style="top: 60px; right: -160px;">
          üí° <strong>Reason:</strong><br>
          Snippet 7 logic is in contradiction with the method name. I thought it returns the lowest positive root from three numbers, but line 2 is unclear.
        </div>
      </div>
  
      <div class="ranking-slot">
        <button class="snippet-7" onclick="show_snippet(7)">Snippet 7</button>
      </div>
    </div>
  </div>`
    },
    {
        id: 2,
        name: "Oscar",
        html: `<div class="participant-section">
        <h3>Oscar</h3>
        <div class="ranking-row">
          <div class="ranking-slot" style="position: relative;">
            <button class="snippet-1" onclick="show_snippet(1)">Snippet 1</button>
            <button class="snippet-3" onclick="show_snippet(3)">Snippet 3</button>
            <button class="snippet-5" onclick="show_snippet(5)">Snippet 5</button>
            <div class="reasoning-point" onclick="compare([1,5], [3])" style="position: absolute; top: -4px; right: 60px;"></div>
            <div class="tooltip-box" style="position: absolute; top: 25px; left: 10px; width: 360px;">
                It is hard for me to distinguish which one is easier/harder to understand. They have straightforward logic that I am familiar with, and I don't think the usage of a visitor or nested ifs or loops makes one harder/easier to understand than the others.
            </div>
          </div>
          <div class="ranking-slot"></div>
          <div class="ranking-slot" style="position: relative;">
            <button class="snippet-7" onclick="show_snippet(7)">Snippet 7</button>
            <div class="reasoning-point" onclick="compare([7], [2])" style="top: 50px; right: -12px;"></div>
            <div class="tooltip-box" style="top: 60px; right: -160px;">
              üí° <strong>Reason:</strong><br>
              The reason I ranked Snippet 2 after Snippet 7 is that I am not familiar with a URI's scheme and why implementing that logic (in Snippet 2) is enough to check if it is remote. Snippet 7 is straightforward to understand if we remember/know the quadratic formula.
            </div>
          </div>
          <div class="ranking-slot" style="position: relative;">
            <button class="snippet-2" onclick="show_snippet(2)">Snippet 2</button>
          </div>
          <div class="ranking-slot"></div>
          <div class="ranking-slot" style="position: relative;">
            <button class="snippet-4" onclick="show_snippet(4)">Snippet 4</button>
            <div class="reasoning-point" onclick="compare([4], [6])" style="top: 50px; right: -12px;"></div>
            <div class="tooltip-box" style="top: 60px; right: -160px;">
              üí° <strong>Reason:</strong><br>
              Snippet 6 is harder to understand for me because I don't know what the bit shifts are doing to check or determine the sequence length in UTF-8. Snippet 4 is easier to understand, despite it being unclear what regionMatches is doing ‚Äî overall, I understand what the method is doing.
            </div>
          </div>
          <div class="ranking-slot" style="position: relative;">
            <button class="snippet-6" onclick="show_snippet(6)">Snippet 6</button>
            <div class="reasoning-point" onclick="compare([6], [8])" style="top: 50px; right: -12px;"></div>
            <div class="tooltip-box" style="top: 60px; right: -160px;">
              üí° <strong>Reason:</strong><br>
              For obvious reasons, atan2 is harder to understand: I don't remember how atan works, the code contains cryptic instructions and I don't know what atanUnchecked is doing -- also, the identifiers here don't help!
            </div>
          </div>
          <div class="ranking-slot">
            <button class="snippet-8" onclick="show_snippet(8)">Snippet 8</button>
          </div>
        </div>
      </div>`
      }, 
      {
        id: 3,
        name: "Martin",
        html: `<div class="participant-section">
        <h3>Martin</h3>
        <div class="ranking-row">
          <div class="ranking-slot" style="position: relative;">
            <button class="snippet-2" onclick="show_snippet(2)">Snippet 2</button>
            <div class="reasoning-point" onclick="compare([2], [1])" style="top: 50px; right: -12px;"></div>
            <div class="tooltip-box" style="top: 60px; right: -160px;">
              üí° They both implement simple string validation logic. \`isRemote\` has a shorter, simpler set of rules that it implements, so I ranked it lower. However, I don't think either of these are very difficult: both were pretty trivial to write a specification for.
            </div>
          </div>
          <div class="ranking-slot" style="position: relative;">
            <button class="snippet-1" onclick="show_snippet(1)">Snippet 1</button>
            <div class="reasoning-point" onclick="compare([2], [1])" style="top: 50px; right: -12px;"></div>
            <div class="tooltip-box" style="top: 60px; right: -160px;">
              There is a big gap between these, in my view. \`isValidProjectName\` is simple string validation, but the other two snippets are implementations of more complex (but reasonably well-known!) algorithms that are pretty easy to recognize. 
            </div>
          </div>
          <div class="ranking-slot" style="position: relative;"></div>
          <div class="ranking-slot" style="position: relative;">
            <button class="snippet-4" onclick="show_snippet(4)">Snippet 4</button>
            <button class="snippet-7" onclick="show_snippet(7)">Snippet 7</button>
            <div class="reasoning-point" onclick="compare([4], [7])" style="position: absolute; top: -4px; right: 60px;"></div>
            <div class="tooltip-box" style="position: absolute; top: 25px; left: 10px; width: 360px;">
              These two snippets are moderately complex string and float algorithms, respectively. I don't differentiate between them, since both are tricky to get right but doing something pretty well understood.
              (prev:Snippets 4, 5, and 7 are pretty similar, in the sense that each implements a well-known algorithm that I immediately recognized. However, all three are pretty complicated algorithms to get right.)
            </div>
            <div class="reasoning-point" onclick="compare([4,7], [5])" style="top: 50px; right: -12px;"></div>
            <div class="tooltip-box" style="top: 60px; right: -160px;">
              üí° <strong>Reason:</strong><br>
              These three snippets are actually pretty similar: all are implementations of some kind of simple specification that's a bit tricky to get right in practice. I'm actually not even confident that \`deleteRecursively\` is correct, though, which is why I ranked it above the other two: the relevant Java APIs are quite confusing and easy to get wrong. I think this implementation might leak a file descriptor?
              (prev:I'm actually not even confident that Snippet 5 is correct, which is why I ranked it above the other two: the relevant Java APIs are quite confusing and easy to get wrong. Snippets 4 and 7 are moderately complex string and float algorithms, respectively. I don't differentiate between them.)
            </div>
          </div>
          <div class="ranking-slot" style="position: relative;">
            <button class="snippet-5" onclick="show_snippet(5)">Snippet 5</button>
            <div class="reasoning-point" onclick="compare([3], [6])" style="top: 50px; right: -12px;"></div>
            <div class="tooltip-box" style="top: 60px; right: -160px;">
              üí° <strong>Reason:</strong><br>
              \`isMachineTypeDefined\` required me to do true bottom-up reasoning to figure out what it was doing, unlike \`deleteRecursively\`.<br>
              (prev:Then comes Snippet 3: it also required me to reason through it, since it wasn't clear what it was for just from reading through it once. However, it was noticeably easier to figure out what Snippet 3 is doing compared to Snippet 6.)
            </div>
          </div>
          <div class="ranking-slot" style="position: relative;">
            <button class="snippet-3" onclick="show_snippet(3)">Snippet 3</button>
            <div class="reasoning-point" onclick="compare([3], [6])" style="top: 50px; right: -12px;"></div>
            <div class="tooltip-box" style="top: 60px; right: -160px;">
              üí° <strong>Reason:</strong><br>
              Both snippets require bottom-up reasoning. However, \`encodedLength\` requires more domain knowledge to make sense of, since it seems obvious to me that Java programmers should know how the API for the language itself works at a basic level (e.g., "what's a field?" is not a question any Java programmer is going to ask), but \`encodedLength\` requires understanding UTF-8 vs UTF-16, which many Java programmers won't have had to deal with.
            </div>
          </div>
          <div class="ranking-slot">
            <button class="snippet-6" onclick="show_snippet(6)">Snippet 6</button>
            <div class="reasoning-point" onclick="compare([6], [8])" style="top: 50px; right: -12px;"></div>
            <div class="tooltip-box" style="top: 60px; right: -160px;">
              üí° <strong>Reason:</strong><br>
              Both require line-by-line reasoning, but \`atan2\` requires _two_ kinds of domain-specific knowledge (numerical methods + trig) vs just one for \`encodedLength\` (encodings).<br>
              (prev:Snippet 8 is the toughest: it was the only one where I couldn't follow why it was doing what it was doing.<br>
              Snippet 6 is next: it required me to reason through the code "bottom up" to figure out what it's doing.)
            </div>
          </div>
          <div class="ranking-slot">
            <button class="snippet-8" onclick="show_snippet(8)">Snippet 8</button>
          </div>
        </div>
      </div>`
      },
      {
        id: 4,
        name: "ChatGPT",
        html: `<div class="participant-section">
        <h3>ChatGPT</h3>
        <div class="ranking-row">
      
          <div class="ranking-slot" style="position: relative;">
            <button class="snippet-1" onclick="show_snippet(1)">Snippet 1</button>
            <button class="snippet-7" onclick="show_snippet(7)">Snippet 7</button>
            <div class="reasoning-point" onclick="compare([1], [7])" style="position: absolute; top: -4px; right: 60px;"></div>
            <div class="tooltip-box" style="position: absolute; top: 25px; left: 10px; width: 360px;">
              Q1: Snippets 1 and 7 are procedural, self-contained, and use familiar logic.<br><br>
              Snippet 1 validates a string using simple checks. Snippet 7 implements the quadratic formula clearly.<br><br>
              Both are linear, intuitive, and involve no external APIs or abstractions.
            </div>
            <div class="reasoning-point" onclick="compare([1, 7], [2, 4])" style="position: absolute; top: 50px; right: -12px;"></div>
            <div class="tooltip-box" style="position: absolute; top: 60px; right: -160px;">
              Q2: Position 1 snippets use basic logic. Position 2 introduces switch statements, index manipulation, or undefined helpers like <code>isFilesystemPath</code> and <code>regionMatches</code>.
            </div>
          </div>
      
          <div class="ranking-slot" style="position: relative;">
            <button class="snippet-2" onclick="show_snippet(2)">Snippet 2</button>
            <button class="snippet-4" onclick="show_snippet(4)">Snippet 4</button>
            <div class="reasoning-point" onclick="compare([2], [4])" style="position: absolute; top: -4px; right: 60px;"></div>
            <div class="tooltip-box" style="position: absolute; top: 25px; left: 10px; width: 360px;">
              Q3: Both snippets are logically structured but rely on external or undefined methods.<br><br>
              Snippet 2: needs understanding of URI schemes.<br>
              Snippet 4: uses string search logic with <code>regionMatches</code>.<br><br>
              Slightly more effort to understand, but still readable.
            </div>
            <div class="reasoning-point" onclick="compare([2, 4], [3])" style="position: absolute; top: 50px; right: -12px;"></div>
            <div class="tooltip-box" style="position: absolute; top: 60px; right: -160px;">
              Q4: Snippet 3 (reflection, field modifiers, exceptions) is conceptually more demanding than the procedural structure of 2 and 4.
            </div>
          </div>
      
          <div class="ranking-slot" style="position: relative;">
            <button class="snippet-3" onclick="show_snippet(3)">Snippet 3</button>
            <div class="reasoning-point" onclick="compare([3], [5])" style="position: absolute; top: 50px; right: -12px;"></div>
            <div class="tooltip-box" style="position: absolute; top: 60px; right: -160px;">
              Q5: Snippet 3 uses reflection but is linear. Snippet 5 uses <code>Files.walkFileTree</code>, anonymous classes, and callbacks‚Äîmaking it harder to follow.
            </div>
          </div>
      
          <div class="ranking-slot"></div>
      
          <div class="ranking-slot" style="position: relative;">
            <button class="snippet-5" onclick="show_snippet(5)">Snippet 5</button>
            <div class="reasoning-point" onclick="compare([5], [8])" style="position: absolute; top: 50px; right: -12px;"></div>
            <div class="tooltip-box" style="position: absolute; top: 60px; right: -160px;">
              Q6: Snippet 5 is harder than reflection, but still structured. Snippet 6 uses bitwise hacks and undefined helpers‚Äîless readable.
            </div>
          </div>
      
          <div class="ranking-slot"></div>
      
          <div class="ranking-slot" style="position: relative;">
            <button class="snippet-6" onclick="show_snippet(6)">Snippet 6</button>
            <div class="reasoning-point" onclick="compare([6], [8])" style="position: absolute; top: 50px; right: -12px;"></div>
            <div class="tooltip-box" style="position: absolute; top: 60px; right: -160px;">
              Q7: Snippet 6 is hard but scoped. Snippet 8 has cryptic math, fallback logic like <code>x + y</code>, and is more error-prone‚Äîtherefore harder to follow.
            </div>
          </div>
      
          <div class="ranking-slot" style="position: relative;">
            <button class="snippet-8" onclick="show_snippet(8)">Snippet 8</button>
          </div>
        </div>
      </div>`
      }                    
      
  ];
  
  </script> 

  <script>
    function showValidationMessage(msg) {
      document.getElementById('validation-message').innerText = msg;
      document.getElementById('validation-modal').style.display = 'block';
    }
  </script>

<script>
  const originalSnippets = [
    {
      id: 1,
      title: "Snippet 1",
      code: `
<span class="keyword">public static</span> <span class="type">boolean</span> <span class="function">isValidProjectName</span>(<span class="type">String</span> name) {
    <span class="keyword">if</span> (name == <span class="literal">null</span>) {
        <span class="keyword">return</span> <span class="literal">false</span>;
    }
    <span class="keyword">if</span> (name.<a href="#" class="standard-method function" onclick="openJavadocModal('https://docs.oracle.com/javase/8/docs/api/java/lang/String.html#startsWith-java.lang.String-')">startsWith</a>(<span class="string">"."</span>)) {
        <span class="keyword">return</span> <span class="literal">false</span>;
    }
    <span class="keyword">if</span> ((name.<a href="#" class="standard-method function" onclick="openJavadocModal('https://docs.oracle.com/javase/8/docs/api/java/lang/String.html#length--')">length</a>() < <span class="number">1</span>) || (name.<a href="#" class="standard-method function" onclick="openJavadocModal('https://docs.oracle.com/javase/8/docs/api/java/lang/String.html#length--')">length</a>() > MAX_NAME_LENGTH)) {
        <span class="keyword">return</span> <span class="literal">false</span>;
    }
    <span class="keyword">for</span> (<span class="type">int</span> i = <span class="number">0</span>; i < name.<a href="#" class="standard-method function" onclick="openJavadocModal('https://docs.oracle.com/javase/8/docs/api/java/lang/String.html#length--')">length</a>(); i++) {
        <span class="type">char</span> c = name.<a href="#" class="standard-method function" onclick="openJavadocModal('https://docs.oracle.com/javase/8/docs/api/java/lang/String.html#charAt-int-')">charAt</a>(i);
        <span class="keyword">if</span> (!Character.<a href="#" class="standard-method function" onclick="openJavadocModal('https://docs.oracle.com/javase/8/docs/api/java/lang/Character.html#isLetterOrDigit-char-')">isLetterOrDigit</a>(c) && !VALID_NAME_SET.<a href="#" class="standard-method function" onclick="openJavadocModal('https://docs.oracle.com/javase/8/docs/api/java/util/Set.html#contains-java.lang.Object-')">contains</a>(c)) {
            <span class="keyword">return</span> <span class="literal">false</span>;
        }
    }
    <span class="keyword">return</span> <span class="literal">true</span>;
}
`
          },
          {
            id: 2,
            title: "Snippet 2",
            code: `
<span class="keyword">public static</span> <span class="type">boolean</span> <span class="function">isRemote</span>(<span class="type">URI</span> uri) {
    <span class="keyword">if</span> (<span class="function">isFilesystemPath</span>(uri)) {
        <span class="keyword">return</span> <span class="literal">false</span>;
    }
    <span class="type">String</span> scheme = uri.<a href="#" class="standard-method function" onclick="openJavadocModal('https://docs.oracle.com/javase/8/docs/api/java/net/URI.html#getScheme--')">getScheme</a>();
    <span class="keyword">if</span> (scheme == <span class="literal">null</span>) {
        <span class="keyword">return</span> <span class="literal">false</span>;
    }
    <span class="keyword">switch</span> (scheme) {
        <span class="keyword">case</span> <span class="string">"file"</span>:
        <span class="keyword">case</span> <span class="string">"jar"</span>:
            <span class="keyword">return</span> <span class="literal">false</span>;
        <span class="keyword">default</span>:
            <span class="keyword">break</span>;
    }
    <span class="keyword">return</span> <span class="literal">true</span>;
}
`            
          },
          {
            id: 3,
            title: "Snippet 3",
            code: `
<span class="keyword">public static</span> <span class="type">boolean</span> <span class="function">isMachineTypeDefined</span>(<span class="type">short</span> type) {
    <span class="keyword">if</span> (type == IMAGE_FILE_MACHINE_UNKNOWN) {
        <span class="comment">// Unsupported machine type</span>
        <span class="keyword">return</span> <span class="literal">false</span>;
    }
    <span class="keyword">for</span> (<span class="type">Field</span> field : CoffMachineType.<span class="function">class</span>.<a href="#" class="standard-method function" onclick="openJavadocModal('https://docs.oracle.com/javase/8/docs/api/java/lang/Class.html#getDeclaredFields--')">getDeclaredFields</a>()) {
        <span class="keyword">if</span> (!field.<a href="#" class="standard-method function" onclick="openJavadocModal('https://docs.oracle.com/javase/8/docs/api/java/lang/reflect/Field.html#isSynthetic--')">isSynthetic</a>()) {
            <span class="type">int</span> modifiers = field.<a href="#" class="standard-method function" onclick="openJavadocModal('https://docs.oracle.com/javase/8/docs/api/java/lang/reflect/Field.html#getModifiers--')">getModifiers</a>();
            <span class="keyword">if</span> (<a href="#" class="standard-method function" onclick="openJavadocModal('https://docs.oracle.com/javase/8/docs/api/java/lang/reflect/Modifier.html#isFinal-int-')">Modifier.isFinal</a>(modifiers) && <a href="#" class="standard-method function" onclick="openJavadocModal('https://docs.oracle.com/javase/8/docs/api/java/lang/reflect/Modifier.html#isStatic-int-')">Modifier.isStatic</a>(modifiers)) {
                <span class="keyword">try</span> {
                    <span class="keyword">if</span> (field.<a href="#" class="standard-method function" onclick="openJavadocModal('https://docs.oracle.com/javase/8/docs/api/java/lang/reflect/Field.html#getShort-java.lang.Object-')">getShort</a>(<span class="literal">null</span>) == type) {
                        <span class="keyword">return</span> <span class="literal">true</span>;
                    }
                } <span class="keyword">catch</span> (<span class="type">IllegalAccessException</span> e) {
                    <span class="keyword">continue</span>;
                }
            }
        }
    }
    <span class="keyword">return</span> <span class="literal">false</span>;
}
`            
          },
          {
            id: 4,
            title: "Snippet 4",
code: `<span class="keyword">public static</span> <span class="type">int</span> <span class="function">indexOfIgnoreCase</span>(<span class="type">CharSequence</span> str, <span class="type">CharSequence</span> searchStr, <span class="type">int</span> startPos) {
    <span class="keyword">if</span> (str == <span class="literal">null</span> || searchStr == <span class="literal">null</span>) {
        <span class="keyword">return</span> INDEX_NOT_FOUND;
    }
    <span class="keyword">if</span> (startPos < <span class="number">0</span>) {
        startPos = <span class="number">0</span>;
    }
    <span class="type">int</span> searchStrLen = searchStr.<a href="#" class="standard-method function" onclick="openJavadocModal('https://docs.oracle.com/javase/8/docs/api/java/lang/CharSequence.html#length--')">length</a>();
    <span class="type">int</span> endLimit = str.<a href="#" class="standard-method function" onclick="openJavadocModal('https://docs.oracle.com/javase/8/docs/api/java/lang/CharSequence.html#length--')">length</a>() - searchStrLen + <span class="number">1</span>;
    <span class="keyword">if</span> (startPos > endLimit) {
        <span class="keyword">return</span> INDEX_NOT_FOUND;
    }
    <span class="keyword">if</span> (searchStrLen == <span class="number">0</span>) {
        <span class="keyword">return</span> startPos;
    }
    <span class="keyword">for</span> (<span class="type">int</span> i = startPos; i < endLimit; i++) {
        <span class="keyword">if</span> (<span class="function">regionMatches</span>(str, <span class="literal">true</span>, i, searchStr, <span class="number">0</span>, searchStrLen)) {
            <span class="keyword">return</span> i;
        }
    }
    <span class="keyword">return</span> INDEX_NOT_FOUND;
}`
          },              
          {
            id: 5,
            title: "Snippet 5",
            code: `
<span class="keyword">public static</span> <span class="type">boolean</span> <span class="function">deleteRecursively</span>(@Nullable <span class="type">Path</span> root) <span class="keyword">throws</span> <span class="type">IOException</span> {
    <span class="keyword">if</span> (root == <span class="literal">null</span>) <span class="keyword">return</span> <span class="literal">false</span>;
    <span class="keyword">if</span> (!<a href="#" class="standard-method function" onclick="openJavadocModal('https://docs.oracle.com/javase/8/docs/api/java/nio/file/Files.html#exists-java.nio.file.Path-java.nio.file.LinkOption...-')">Files.exists</a>(root)) <span class="keyword">return</span> <span class="literal">false</span>;

    <a href="#" class="standard-method function" onclick="openJavadocModal('https://docs.oracle.com/javase/8/docs/api/java/nio/file/Files.html#walkFileTree-java.nio.file.Path-java.nio.file.FileVisitor-')">Files.walkFileTree</a>(root, <span class="keyword">new</span> <span class="type">SimpleFileVisitor</span>&lt;&gt;() {
        @Override
        <span class="keyword">public</span> <span class="type">FileVisitResult</span> <span class="function">visitFile</span>(<span class="type">Path</span> file, <span class="type">BasicFileAttributes</span> attrs) <span class="keyword">throws</span> <span class="type">IOException</span> {
            <a href="#" class="standard-method function" onclick="openJavadocModal('https://docs.oracle.com/javase/8/docs/api/java/nio/file/Files.html#delete-java.nio.file.Path-')">Files.delete</a>(file);
            <span class="keyword">return</span> FileVisitResult.CONTINUE;
        }
        @Override
        <span class="keyword">public</span> <span class="type">FileVisitResult</span> <span class="function">postVisitDirectory</span>(<span class="type">Path</span> dir, <span class="type">IOException</span> exc) <span class="keyword">throws</span> <span class="type">IOException</span> {
            <a href="#" class="standard-method function" onclick="openJavadocModal('https://docs.oracle.com/javase/8/docs/api/java/nio/file/Files.html#delete-java.nio.file.Path-')">Files.delete</a>(dir);
            <span class="keyword">return</span> FileVisitResult.CONTINUE;
        }
    });

    <span class="keyword">return</span> <span class="literal">true</span>;
}
`            
      },
      {
        id: 6,
        title: "Snippet 6",
        code: `
<span class="keyword">public static</span> <span class="type">int</span> <span class="function">encodedLength</span>(<span class="type">CharSequence</span> sequence) {
    <span class="comment">// Optimized implementation</span>
    <span class="type">int</span> utf16Length = sequence.<a href="#" class="standard-method function" onclick="openJavadocModal('https://docs.oracle.com/javase/8/docs/api/java/lang/CharSequence.html#length--')">length</a>();
    <span class="type">int</span> utf8Length = utf16Length;
    <span class="type">int</span> i = <span class="number">0</span>;

    <span class="keyword">while</span> (i < utf16Length && sequence.<a href="#" class="standard-method function" onclick="openJavadocModal('https://docs.oracle.com/javase/8/docs/api/java/lang/CharSequence.html#charAt-int-')">charAt</a>(i) < <span class="literal">0x80</span>) {
        i++;
    }

    <span class="keyword">for</span> (; i < utf16Length; i++) {
        <span class="type">char</span> c = sequence.<a href="#" class="standard-method function" onclick="openJavadocModal('https://docs.oracle.com/javase/8/docs/api/java/lang/CharSequence.html#charAt-int-')">charAt</a>(i);
        <span class="keyword">if</span> (c < <span class="literal">0x800</span>) {
            utf8Length += ((<span class="literal">0x7f</span> - c) >>> <span class="number">31</span>);
        } <span class="keyword">else</span> {
            utf8Length += <span class="function">encodedLengthGeneral</span>(sequence, i);
            <span class="keyword">break</span>;
        }
    }

    <span class="keyword">if</span> (utf8Length < utf16Length) {
        <span class="keyword">throw new</span> <span class="type">IllegalArgumentException</span>(
            <span class="string">"UTF-8 length does not fit in int: "</span> + (utf8Length + (<span class="literal">1L</span> << <span class="number">32</span>)));
    }

    <span class="keyword">return</span> utf8Length;
}
`        
      },
      {
        id: 7,
        title: "Snippet 7",
        code: `
<span class="keyword">public static</span> <span class="type">float</span> <span class="function">lowestPositiveRoot</span>(<span class="type">float</span> a, <span class="type">float</span> b, <span class="type">float</span> c) {
    <span class="type">float</span> det = b * b - <span class="number">4</span> * a * c;
    <span class="keyword">if</span> (det < <span class="number">0</span>) <span class="keyword">return</span> <span class="type">Float</span>.NaN;

    <span class="type">float</span> sqrtD = (<span class="type">float</span>)<span class="type">Math</span>.<a href="#" class="standard-method function" onclick="openJavadocModal('https://docs.oracle.com/javase/8/docs/api/java/lang/Math.html#sqrt-double-')">sqrt</a>(det);
    <span class="type">float</span> invA = <span class="number">1</span> / (<span class="number">2</span> * a);
    <span class="type">float</span> r1 = (-b - sqrtD) * invA;
    <span class="type">float</span> r2 = (-b + sqrtD) * invA;

    <span class="keyword">if</span> (r1 > r2) {
        <span class="type">float</span> tmp = r2;
        r2 = r1;
        r1 = tmp;
    }

    <span class="keyword">if</span> (r1 > <span class="number">0</span>) <span class="keyword">return</span> r1;
    <span class="keyword">if</span> (r2 > <span class="number">0</span>) <span class="keyword">return</span> r2;
    <span class="keyword">return</span> <span class="type">Float</span>.NaN;
}
`        
      },
      {
        id: 8,
        title: "Snippet 8",
        code: `
<span class="keyword">public static</span> <span class="type">float</span> <span class="function">atan2</span>(<span class="type">float</span> y, <span class="type">float</span> x) {
    <span class="type">float</span> n = y / x;

    <span class="keyword">if</span> (n != n)
        n = (y == x ? <span class="number">1f</span> : <span class="number">-1f</span>);
    <span class="keyword">else if</span> (n - n != n - n)
        x = <span class="number">0f</span>;

    <span class="keyword">if</span> (x > <span class="number">0</span>)
        <span class="keyword">return</span> <span class="function">atanUnchecked</span>(n);
    <span class="keyword">else if</span> (x < <span class="number">0</span>) {
        <span class="keyword">if</span> (y >= <span class="number">0</span>) <span class="keyword">return</span> <span class="function">atanUnchecked</span>(n) + PI;
        <span class="keyword">return</span> <span class="function">atanUnchecked</span>(n) - PI;
    } <span class="keyword">else if</span> (y > <span class="number">0</span>)
        <span class="keyword">return</span> x + HALF_PI;
    <span class="keyword">else if</span> (y < <span class="number">0</span>)
        <span class="keyword">return</span> x - HALF_PI;

    <span class="keyword">return</span> x + y;
}
`        
      }
    ];
  

  function getCookie(name) {
    const match = document.cookie.match(new RegExp('(^| )' + name + '=([^;]+)'));
    return match ? decodeURIComponent(match[2]) : null;
  }

  function getStoredSnippetOrder() {
    const stored = sessionStorage.getItem('snippetOrder') || getCookie('snippetOrder');
    if (stored) {
      try {
        const parsed = JSON.parse(stored);
        if (Array.isArray(parsed) && parsed.length === 8) return parsed;
      } catch {}
    }
    return null;
  }

  // Apply the stored snippet order
  const order = getStoredSnippetOrder();
  const snippets = [];

  if (order) {
    order.forEach((index, newId) => {
      snippet = { ...originalSnippets[index - 1] }; 
      snippet.id = newId + 1;
      snippet.title = `Snippet ${newId + 1}`;
      snippets.push(snippet);
    });
  } else {
    alert("‚ö†Ô∏è Missing snippet order. Please login again.");
    window.location.href = '/';
  }

  console.log("Applied snippet order:", snippets.map(s => s.title));

</script>
<script>
    window.onload = () => {
      remapSnippetReferences();
      renderParticipantRankings();
      loadCards();
      loadState();
      applyTheme();
      displayUserName();

      // ‚úÖ Restore Continue button if phase2Complete is already set
      const continueBtn = document.getElementById('continueBtn');
      if (sessionStorage.getItem('phase2Complete') === 'true' || getCookie('phase2Complete') === 'true') {
        if (continueBtn) {
          continueBtn.style.display = 'inline-block';
          continueBtn.style.backgroundColor = '#4CAF50'; 
          continueBtn.style.animation = 'glowPulse 1.5s infinite alternate';
        }
      }

      // Unlock and highlight status bar
      if (isComplete('phase1Complete')) document.getElementById('link-phase2').classList.remove('disabled');
      if (isComplete('phase2Complete')) document.getElementById('link-phase3').classList.remove('disabled');
      if (isComplete('phase3Complete')) document.getElementById('link-review').classList.remove('disabled');

      const current = window.location.pathname.split('/').pop();
      if (current.includes('phase1')) document.getElementById('link-phase1').classList.add('active');
      else if (current.includes('phase2')) document.getElementById('link-phase2').classList.add('active');
      else if (current.includes('phase3')) document.getElementById('link-phase3').classList.add('active');
      else if (current.includes('review')) document.getElementById('link-review').classList.add('active');

      if (sessionStorage.getItem('phase2Complete') === 'true' || getCookie('phase2Complete') === 'true') {
          document.getElementById('continueBtn').style.display = 'inline-block';
          document.getElementById('continueBtn').style.backgroundColor = '#4CAF50';
          document.getElementById('continueBtn').style.animation = 'glowPulse 1.5s infinite alternate';
      }

    setInterval(() => {
      try {
        saveToServer();
        console.log("[Auto-Save] Progress saved to server.");
      } catch (e) {
        console.warn("[Auto-Save] Failed to save:", e);
      }
    }, 120000); // every 2 minutes
    };

    function loadCards() {
      const container = document.getElementById('cards');
      snippets.forEach(snippet => {
        const card = document.createElement('div');
        card.className = 'card';
        card.draggable = true;
        card.id = `snippet-${snippet.id}`;
        card.innerHTML = `
          <strong>${snippet.title}</strong>
          <br><label><input type="checkbox" onchange="togglePreview(${snippet.id}, this)"> View</label>
        `;
        card.addEventListener('dragstart', () => card.classList.add('dragging'));
        card.addEventListener('dragend', () => card.classList.remove('dragging'));
        container.appendChild(card);
      });

      document.querySelectorAll('.ranking-slot').forEach(slot => {
        slot.addEventListener('dragover', e => {
          e.preventDefault();
          const dragging = document.querySelector('.dragging');
          if (dragging) slot.appendChild(dragging);
          saveState();
        });
      });
    }

    function togglePreview(id, checkbox) {
      const previewArea = document.getElementById('previewArea');
      const snippet = snippets.find(s => s.id === id);
      const existing = document.getElementById(`preview-${id}`);

      if (checkbox.checked && !existing) {
        const wrapper = document.createElement('div');
        wrapper.id = `preview-${id}`;
        wrapper.className = 'snippet-preview-box';

        const header = document.createElement('div');
        header.className = 'snippet-header';
        header.textContent = snippet.title;

        const codeBox = document.createElement('div');
        codeBox.className = 'code-box';
        codeBox.innerHTML = snippet.code;

        wrapper.appendChild(header);
        wrapper.appendChild(codeBox);
        previewArea.appendChild(wrapper);
      } else if (!checkbox.checked && existing) {
        previewArea.removeChild(existing);
      }
    }

    function saveState() {
      const positions = {};
      document.querySelectorAll('.ranking-slot').forEach((slot, index) => {
        positions[index + 1] = Array.from(slot.children).map(el => el.id);
      });
      const json = JSON.stringify(positions);
      sessionStorage.setItem('phase3_ranking', json);
      document.cookie = `phase3_ranking=${encodeURIComponent(json)}; path=/; max-age=${60 * 60 * 24 * 30}`;

      /* Check if the phase is completed */
      if (areAllCardsRanked()) {
        document.getElementById('continueBtn').style.display = 'inline-block';
        document.getElementById('continueBtn').style.backgroundColor = '#4CAF50';
        document.getElementById('continueBtn').style.animation = 'glowPulse 1.5s infinite alternate';
        sessionStorage.setItem('phase2Complete', 'true');
        document.cookie = `phase2Complete=true; path=/; max-age=${60 * 60 * 24 * 30}`;

        // ‚úÖ Also update the status bar
        const phase3Link = document.getElementById('link-phase3');
        if (phase3Link) {
          phase3Link.classList.remove('disabled');
        }
      } else {
        sessionStorage.removeItem('phase2Complete');
        document.cookie = `phase2Complete=; path=/; max-age=0`;
        document.getElementById('continueBtn').style.display = 'none';
        const phase3Link = document.getElementById('link-phase3');
        if (phase3Link) {
          phase3Link.classList.add('disabled');
        }
      }

    }

    function loadState() {
      let saved = sessionStorage.getItem('phase3_ranking');

      if (!saved) {
        const cookieMatch = document.cookie.match(/(?:^|; )phase3_ranking=([^;]*)/);
        if (cookieMatch) {
          saved = decodeURIComponent(cookieMatch[1]);  // ‚úÖ decode before parsing
          sessionStorage.setItem('phase3_ranking', saved);
        }
      }

      if (!saved) return;

      try {
        const parsed = JSON.parse(saved);  // now valid JSON
        Object.entries(parsed).forEach(([rank, ids]) => {
          const slot = document.querySelector(`.ranking-slot[data-rank='${rank}']`);
          ids.forEach(id => {
            const el = document.getElementById(id);
            if (el && slot) slot.appendChild(el);
          });
        });
      } catch (e) {
        console.error('Failed to parse phase3_ranking JSON:', e);
      }
    } 


  function toggleTheme() {
    const body = document.body;
    const isDark = body.classList.contains('dark-mode');

    if (isDark) {
      body.classList.remove('dark-mode');
      localStorage.setItem('codeTheme', 'light');
      document.getElementById('theme-toggle').textContent = 'Switch to Dark Mode';
    } else {
      body.classList.add('dark-mode');
      localStorage.setItem('codeTheme', 'dark');
      document.getElementById('theme-toggle').textContent = 'Switch to Light Mode';
    }
}

function applyTheme() {
  const theme = localStorage.getItem('codeTheme') || 'light';
  const btn = document.getElementById('theme-toggle');

  if (theme === 'dark') {
    document.body.classList.add('dark-mode');
    if (btn) btn.textContent = 'Switch to Light Mode';
  } else {
    document.body.classList.remove('dark-mode');
    if (btn) btn.textContent = 'Switch to Dark Mode';
  }
}

    function goToPhase3() {
    if(areAllCardsRanked()){
      location.href = '/phase3-recap.html';
    }else{showValidationMessage("‚ö†Ô∏è Please rank all snippets")};
  }

  /*For the instructions section*/
  function toggleInstructions() {
    const content = document.getElementById("instructions-content");
    const button = event.target;

    if (content.style.display === "none") {
      content.style.display = "block";
      button.textContent = "Hide";
    } else {
      content.style.display = "none";
      button.textContent = "Show";
    }
  }

  function getCookie(name) {
      const match = document.cookie.match(new RegExp('(^| )' + name + '=([^;]+)'));
      return match ? decodeURIComponent(match[2]) : null;
  }

  function isComplete(key) {
    return sessionStorage.getItem(key) === 'true' || getCookie(key) === 'true';
  }

  function areAllCardsRanked() {
    const allCards = document.querySelectorAll('.card');
    const assignedCardIds = new Set();

    document.querySelectorAll('.ranking-slot').forEach(slot => {
      slot.querySelectorAll('.card').forEach(card => {
        assignedCardIds.add(card.id);
      });
    });

    return allCards.length === assignedCardIds.size;
  }


</script>

<script>
  function displayUserName() {
    const name = sessionStorage.getItem('participantName') || getCookie('participantName');
    if (name) {
      document.getElementById('user-info').textContent = `üë§ ${name}`;
    }
  }
</script>

<script>
  function isLoggedIn() {
    const name = sessionStorage.getItem('participantName') || getCookie('participantName');
    const order = sessionStorage.getItem('snippetOrder') || getCookie('snippetOrder');
    return name && order;
  }

  function checkLogin() {
    if (!isLoggedIn()) {
      alert('You must be logged in to access this page. Redirecting to the homepage.');
      window.location.href = 'https://codecomprehensibility.site/';
    }
  }

  function checkPhase1Completion() {
    if (!isPhaseComplete('phase1Complete')) {
      alert('Please complete Phase 1 before continuing.');
      window.location.href = 'phase1-recap.html';
    }
  }
  
  function isPhaseComplete(phaseKey) {
    const sessionVal = sessionStorage.getItem(phaseKey);
    const cookieVal = getCookie(phaseKey);
    return sessionVal === 'true' || cookieVal === 'true';
  }

  window.addEventListener('load', checkLogin);
  window.addEventListener('load', checkPhase1Completion);
</script>


<script>
  // Toggle logout menu visibility
// document.addEventListener('DOMContentLoaded', () => {
//   const userInfo = document.getElementById('user-info');
//   const logoutMenu = document.getElementById('logout-menu');

//   userInfo.addEventListener('click', () => {
//     logoutMenu.style.display = logoutMenu.style.display === 'block' ? 'none' : 'block';
//   });

//   // Hide the menu if clicked outside
//   document.addEventListener('click', (event) => {
//     if (!event.target.closest('.user-dropdown')) {
//       logoutMenu.style.display = 'none';
//     }
//   });
// });

// Clear storage and redirect to login
function logout() {
  sessionStorage.clear();

  // Clear all cookies
  document.cookie.split(";").forEach(cookie => {
    const name = cookie.split("=")[0].trim();
    document.cookie = `${name}=; expires=Thu, 01 Jan 1970 00:00:00 UTC; path=/;`;
  });

  window.location.href = 'index.html';
}
</script>

<script>
function saveToServer() {
  const name = sessionStorage.getItem('participantName') || getCookie('participantName') || 'Anonymous';
  const username = getCookie('username') || 'anonymous';

  // Phase 1 data
  const phase1 = {};
  for (let i = 1; i <= 8; i++) {
    const summary = sessionStorage.getItem(`summary${i}`) || getCookie(`summary${i}`) || '';
    const comp = sessionStorage.getItem(`compSummary${i}`) || getCookie(`compSummary${i}`) || '';
    phase1[`snippet${i}`] = { summary, comprehensibility: comp };
  }

  // Phase 2 & 3 data
  let phase2 = {}, phase3 = {};
  try {
    phase2 = JSON.parse(sessionStorage.getItem('phase3_ranking') || getCookie('phase3_ranking') || '{}');
    phase3 = JSON.parse(sessionStorage.getItem('phase3_reasoning') || getCookie('phase3_reasoning') || '{}');
  } catch (e) {
    console.warn("Error parsing phase2 or phase3 data", e);
  }

  // Completion flags and theme
  const flags = {
    phase1Complete: sessionStorage.getItem('phase1Complete') || getCookie('phase1Complete') || 'false',
    phase2Complete: sessionStorage.getItem('phase2Complete') || getCookie('phase2Complete') || 'false',
    phase3Complete: sessionStorage.getItem('phase3Complete') || getCookie('phase3Complete') || 'false',
    codeTheme: localStorage.getItem('codeTheme') || 'light',
    submitted: '0',
  };

  const payload = {
    username,
    participantName: name,
    phase1,
    phase2,
    phase3,
    ...flags
  };

  const blob = new Blob([JSON.stringify(payload)], { type: 'application/json' });
  navigator.sendBeacon('https://codecomprehensibility.site/submit_final', blob);
}

window.addEventListener('beforeunload', saveToServer);


</script>

<script>
  function remapSnippetReferences(participantRankings) {
  const getSnippetOrder = () => {
    const key = 'snippetOrder';
    const fromSession = sessionStorage.getItem(key);
    if (fromSession) return JSON.parse(fromSession);
    const fromCookie = decodeURIComponent(document.cookie.split('; ').find(row => row.startsWith(key + '='))?.split('=')[1] || '[]');
    return JSON.parse(fromCookie || '[]');
  };

  const order = getSnippetOrder(); // e.g., [6,7,8,1,2,3,4,5]
  if (!Array.isArray(order) || order.length !== 8) {
    console.warn('Invalid snippetOrder:', order);
    return;
  }

  const mapOldToNew = {};
  for (let i = 0; i < 8; i++) {
    mapOldToNew[i + 1] = order[i]; // 1-based snippet numbers
  }

  participantRankings.forEach(participant => {
    let html = participant.html;

    // Replace Snippet X (e.g., Snippet 1 -> Snippet 6)
    html = html.replace(/\bSnippet (\d)\b/g, (_, x) => `Snippet ${mapOldToNew[parseInt(x)]}`);

    // Replace show_snippet(X)
    html = html.replace(/show_snippet\((\d)\)/g, (_, x) => `show_snippet(${mapOldToNew[parseInt(x)]})`);

    // Replace compare([...], [...]) by mapping each number inside both arrays
    html = html.replace(/compare\(\[([^\]]*)\],\s*\[([^\]]*)\]\)/g, (_, group1, group2) => {
      const remapGroup = group => group
        .split(',')
        .map(n => parseInt(n.trim()))
        .filter(n => !isNaN(n))
        .map(n => mapOldToNew[n])
        .join(',');
      const newG1 = remapGroup(group1);
      const newG2 = remapGroup(group2);
      return `compare([${newG1}], [${newG2}])`;
    });

    // Update the participant object
    participant.html = html;
  });
}


function renderParticipantRankings() {
  const container = document.querySelector('.phase-section');
  if (!container) {
    console.error('No .phase-section container found.');
    return;
  }

  container.innerHTML = ''; // Clear existing content

  const currentUser = (sessionStorage.getItem('username') || getCookie('username') || '').trim().toLowerCase();

  participantRankings.forEach(participant => {
    const participantName = participant.name.trim();
    const isCurrentUser = participantName.toLowerCase() === currentUser;

    // Replace name in HTML heading
    const displayHTML = participant.html.replace(
      new RegExp(`<h3>${participantName}</h3>`),
      `<h3>${isCurrentUser ? 'Your Ranking' : participantName}</h3>`
    );

    // Append updated HTML
    const wrapper = document.createElement('div');
    wrapper.innerHTML = displayHTML;
    container.appendChild(wrapper);
  });
}

</script>

<footer style="margin-top: 40px; padding-top: 20px; border-top: 1px solid #ccc; text-align: center; font-size: 14px; color: #666;">
  Please contact us if you have any questions or issues: <a href="mailto:ea442@njit.edu">ea442@njit.edu</a>
</footer>
</body>
</html>
