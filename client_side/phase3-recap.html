<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>Phase 2: Rank Code Snippets</title>
  <style>
    body {
      font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
      margin: 0 40px 40px 40px;
      /* top right bottom left */
      background-color: #f4f4f4;
      color: #333;
    }
  
    .instructions {
      background-color: #fff;
      padding: 20px;
      border-radius: 8px;
      margin-bottom: 20px;
      box-shadow: 0 2px 8px rgba(0, 0, 0, 0.1);
    }
  
    .ranking-row {
      display: flex;
      gap: 10px;
      overflow-x: visible;
      margin-bottom: 20px;
    }
  
    .ranking-row-numbers {
      display: flex;
      gap: 10px;
      margin-bottom: 0;
    }
  
    .ranking-slot {
      flex: 1 1 100px;
      background: #e8f5e9;
      border: 2px dashed #4CAF50;
      border-radius: 6px;
      padding: 10px;
      min-height: 80px;
      text-align: center;
    }
  
    .ranking-number {
      flex: 1;
      text-align: center;
      color: #009999;
    }
  
    .card {
      background: #fff;
      border: 1px solid #ccc;
      border-radius: 6px;
      padding: 8px;
      margin: 5px;
      cursor: grab;
    }
  
    .card.dragging {
      opacity: 0.5;
    }
  
    .preview-area {
      display: flex;
      gap: 20px;
      flex-wrap: wrap;
      margin-top: 20px;
    }
  
    .snippet-preview-box {
      flex: 1 1 45%;
      min-width: 300px;
      border-radius: 8px;
      overflow: hidden;
      box-shadow: 0 2px 8px rgba(0, 0, 0, 0.1);
      background-color: #ffffff;
      border: 1px solid #ddd;
    }
  
    .snippet-header {
      background-color: #f5f5f5;
      padding: 10px 15px;
      font-weight: bold;
      font-size: 16px;
      border-bottom: 1px solid #ccc;
    }
  
    .code-box {
      font-family: 'Courier New', Courier, monospace;
      white-space: pre-wrap;
      overflow-x: auto;
      padding: 15px;
      font-size: 14px;
      color: #333;
      background-color: #f9f9f9;
    }
  
    #theme-toggle {
      background-color: #333;
      color: white;
      border: none;
      padding: 6px 12px;
      border-radius: 5px;
      cursor: pointer;
      margin-bottom: 20px;
    }
  
    #continueBtn {
      background-color: #4CAF50;
      color: white;
      border: none;
      padding: 12px 24px;
      font-size: 16px;
      border-radius: 6px;
      cursor: pointer;
      box-shadow: 0 0 10px #4CAF50;
    }
  
    #continueBtn:hover {
      background-color: #45a049;
      animation: glowPulse 1.5s infinite alternate;
    }
  
    @keyframes glowPulse {
      0% {
        box-shadow: 0 0 10px #4CAF50;
      }
  
      100% {
        box-shadow: 0 0 20px #4CAF50, 0 0 30px #4CAF50;
      }
    }
  
    /*.status-bar {
        background-color: #333;
        color: white;
        padding: 10px 20px;
        display: flex;
        justify-content: center;
        gap: 30px;
        margin-top: 0;
        position: static; 
      }*/
  
    .status-bar {
      background-color: #333;
      color: white;
      padding: 10px 20px;
      display: flex;
      justify-content: center;
      gap: 30px;
      position: fixed;
      top: 0;
      left: 0;
      right: 0;
      z-index: 1000;
    }
  
    .phase-link {
      color: white;
      text-decoration: none;
      font-weight: bold;
      padding: 8px 12px;
      border-radius: 4px;
      transition: background-color 0.2s;
    }
  
    .phase-link:hover:not(.disabled) {
      background-color: #4CAF50;
    }
  
    .phase-link.active {
      background-color: #4CAF50;
    }
  
    .phase-link.disabled {
      pointer-events: none;
      opacity: 0.5;
      cursor: not-allowed;
    }
  
    /*For snippet cards*/
    #cards {
      display: flex;
      gap: 8px;
      overflow-x: auto;
      padding: 10px 0;
      flex-wrap: nowrap;
    }
  
    button {
      padding: 10px 20px;
      margin-right: 10px;
      font-size: 16px;
      border: none;
      border-radius: 5px;
      background-color: #4CAF50;
      color: white;
      cursor: pointer;
    }
  
    button:hover {
      background-color: #45a049;
    }
  
    button[disabled] {
      background-color: #888;
      cursor: not-allowed;
    }
  
    /*dark/light mode*/
    /* Light mode preview styles */
    /* === Default (light mode) === */
    .card {
      background-color: #ffffff;
      border-color: #ccc;
      color: #333;
    }
  
    .snippet-preview-box {
      background-color: #fefefe;
      border: 1px solid #bbb;
    }
  
    .code-box {
      background-color: #f9f9f9;
      color: #222;
    }
  
    /* === Dark mode overrides === */
    body.dark-mode .card {
      background-color: #2a2a2a;
      border-color: #555;
      color: #ddd;
    }
  
    body.dark-mode .snippet-preview-box {
      background-color: #1e1e1e;
      border: 1px solid #444;
    }
  
    body.dark-mode .code-box {
      background-color: #2d2d2d;
      color: #ddd;
    }
  
  
    /*code box*/
    /* Basic syntax highlighting classes */
    .keyword {
      color: #0000ff;
      font-weight: bold;
    }
  
    .type {
      color: #007070;
    }
  
    .function {
      color: #7928a1;
      font-weight: bold;
    }
  
    .literal {
      color: #009999;
    }
  
    .string {
      color: #a31515;
    }
  
    .comment {
      color: #6a9955;
      font-style: italic;
    }
  
    .number {
      color: #098658;
    }
  
    /* Dark mode overrides */
    .dark-mode .keyword {
      color: #82aaff;
    }
  
    .dark-mode .type {
      color: #89ddff;
    }
  
    .dark-mode .function {
      color: #c792ea;
    }
  
    .dark-mode .literal {
      color: #ffcb6b;
    }
  
    .dark-mode .string {
      color: #c3e88d;
    }
  
    .dark-mode .comment {
      color: #7f848e;
    }
  
    .dark-mode .number {
      color: #f78c6c;
    }
  
    html {
      scroll-behavior: smooth;
    }
  
    a {
      color: #4CAF50;
      text-decoration: none;
    }
  
    a:hover {
      text-decoration: underline;
    }

      .participant-section {
      margin-bottom: 10px;
    }

    .ranking-row {
      display: flex;
      gap: 10px;
      margin-top: 10px;
    }

    .ranking-labels {
      display: flex;
      gap: 10px;
      margin-bottom: 5px;
    }

    .ranking-label {
      flex: 1;
      text-align: center;
      font-weight: bold;
      color: #009999;
    }

    .ranking-slot {
      flex: 1;
      min-height: 100px;
      border: 2px dashed #4CAF50;
      background-color: #e8f5e9;
      border-radius: 6px;
      padding: 10px;
    }

    .ranking-slot button {
      display: block;
      width: 100%;
      margin: 5px 0;
      padding: 6px;
      border: none;
      border-radius: 4px;
      background-color: #4CAF50;
      color: white;
      font-weight: bold;
      cursor: pointer;
    }

    .ranking-slot button:hover {
      background-color: #45a049;
      position: relative;
    }

    .ranking-label:last-child {
      color: red;
    }

    .snippet-1 { background-color: #4CAF50; color: white; } /* Green */
    .snippet-2 { background-color: #2196F3; color: white; } /* Blue */
    .snippet-3 { background-color: #f44336; color: white; } /* Red */
    .snippet-4 { background-color: #FF9800; color: white; } /* Orange */
    .snippet-5 { background-color: #9C27B0; color: white; } /* Purple */
    .snippet-6 { background-color: #3F51B5; color: white; } /* Indigo */
    .snippet-7 { background-color: #009688; color: white; } /* Teal */
    .snippet-8 { background-color: #795548; color: white; } /* Brown */

    button.snippet-1 { background-color: #4CAF50; color: white; }
    button.snippet-2 { background-color: #2196F3; color: white; }
    button.snippet-3 { background-color: #f44336; color: white; }
    button.snippet-4 { background-color: #FF9800; color: white; }
    button.snippet-5 { background-color: #9C27B0; color: white; }
    button.snippet-6 { background-color: #3F51B5; color: white; }
    button.snippet-7 { background-color: #009688; color: white; }
    button.snippet-8 { background-color: #795548; color: white; }


.reasoning-point {
  position: absolute;
  width: 5px;
  height: 5px;
  background: white;
  border: 2px solid black;
  border-radius: 50%;
  cursor: pointer;
  z-index: 10;
  transition: transform 0.2s ease;
}

.reasoning-point:hover {
  transform: scale(1.2);
}

.tooltip-box {
  position: absolute;
  background-color: #333;
  color: white;
  padding: 10px 15px;
  border-radius: 8px;
  font-size: 14px;
  max-width: 260px;
  box-shadow: 0 4px 12px rgba(0,0,0,0.3);
  display: none;
  z-index: 99;
}

.reasoning-container {
  position: relative;
}

/* Show tooltip on hover */
.reasoning-point:hover + .tooltip-box {
  display: block;
}

.snippet-box {
  background: #f9f9f9;
  border: 1px solid #ccc;
  border-radius: 6px;
  padding: 10px;
  margin-bottom: 10px;
  font-family: 'Courier New', monospace;
  white-space: pre-wrap;
  overflow-x: auto;
}

.code-content {
  background-color: #f0f0f0;
  padding: 10px;
  border-radius: 4px;
}

.participant {
      background: #f9f9f9;
      border-left: 4px solid #aaa;
      padding: 10px;
      margin-bottom: 10px;
    }
    .participant h4 {
      margin-top: 0;
    }


    #modal-code {
  background-color: #2d2d2d;
  color: #ccc;
  padding: 20px;
  border-bottom-left-radius: 8px;
  border-bottom-right-radius: 8px;
  overflow-x: auto;
  font-family: 'Courier New', Courier, monospace;
  font-size: 15px;
  line-height: 1.5;
}

.light-mode #modal-code {
  background-color: #f0f0f0;
  color: #333;
}
.code-container {
  display: grid;
  grid-template-columns: auto 1fr;
  background-color: inherit;
  color: inherit;
  font-family: 'Courier New', Courier, monospace;
  font-size: 15px;
  line-height: 1.5;
  padding: 20px;
  overflow-x: auto;
}

.line-numbers {
  text-align: right;
  padding-right: 10px;
  user-select: none;
  color: #888;
}

.code-content {
  white-space: pre;
}

#code {
  background-color: #2d2d2d;
  color: #ccc;
  padding: 20px;
  border-bottom-left-radius: 8px;
  border-bottom-right-radius: 8px;
  overflow-x: auto;
  font-family: 'Courier New', Courier, monospace;
  font-size: 15px;
  line-height: 1.5;
}

.light-mode #code {
  background-color: #f0f0f0;
  color: #333;
}
/* LIGHT MODE styles */
.keyword     { color: #0000ff; font-weight: bold; }
.type        { color: #007070; }
.function    { color: #7928a1; font-weight: bold; }
.literal     { color: #009999; }
.string      { color: #a31515; }
.comment     { color: #6a9955; font-style: italic; }
.number      { color: #098658; }

/* DARK MODE overrides */
.dark-mode .keyword  { color: #82aaff; }
.dark-mode .type     { color: #89ddff; }
.dark-mode .function { color: #c792ea; }
.dark-mode .literal  { color: #ffcb6b; }
.dark-mode .string   { color: #c3e88d; }
.dark-mode .comment  { color: #7f848e; }
.dark-mode .number   { color: #f78c6c; }

a {
    color: #4CAF50;
    text-decoration: none;
}
a:hover {
    text-decoration: underline;
}


.sticky-menu {
  position: fixed;
  bottom: 0;
  left: 0;
  right: 0;
  background: #ffffff;
  padding: 10px 0;
  border-top: 1px solid #ddd;
  display: flex;
  justify-content: center;
  gap: 12px;
  z-index: 1000;
  box-shadow: 0 -2px 6px rgba(0,0,0,0.06);
}

.sticky-menu button {
  background: #ffffff;
  color: #333;
  font-weight: 500;
  border: 1px solid #ccc;
  border-radius: 6px;
  padding: 8px 14px;
  cursor: pointer;
  transition: background 0.2s, box-shadow 0.2s;
}

.sticky-menu button:hover {
  background: #f3f3f3;
  box-shadow: 0 2px 4px rgba(0,0,0,0.08);
}

    .disagreement-box {
      background: white;
      padding: 20px;
      border-radius: 8px;
      box-shadow: 0 2px 8px rgba(0,0,0,0.1);
      margin-bottom: 20px;
    }
    textarea {
      width: 100%;
      height: 120px;
      padding: 10px;
      border-radius: 5px;
      border: 1px solid #ccc;
      font-size: 14px;
    }
    button {
      background-color: #4CAF50;
      color: white;
      border: none;
      padding: 10px 20px;
      font-size: 16px;
      margin-top: 20px;
      border-radius: 5px;
      cursor: pointer;
    }
    button:hover {
      background-color: #45a049;
    }
    .navigation {
      display: flex;
      justify-content: space-between;
      margin-top: 20px;
    }

    .content-wrapper {
      display: flex;
      gap: 20px;
      align-items: flex-start;
      margin-top: 20px;
    }

    .disagreement-box, .question-box {
      flex: 1;
      background: white;
      padding: 20px;
      border-radius: 8px;
      box-shadow: 0 2px 8px rgba(0,0,0,0.1);
    }

    textarea {
      width: 100%;
      height: 120px;
      padding: 10px;
      border-radius: 5px;
      border: 1px solid #ccc;
      font-size: 14px;
      resize: vertical;
    }

    .question-box .navigation {
      display: flex;
      justify-content: space-between;
      margin-top: 20px;
    }

    button {
      background-color: #4CAF50;
      color: white;
      border: none;
      padding: 10px 20px;
      font-size: 16px;
      border-radius: 5px;
      cursor: pointer;
    }

    button:hover {
      background-color: #45a049;
    }
    .content-wrapper {
  display: flex;
  gap: 20px;
  align-items: flex-start;
  margin-top: 20px;
}

.disagreement-box, .right-panel {
  flex: 1;
  background: white;
  padding: 20px;
  border-radius: 8px;
  box-shadow: 0 2px 8px rgba(0,0,0,0.1);
}

.question-box textarea {
  width: 100%;
  height: 120px;
  padding: 10px;
  font-size: 14px;
  border: 1px solid #ccc;
  border-radius: 5px;
  resize: vertical;
}

.right-panel .navigation {
  display: flex;
  justify-content: space-between;
  margin-top: 20px;
}
  </style>
</head>
<body>

<div class="status-bar">
  <div class="user-dropdown" style="position: relative;">
    <div style="padding: 8px 12px; color: gainsboro; font-weight: bold;"><span id="user-info"></span> (<button
        onclick="logout()"
        style="color: white; background: none; border: none; cursor: pointer; margin: 0;padding: 0;">üö™ Logout</button>)
    </div>
  </div>
  <a href="index.html" class="phase-link" id="link-home">üè† Home</a>
  <a href="phase1-recap.html" class="phase-link" id="link-phase1">Phase 1</a>
  <a href="phase2-recap.html" class="phase-link disabled" id="link-phase2">Phase 2</a>
  <a href="phase3-recap.html" class="phase-link disabled" id="link-phase3">Phase 3</a>
  <a href="review.html" class="phase-link disabled" id="link-review">Review & Submit</a>
</div>


<div id="instructions-box" style="background-color: #fff; padding: 20px; border-radius: 8px; margin-bottom: 20px; box-shadow: 0 2px 8px rgba(0,0,0,0.1); margin-top: 80px;">
  <div style="display: flex; justify-content: space-between; align-items: center;">
    <h2 style="margin: 0;">Phase 2: Ranking Code Snippets by Comprehension Difficulty</h2>
    <button onclick="toggleInstructions()" style="padding: 6px 12px; font-size: 14px; border-radius: 5px; background-color: #ffffff; border: none; cursor: pointer; color: #222; border: solid;">Show</button>
  </div>

  <div id="instructions-content" style="margin-top: 15px; display: none;">
    <p>In this phase, you will rank the 8 code snippets based on how easy or difficult they are to understand.</p>
    <ol>
      <li><strong>Rank the snippets:</strong> Drag and drop each snippet (white) card into the 8 green boxes, which represent ranking positions.</li>
      <li><strong>Understand the scale:</strong>
        <ul>
          <li><strong>Position 1</strong> (leftmost): it should contain the snippets that are easiest to understand.</li>
          <li><strong>Position 8</strong> (rightmost): it should contain the snippets that are easiest to understand.</li>
        </ul>
      </li>
      <li><strong>Equal ranking:</strong> You may place multiple snippets in the same position if they are similarly easy/difficult to understand.</li>
      <li><strong>Empty positions:</strong> it is possible to have empty positions (e.g., when grouping multiple snippets in one position).</li>
      <li><strong>Comparing snippets:</strong> You can compare the code of multiple snippets by clicking their "View" checkboxes, which display the snippets' code.</li>
    </ol>
    <!-- <p><strong>Important:</strong> Please fill the ranking positions from left to right. If you leave any positions empty (e.g., due to grouping multiple snippets in one position), leave the rightmost positions empty.</p> -->
     
          <p><strong>Please complete this phase using your own judgment</strong>. <span style="color:red;"><strong>Do not consult with anyone else or use generative AI tools (ChatGPT, GitHub Copilot, etc.), search engines, or external websites</strong></span>. Your judgment is essential to the validity of our study.</p>
  </div>
</div>


  <div class="ranking-row-numbers" id="rankingRow" style="display: none;">
    <p class="ranking-number">Position 1 <span style="color: green;">(easiest)</span></p>
    <p class="ranking-number">Position 2</p>
    <p class="ranking-number">Position 3</p>
    <p class="ranking-number">Position 4</p>
    <p class="ranking-number">Position 5</p>
    <p class="ranking-number">Position 6</p>
    <p class="ranking-number">Position 7</p>
    <p class="ranking-number">Position 8 <span style="color: red;">(hardest)</span></p> 
  </div>
  <div class="ranking-row" id="rankingRow" style="display: none;">
    <!-- 8 drop zones -->
    <div class="ranking-slot" data-rank="1"></div>
    <div class="ranking-slot" data-rank="2"></div>
    <div class="ranking-slot" data-rank="3"></div>
    <div class="ranking-slot" data-rank="4"></div>
    <div class="ranking-slot" data-rank="5"></div>
    <div class="ranking-slot" data-rank="6"></div>
    <div class="ranking-slot" data-rank="7"></div>
    <div class="ranking-slot" data-rank="8"></div>
  </div>

  <div id="cards" style="margin-bottom: 20px; display: none;"></div>

  
<div class="phase-wrapper" style="background-color: #fff; padding: 20px; border-radius: 8px; margin-bottom: 20px; box-shadow: 0 2px 8px rgba(0,0,0,0.1); margin-top: 80px;">
  <div style="display: flex; justify-content: space-between; align-items: center;">
    <h2 style="margin: 0;">Phase 3: Rankings and Reasonings</h2>
    <button onclick="togglePhaseSection()" class="toggle-btn" style="padding: 6px 12px; font-size: 14px; border-radius: 5px; background-color: #ddd; border: none; cursor: pointer;">Show</button>
  </div>

  <div id="phase-section-content" class="phase-section" style="margin-top: 15px; display: none;">
    <p>This is the collapsible content for Phase 3. Add your instructions, text, or UI elements here.</p>
  </div>
</div>

  <div id="snippet-bar" style="display: none; justify-content: space-between; align-items: center; padding: 10px 15px; background-color: #f5f5f5; border-radius: 6px; margin-bottom: 15px; box-shadow: 0 1px 3px rgba(0,0,0,0.1);">
    <h3 style="margin: 0; font-size: 16px; color: #333;">
      üîç Snippet Preview & Compare <span style="font-weight: normal;">(click on view checkboxes to preview or compare snippets)</span>
    </h3>
        <button id="theme-toggle" onclick="toggleTheme()" style="padding: 6px 12px; font-size: 14px; border-radius: 5px; background-color: #333; color: white; border: none; cursor: pointer;">
      Switch to Dark Mode
    </button>
  </div>
  
  <div class="preview-area" id="previewArea"></div>

    <div class="content-wrapper">
    <div id="disagreement-box" class="disagreement-box">
      <!-- Disagreement content here -->
    </div>
  
    <div class="right-panel">
      <div id="question-box" class="question-box">
        <!-- JS will populate this -->
      </div>
  
      <div class="navigation">
        <button onclick="prev()" id="prevBtn" style="display: none;">‚¨ÖÔ∏è Previous</button>
        <button onclick="next()" id="nextBtn">Next ‚û°Ô∏è</button>
      </div>
    </div>
  </div>

  <div style="margin-top: 30px; display: none;">
    <button id="continueBtn" onclick="goToPhase3()" style="padding: 10px 20px; font-size: 16px; border: none; border-radius: 5px; background-color: gray; color: white; cursor: pointer;">Continue to Phase 3 ‚û°Ô∏è</button>
  </div>

  <div id="validation-modal" style="
  display: none;
  position: fixed;
  top: 30%;
  left: 50%;
  transform: translate(-50%, -50%);
  background-color: #fff0f0;
  color: #660000;
  border: 1px solid #ff9999;
  padding: 20px;
  border-radius: 10px;
  width: 440px;
  box-shadow: 0 4px 16px rgba(0,0,0,0.2);
  z-index: 1002;
  text-align: center;
  font-family: 'Segoe UI', Tahoma, sans-serif;
  ">
    <p id="validation-message" style="font-weight: bold;"></p>
    <button onclick="document.getElementById('validation-modal').style.display = 'none';" style="
      margin-top: 15px;
      padding: 8px 14px;
      background-color: #ff9999;
      color: white;
      border: none;
      border-radius: 5px;
      cursor: pointer;
    ">OK</button>
  </div>

  <div id="snippet-modal" style="display:none; position:fixed; top:10%; left:50%; transform:translateX(-50%); width:80%; max-height:80%; overflow-y:auto; background:#fff; border:1px solid #ccc; padding:20px; border-radius:8px; box-shadow:0 4px 16px rgba(0,0,0,0.2); z-index:1002;">
  <div style="display:flex; justify-content:space-between; align-items:center; margin-bottom:15px;">
    <h3 id="modal-snippet-title" style="margin:0;">Snippet</h3>
    <div>
      <button onclick="toggleModalTheme()" id="modal-theme-toggle" style="margin-right: 10px; padding: 6px 12px; border-radius: 5px; border: none; background-color: #333; color: white; cursor: pointer;">Switch to Light Mode</button>
      <span onclick="document.getElementById('snippet-modal').style.display='none'" style="cursor:pointer; font-size:20px; font-weight:bold;">&times;</span>
    </div>
  </div>

  <div class="code-container" id="modal-code">
    <div class="line-numbers" id="modal-line-numbers"></div>
    <div class="code-content" id="modal-code-content"></div>
  </div>
</div>


<div id="compare-modal" style="display:none; position:fixed; top:10%; left:50%; transform:translateX(-50%); width:90%; max-height:80%; overflow-y:auto; background:#fff; border:1px solid #ccc; padding:20px; border-radius:8px; box-shadow:0 4px 16px rgba(0,0,0,0.2); z-index:1002;">
  <div style="display:flex; justify-content:space-between; align-items:center; margin-bottom:15px;">
    <h3 style="margin:0;">Compare Snippets</h3>
    <span onclick="document.getElementById('compare-modal').style.display='none'" style="cursor:pointer; font-size:20px; font-weight:bold;">&times;</span>
  </div>

  <div id="compare-columns" style="display: flex; gap: 20px; ">
    <div id="compare-left" style="flex: 1; overflow-x: auto;" ></div>
    <div id="compare-right" style="flex: 1; overflow-x: auto;"></div>
  </div>
</div>

<script src="js/rankings.js"></script>

<script>
  function showValidationMessage(msg) {
    document.getElementById('validation-message').innerText = msg;
    document.getElementById('validation-modal').style.display = 'block';
  }
</script>

<script>
  const originalSnippets = [
    {
      id: 1,
      title: "Snippet 1",
      code: `
<span class="keyword">public static</span> <span class="type">boolean</span> <span class="function">isValidProjectName</span>(<span class="type">String</span> name) {
    <span class="keyword">if</span> (name == <span class="literal">null</span>) {
        <span class="keyword">return</span> <span class="literal">false</span>;
    }
    <span class="keyword">if</span> (name.<a href="#" class="standard-method function" onclick="openJavadocModal('https://docs.oracle.com/javase/8/docs/api/java/lang/String.html#startsWith-java.lang.String-')">startsWith</a>(<span class="string">"."</span>)) {
        <span class="keyword">return</span> <span class="literal">false</span>;
    }
    <span class="keyword">if</span> ((name.<a href="#" class="standard-method function" onclick="openJavadocModal('https://docs.oracle.com/javase/8/docs/api/java/lang/String.html#length--')">length</a>() < <span class="number">1</span>) || (name.<a href="#" class="standard-method function" onclick="openJavadocModal('https://docs.oracle.com/javase/8/docs/api/java/lang/String.html#length--')">length</a>() > MAX_NAME_LENGTH)) {
        <span class="keyword">return</span> <span class="literal">false</span>;
    }
    <span class="keyword">for</span> (<span class="type">int</span> i = <span class="number">0</span>; i < name.<a href="#" class="standard-method function" onclick="openJavadocModal('https://docs.oracle.com/javase/8/docs/api/java/lang/String.html#length--')">length</a>(); i++) {
        <span class="type">char</span> c = name.<a href="#" class="standard-method function" onclick="openJavadocModal('https://docs.oracle.com/javase/8/docs/api/java/lang/String.html#charAt-int-')">charAt</a>(i);
        <span class="keyword">if</span> (!Character.<a href="#" class="standard-method function" onclick="openJavadocModal('https://docs.oracle.com/javase/8/docs/api/java/lang/Character.html#isLetterOrDigit-char-')">isLetterOrDigit</a>(c) && !VALID_NAME_SET.<a href="#" class="standard-method function" onclick="openJavadocModal('https://docs.oracle.com/javase/8/docs/api/java/util/Set.html#contains-java.lang.Object-')">contains</a>(c)) {
            <span class="keyword">return</span> <span class="literal">false</span>;
        }
    }
    <span class="keyword">return</span> <span class="literal">true</span>;
}
`
          },
          {
            id: 2,
            title: "Snippet 2",
            code: `
<span class="keyword">public static</span> <span class="type">boolean</span> <span class="function">isRemote</span>(<span class="type">URI</span> uri) {
    <span class="keyword">if</span> (<span class="function">isFilesystemPath</span>(uri)) {
        <span class="keyword">return</span> <span class="literal">false</span>;
    }
    <span class="type">String</span> scheme = uri.<a href="#" class="standard-method function" onclick="openJavadocModal('https://docs.oracle.com/javase/8/docs/api/java/net/URI.html#getScheme--')">getScheme</a>();
    <span class="keyword">if</span> (scheme == <span class="literal">null</span>) {
        <span class="keyword">return</span> <span class="literal">false</span>;
    }
    <span class="keyword">switch</span> (scheme) {
        <span class="keyword">case</span> <span class="string">"file"</span>:
        <span class="keyword">case</span> <span class="string">"jar"</span>:
            <span class="keyword">return</span> <span class="literal">false</span>;
        <span class="keyword">default</span>:
            <span class="keyword">break</span>;
    }
    <span class="keyword">return</span> <span class="literal">true</span>;
}
`            
          },
          {
            id: 3,
            title: "Snippet 3",
            code: `
<span class="keyword">public static</span> <span class="type">boolean</span> <span class="function">isMachineTypeDefined</span>(<span class="type">short</span> type) {
    <span class="keyword">if</span> (type == IMAGE_FILE_MACHINE_UNKNOWN) {
        <span class="comment">// Unsupported machine type</span>
        <span class="keyword">return</span> <span class="literal">false</span>;
    }
    <span class="keyword">for</span> (<span class="type">Field</span> field : CoffMachineType.<span class="function">class</span>.<a href="#" class="standard-method function" onclick="openJavadocModal('https://docs.oracle.com/javase/8/docs/api/java/lang/Class.html#getDeclaredFields--')">getDeclaredFields</a>()) {
        <span class="keyword">if</span> (!field.<a href="#" class="standard-method function" onclick="openJavadocModal('https://docs.oracle.com/javase/8/docs/api/java/lang/reflect/Field.html#isSynthetic--')">isSynthetic</a>()) {
            <span class="type">int</span> modifiers = field.<a href="#" class="standard-method function" onclick="openJavadocModal('https://docs.oracle.com/javase/8/docs/api/java/lang/reflect/Field.html#getModifiers--')">getModifiers</a>();
            <span class="keyword">if</span> (<a href="#" class="standard-method function" onclick="openJavadocModal('https://docs.oracle.com/javase/8/docs/api/java/lang/reflect/Modifier.html#isFinal-int-')">Modifier.isFinal</a>(modifiers) && <a href="#" class="standard-method function" onclick="openJavadocModal('https://docs.oracle.com/javase/8/docs/api/java/lang/reflect/Modifier.html#isStatic-int-')">Modifier.isStatic</a>(modifiers)) {
                <span class="keyword">try</span> {
                    <span class="keyword">if</span> (field.<a href="#" class="standard-method function" onclick="openJavadocModal('https://docs.oracle.com/javase/8/docs/api/java/lang/reflect/Field.html#getShort-java.lang.Object-')">getShort</a>(<span class="literal">null</span>) == type) {
                        <span class="keyword">return</span> <span class="literal">true</span>;
                    }
                } <span class="keyword">catch</span> (<span class="type">IllegalAccessException</span> e) {
                    <span class="keyword">continue</span>;
                }
            }
        }
    }
    <span class="keyword">return</span> <span class="literal">false</span>;
}
`            
          },
          {
            id: 4,
            title: "Snippet 4",
code: `<span class="keyword">public static</span> <span class="type">int</span> <span class="function">indexOfIgnoreCase</span>(<span class="type">CharSequence</span> str, <span class="type">CharSequence</span> searchStr, <span class="type">int</span> startPos) {
    <span class="keyword">if</span> (str == <span class="literal">null</span> || searchStr == <span class="literal">null</span>) {
        <span class="keyword">return</span> INDEX_NOT_FOUND;
    }
    <span class="keyword">if</span> (startPos < <span class="number">0</span>) {
        startPos = <span class="number">0</span>;
    }
    <span class="type">int</span> searchStrLen = searchStr.<a href="#" class="standard-method function" onclick="openJavadocModal('https://docs.oracle.com/javase/8/docs/api/java/lang/CharSequence.html#length--')">length</a>();
    <span class="type">int</span> endLimit = str.<a href="#" class="standard-method function" onclick="openJavadocModal('https://docs.oracle.com/javase/8/docs/api/java/lang/CharSequence.html#length--')">length</a>() - searchStrLen + <span class="number">1</span>;
    <span class="keyword">if</span> (startPos > endLimit) {
        <span class="keyword">return</span> INDEX_NOT_FOUND;
    }
    <span class="keyword">if</span> (searchStrLen == <span class="number">0</span>) {
        <span class="keyword">return</span> startPos;
    }
    <span class="keyword">for</span> (<span class="type">int</span> i = startPos; i < endLimit; i++) {
        <span class="keyword">if</span> (<span class="function">regionMatches</span>(str, <span class="literal">true</span>, i, searchStr, <span class="number">0</span>, searchStrLen)) {
            <span class="keyword">return</span> i;
        }
    }
    <span class="keyword">return</span> INDEX_NOT_FOUND;
}`
          },              
          {
            id: 5,
            title: "Snippet 5",
            code: `
<span class="keyword">public static</span> <span class="type">boolean</span> <span class="function">deleteRecursively</span>(@Nullable <span class="type">Path</span> root) <span class="keyword">throws</span> <span class="type">IOException</span> {
    <span class="keyword">if</span> (root == <span class="literal">null</span>) <span class="keyword">return</span> <span class="literal">false</span>;
    <span class="keyword">if</span> (!<a href="#" class="standard-method function" onclick="openJavadocModal('https://docs.oracle.com/javase/8/docs/api/java/nio/file/Files.html#exists-java.nio.file.Path-java.nio.file.LinkOption...-')">Files.exists</a>(root)) <span class="keyword">return</span> <span class="literal">false</span>;

    <a href="#" class="standard-method function" onclick="openJavadocModal('https://docs.oracle.com/javase/8/docs/api/java/nio/file/Files.html#walkFileTree-java.nio.file.Path-java.nio.file.FileVisitor-')">Files.walkFileTree</a>(root, <span class="keyword">new</span> <span class="type">SimpleFileVisitor</span>&lt;&gt;() {
        @Override
        <span class="keyword">public</span> <span class="type">FileVisitResult</span> <span class="function">visitFile</span>(<span class="type">Path</span> file, <span class="type">BasicFileAttributes</span> attrs) <span class="keyword">throws</span> <span class="type">IOException</span> {
            <a href="#" class="standard-method function" onclick="openJavadocModal('https://docs.oracle.com/javase/8/docs/api/java/nio/file/Files.html#delete-java.nio.file.Path-')">Files.delete</a>(file);
            <span class="keyword">return</span> FileVisitResult.CONTINUE;
        }
        @Override
        <span class="keyword">public</span> <span class="type">FileVisitResult</span> <span class="function">postVisitDirectory</span>(<span class="type">Path</span> dir, <span class="type">IOException</span> exc) <span class="keyword">throws</span> <span class="type">IOException</span> {
            <a href="#" class="standard-method function" onclick="openJavadocModal('https://docs.oracle.com/javase/8/docs/api/java/nio/file/Files.html#delete-java.nio.file.Path-')">Files.delete</a>(dir);
            <span class="keyword">return</span> FileVisitResult.CONTINUE;
        }
    });

    <span class="keyword">return</span> <span class="literal">true</span>;
}
`            
      },
      {
        id: 6,
        title: "Snippet 6",
        code: `
<span class="keyword">public static</span> <span class="type">int</span> <span class="function">encodedLength</span>(<span class="type">CharSequence</span> sequence) {
    <span class="comment">// Optimized implementation</span>
    <span class="type">int</span> utf16Length = sequence.<a href="#" class="standard-method function" onclick="openJavadocModal('https://docs.oracle.com/javase/8/docs/api/java/lang/CharSequence.html#length--')">length</a>();
    <span class="type">int</span> utf8Length = utf16Length;
    <span class="type">int</span> i = <span class="number">0</span>;

    <span class="keyword">while</span> (i < utf16Length && sequence.<a href="#" class="standard-method function" onclick="openJavadocModal('https://docs.oracle.com/javase/8/docs/api/java/lang/CharSequence.html#charAt-int-')">charAt</a>(i) < <span class="literal">0x80</span>) {
        i++;
    }

    <span class="keyword">for</span> (; i < utf16Length; i++) {
        <span class="type">char</span> c = sequence.<a href="#" class="standard-method function" onclick="openJavadocModal('https://docs.oracle.com/javase/8/docs/api/java/lang/CharSequence.html#charAt-int-')">charAt</a>(i);
        <span class="keyword">if</span> (c < <span class="literal">0x800</span>) {
            utf8Length += ((<span class="literal">0x7f</span> - c) >>> <span class="number">31</span>);
        } <span class="keyword">else</span> {
            utf8Length += <span class="function">encodedLengthGeneral</span>(sequence, i);
            <span class="keyword">break</span>;
        }
    }

    <span class="keyword">if</span> (utf8Length < utf16Length) {
        <span class="keyword">throw new</span> <span class="type">IllegalArgumentException</span>(
            <span class="string">"UTF-8 length does not fit in int: "</span> + (utf8Length + (<span class="literal">1L</span> << <span class="number">32</span>)));
    }

    <span class="keyword">return</span> utf8Length;
}
`        
      },
      {
        id: 7,
        title: "Snippet 7",
        code: `
<span class="keyword">public static</span> <span class="type">float</span> <span class="function">lowestPositiveRoot</span>(<span class="type">float</span> a, <span class="type">float</span> b, <span class="type">float</span> c) {
    <span class="type">float</span> det = b * b - <span class="number">4</span> * a * c;
    <span class="keyword">if</span> (det < <span class="number">0</span>) <span class="keyword">return</span> <span class="type">Float</span>.NaN;

    <span class="type">float</span> sqrtD = (<span class="type">float</span>)<span class="type">Math</span>.<a href="#" class="standard-method function" onclick="openJavadocModal('https://docs.oracle.com/javase/8/docs/api/java/lang/Math.html#sqrt-double-')">sqrt</a>(det);
    <span class="type">float</span> invA = <span class="number">1</span> / (<span class="number">2</span> * a);
    <span class="type">float</span> r1 = (-b - sqrtD) * invA;
    <span class="type">float</span> r2 = (-b + sqrtD) * invA;

    <span class="keyword">if</span> (r1 > r2) {
        <span class="type">float</span> tmp = r2;
        r2 = r1;
        r1 = tmp;
    }

    <span class="keyword">if</span> (r1 > <span class="number">0</span>) <span class="keyword">return</span> r1;
    <span class="keyword">if</span> (r2 > <span class="number">0</span>) <span class="keyword">return</span> r2;
    <span class="keyword">return</span> <span class="type">Float</span>.NaN;
}
`        
      },
      {
        id: 8,
        title: "Snippet 8",
        code: `
<span class="keyword">public static</span> <span class="type">float</span> <span class="function">atan2</span>(<span class="type">float</span> y, <span class="type">float</span> x) {
    <span class="type">float</span> n = y / x;

    <span class="keyword">if</span> (n != n)
        n = (y == x ? <span class="number">1f</span> : <span class="number">-1f</span>);
    <span class="keyword">else if</span> (n - n != n - n)
        x = <span class="number">0f</span>;

    <span class="keyword">if</span> (x > <span class="number">0</span>)
        <span class="keyword">return</span> <span class="function">atanUnchecked</span>(n);
    <span class="keyword">else if</span> (x < <span class="number">0</span>) {
        <span class="keyword">if</span> (y >= <span class="number">0</span>) <span class="keyword">return</span> <span class="function">atanUnchecked</span>(n) + PI;
        <span class="keyword">return</span> <span class="function">atanUnchecked</span>(n) - PI;
    } <span class="keyword">else if</span> (y > <span class="number">0</span>)
        <span class="keyword">return</span> x + HALF_PI;
    <span class="keyword">else if</span> (y < <span class="number">0</span>)
        <span class="keyword">return</span> x - HALF_PI;

    <span class="keyword">return</span> x + y;
}
`        
      }
    ];
  

  function getStoredSnippetOrder() {
    const stored = sessionStorage.getItem('snippetOrder') || localStorage.getItem('snippetOrder');
    if (stored) {
      try {
        const parsed = JSON.parse(stored);
        if (Array.isArray(parsed) && parsed.length === 8) return parsed;
      } catch {}
    }
    return null;
  }

  // Apply the stored snippet order
  const order = getStoredSnippetOrder();
  const snippets = [];

  if (order) {
    order.forEach((index, newId) => {
      snippet = { ...originalSnippets[index - 1] }; 
      snippet.id = newId + 1;
      snippet.title = `Snippet ${newId + 1}`;
      snippets.push(snippet);
    });
  } else {
    alert("‚ö†Ô∏è Missing snippet order. Please login again.");
    window.location.href = '/';
  }

  console.log("Applied snippet order:", snippets.map(s => s.title));

</script>
<script>
  window.onload = () => {
      remapSnippetReferences(participantRankings);
      renderParticipantRankings();
      render();
      loadCards();
      loadState();
      applyTheme();
      displayUserName();

    // ‚úÖ Restore Continue button if phase2Complete is already set
    const continueBtn = document.getElementById('continueBtn');
    if (sessionStorage.getItem('phase2Complete') === 'true' || localStorage.getItem('phase2Complete') === 'true') {
      if (continueBtn) {
        continueBtn.style.display = 'inline-block';
        continueBtn.style.backgroundColor = '#4CAF50';
        continueBtn.style.animation = 'glowPulse 1.5s infinite alternate';
      }
    }

    // Unlock and highlight status bar
    if (isComplete('phase1Complete')) document.getElementById('link-phase2').classList.remove('disabled');
    if (isComplete('phase2Complete')) document.getElementById('link-phase3').classList.remove('disabled');
    if (isComplete('phase3Complete')) document.getElementById('link-review').classList.remove('disabled');

    const current = window.location.pathname.split('/').pop();
    if (current.includes('phase1')) document.getElementById('link-phase1').classList.add('active');
    else if (current.includes('phase2')) document.getElementById('link-phase2').classList.add('active');
    else if (current.includes('phase3')) document.getElementById('link-phase3').classList.add('active');
    else if (current.includes('review')) document.getElementById('link-review').classList.add('active');

    if (sessionStorage.getItem('phase2Complete') === 'true' || localStorage.getItem('phase2Complete') === 'true') {
      document.getElementById('continueBtn').style.display = 'inline-block';
      document.getElementById('continueBtn').style.backgroundColor = '#4CAF50';
      document.getElementById('continueBtn').style.animation = 'glowPulse 1.5s infinite alternate';
    }

    setInterval(() => {
      try {
        saveToServer();
        console.log("[Auto-Save] Progress saved to server.");
      } catch (e) {
        console.warn("[Auto-Save] Failed to save:", e);
      }
    }, 120000); // every 2 minutes
  };

  function loadCards() {
    const container = document.getElementById('cards');
    snippets.forEach(snippet => {
      const card = document.createElement('div');
      card.className = 'card';
      card.draggable = true;
      card.id = `snippet-${snippet.id}`;
      card.innerHTML = `
          <strong>${snippet.title}</strong>
          <br><label><input type="checkbox" onchange="togglePreview(${snippet.id}, this)"> View</label>
        `;
      card.addEventListener('dragstart', () => card.classList.add('dragging'));
      card.addEventListener('dragend', () => card.classList.remove('dragging'));
      container.appendChild(card);
    });

    document.querySelectorAll('.ranking-slot').forEach(slot => {
      slot.addEventListener('dragover', e => {
        e.preventDefault();
        const dragging = document.querySelector('.dragging');
        if (dragging) slot.appendChild(dragging);
        saveState();
      });
    });
  }

  function togglePreview(id, checkbox) {
    const previewArea = document.getElementById('previewArea');
    const snippet = snippets.find(s => s.id === id);
    const existing = document.getElementById(`preview-${id}`);

    if (checkbox.checked && !existing) {
      const wrapper = document.createElement('div');
      wrapper.id = `preview-${id}`;
      wrapper.className = 'snippet-preview-box';

      const header = document.createElement('div');
      header.className = 'snippet-header';
      header.textContent = snippet.title;

      const codeBox = document.createElement('div');
      codeBox.className = 'code-box';
      codeBox.innerHTML = snippet.code;

      wrapper.appendChild(header);
      wrapper.appendChild(codeBox);
      previewArea.appendChild(wrapper);
    } else if (!checkbox.checked && existing) {
      previewArea.removeChild(existing);
    }
  }

  function saveState() {
    const positions = {};
    document.querySelectorAll('.ranking-slot').forEach((slot, index) => {
      positions[index + 1] = Array.from(slot.children).map(el => el.id);
    });
    const json = JSON.stringify(positions);
    sessionStorage.setItem('phase3_ranking', json);
    document.cookie = `phase3_ranking=${encodeURIComponent(json)}; path=/; max-age=${60 * 60 * 24 * 30}`;

    /* Check if the phase is completed */
    if (areAllCardsRanked()) {
      document.getElementById('continueBtn').style.display = 'inline-block';
      document.getElementById('continueBtn').style.backgroundColor = '#4CAF50';
      document.getElementById('continueBtn').style.animation = 'glowPulse 1.5s infinite alternate';
      sessionStorage.setItem('phase2Complete', 'true');
      document.cookie = `phase2Complete=true; path=/; max-age=${60 * 60 * 24 * 30}`;

      // ‚úÖ Also update the status bar
      const phase3Link = document.getElementById('link-phase3');
      if (phase3Link) {
        phase3Link.classList.remove('disabled');
      }
    } else {
      sessionStorage.removeItem('phase2Complete');
      document.cookie = `phase2Complete=; path=/; max-age=0`;
      document.getElementById('continueBtn').style.display = 'none';
      const phase3Link = document.getElementById('link-phase3');
      if (phase3Link) {
        phase3Link.classList.add('disabled');
      }
    }

  }

  function loadState() {
    let saved = sessionStorage.getItem('phase3_ranking') || localStorage.getItem('phase3_ranking');


    if (!saved) return;

    try {
      const parsed = JSON.parse(saved);  // now valid JSON
      Object.entries(parsed).forEach(([rank, ids]) => {
        const slot = document.querySelector(`.ranking-slot[data-rank='${rank}']`);
        ids.forEach(id => {
          const el = document.getElementById(id);
          if (el && slot) slot.appendChild(el);
        });
      });
    } catch (e) {
      console.error('Failed to parse phase3_ranking JSON:', e);
    }
  }


  function toggleTheme() {
    const body = document.body;
    const isDark = body.classList.contains('dark-mode');

    if (isDark) {
      body.classList.remove('dark-mode');
      localStorage.setItem('codeTheme', 'light');
      document.getElementById('theme-toggle').textContent = 'Switch to Dark Mode';
    } else {
      body.classList.add('dark-mode');
      localStorage.setItem('codeTheme', 'dark');
      document.getElementById('theme-toggle').textContent = 'Switch to Light Mode';
    }
  }

  function applyTheme() {
    const theme = localStorage.getItem('codeTheme') || 'light';
    const btn = document.getElementById('theme-toggle');

    if (theme === 'dark') {
      document.body.classList.add('dark-mode');
      if (btn) btn.textContent = 'Switch to Light Mode';
    } else {
      document.body.classList.remove('dark-mode');
      if (btn) btn.textContent = 'Switch to Dark Mode';
    }
  }

  function goToPhase3() {
    if (areAllCardsRanked()) {
      location.href = '/phase3-recap.html';
    } else { showValidationMessage("‚ö†Ô∏è Please rank all snippets") };
  }

  /*For the instructions section*/
  function toggleInstructions() {
    const content = document.getElementById("instructions-content");
    const button = event.target;

    if (content.style.display === "none") {
      content.style.display = "block";
      button.textContent = "Hide";
    } else {
      content.style.display = "none";
      button.textContent = "Show";
    }
  }

  function getLocalStorage(name) {
    const match = document.cookie.match(new RegExp('(^| )' + name + '=([^;]+)'));
    return match ? decodeURIComponent(match[2]) : null;
  }

  function isComplete(key) {
    return sessionStorage.getItem(key) === 'true' || localStorage.getItem(key) === 'true';
  }

  function areAllCardsRanked() {
    const allCards = document.querySelectorAll('.card');
    const assignedCardIds = new Set();

    document.querySelectorAll('.ranking-slot').forEach(slot => {
      slot.querySelectorAll('.card').forEach(card => {
        assignedCardIds.add(card.id);
      });
    });

    return allCards.length === assignedCardIds.size;
  }


</script>

<script>
  function displayUserName() {
    const name = sessionStorage.getItem('participantName') || localStorage.getItem('participantName');
    if (name) {
      document.getElementById('user-info').textContent = `üë§ ${name}`;
    }
  }
</script>

<script>
  function isLoggedIn() {
    const name = sessionStorage.getItem('participantName') || localStorage.getItem('participantName');
    const order = sessionStorage.getItem('snippetOrder') || localStorage.getItem('snippetOrder');
    return name && order;
  }

  function checkLogin() {
    if (!isLoggedIn()) {
      alert('You must be logged in to access this page. Redirecting to the homepage.');
      window.location.href = 'https://codecomprehensibility.site/';
    }
  }

  function checkPhase1Completion() {
    if (!isPhaseComplete('phase1Complete')) {
      alert('Please complete Phase 1 before continuing.');
      window.location.href = 'phase1-recap.html';
    }
  }

  function isPhaseComplete(phaseKey) {
    const sessionVal = sessionStorage.getItem(phaseKey);
    const cookieVal = localStorage.getItem(phaseKey);
    return sessionVal === 'true' || cookieVal === 'true';
  }

  window.addEventListener('load', checkLogin);
  window.addEventListener('load', checkPhase1Completion);
</script>


<script>
  // Toggle logout menu visibility
  // document.addEventListener('DOMContentLoaded', () => {
  //   const userInfo = document.getElementById('user-info');
  //   const logoutMenu = document.getElementById('logout-menu');

  //   userInfo.addEventListener('click', () => {
  //     logoutMenu.style.display = logoutMenu.style.display === 'block' ? 'none' : 'block';
  //   });

  //   // Hide the menu if clicked outside
  //   document.addEventListener('click', (event) => {
  //     if (!event.target.closest('.user-dropdown')) {
  //       logoutMenu.style.display = 'none';
  //     }
  //   });
  // });

  // Clear storage and redirect to login
  function logout() {
    sessionStorage.clear();
    localStorage.clear();


    // Clear all cookies
    document.cookie.split(";").forEach(cookie => {
      const name = cookie.split("=")[0].trim();
      document.cookie = `${name}=; expires=Thu, 01 Jan 1970 00:00:00 UTC; path=/;`;
    });

    window.location.href = 'index.html';
  }
</script>

<script>
  function saveToServer() {
    const name = sessionStorage.getItem('participantName') || getLocalStorage('participantName') || 'Anonymous';
    const username = getLocalStorage('username') || 'anonymous';

    // Phase 1 data
    const phase1 = {};
    for (let i = 1; i <= 8; i++) {
      const summary = sessionStorage.getItem(`summary${i}`) || getLocalStorage(`summary${i}`) || '';
      const comp = sessionStorage.getItem(`compSummary${i}`) || getLocalStorage(`compSummary${i}`) || '';
      phase1[`snippet${i}`] = { summary, comprehensibility: comp };
    }

    // Phase 2 & 3 data
    let phase2 = {}, phase3 = {};
    try {
      phase2 = JSON.parse(sessionStorage.getItem('phase3_ranking') || getLocalStorage('phase3_ranking') || '{}');
      phase3 = JSON.parse(sessionStorage.getItem('phase3_reasoning') || getLocalStorage('phase3_reasoning') || '{}');
    } catch (e) {
      console.warn("Error parsing phase2 or phase3 data", e);
    }

    // Completion flags and theme
    const flags = {
      phase1Complete: sessionStorage.getItem('phase1Complete') || getLocalStorage('phase1Complete') || 'false',
      phase2Complete: sessionStorage.getItem('phase2Complete') || getLocalStorage('phase2Complete') || 'false',
      phase3Complete: sessionStorage.getItem('phase3Complete') || getLocalStorage('phase3Complete') || 'false',
      codeTheme: localStorage.getItem('codeTheme') || 'light',
      submitted: '0',
    };

    const payload = {
      username,
      participantName: name,
      phase1,
      phase2,
      phase3,
      ...flags
    };

    const blob = new Blob([JSON.stringify(payload)], { type: 'application/json' });
    navigator.sendBeacon('https://codecomprehensibility.site/submit_final', blob);

    console.log(payload);
  }

  window.addEventListener('beforeunload', function (e) {
    saveToServer();
  });


</script>

<script>
function remapSnippetReferences(rankings) {
  console.log('sessionStorage:', sessionStorage.getItem('snippetOrder'));
  console.log('cookie:', document.cookie);

  if (!Array.isArray(rankings)) {
    console.error('remapSnippetReferences: rankings is not a valid array.');
    return;
  }

  // Get snippet order from sessionStorage or cookies
  function getSnippetOrder() {
    const key = 'snippetOrder';
    const sessionValue = sessionStorage.getItem(key) || localStorage.getItem(key);
    if (sessionValue) return JSON.parse(sessionValue);

    const cookieMatch = document.cookie
      .split('; ')
      .find(row => row.startsWith(key + '='));
    if (cookieMatch) {
      const cookieValue = decodeURIComponent(cookieMatch.split('=')[1]);
      return JSON.parse(cookieValue);
    }
    return [];
  }

  const snippetOrder = getSnippetOrder();
  if (!Array.isArray(snippetOrder) || snippetOrder.length !== 8) {
    console.warn('Invalid or missing snippetOrder:', snippetOrder);
    return;
  }

  // Reverse mapping: actual snippet number ‚Üí new visual snippet #
  const map = {};
  for (let i = 0; i < 8; i++) {
    map[snippetOrder[i]] = i + 1;
  }

  rankings.forEach(participant => {
    let updated = participant.html;

    // Replace Snippet X (text label)
    updated = updated.replace(/\bSnippet (\d)\b/g, (_, num) => {
      const mapped = map[parseInt(num)];
      return `Snippet ${mapped}`;
    });

    // Replace show_snippet(X)
    updated = updated.replace(/show_snippet\((\d)\)/g, (_, num) => {
      const mapped = map[parseInt(num)];
      return `show_snippet(${mapped})`;
    });

    // Replace compare([X,...],[Y,...])
    updated = updated.replace(/compare\(\[([^\]]*)\],\s*\[([^\]]*)\]\)/g, (_, group1, group2) => {
      const mapGroup = g =>
        g.split(',')
         .map(x => {
           const trimmed = x.trim();
           return trimmed ? map[parseInt(trimmed)] : '';
         })
         .filter(x => x !== '')
         .join(',');
      return `compare([${mapGroup(group1)}], [${mapGroup(group2)}])`;
    });

    participant.html = updated;
  });
}


function renderParticipantRankings() {
  const container = document.querySelector('.phase-section');
  if (!container) {
    console.error('No .phase-section container found.');
    return;
  }

  container.innerHTML = ''; // Clear existing content

  const currentUser = (sessionStorage.getItem('username') || getCookie('username') || '').trim().toLowerCase();

  let yourHTML = '';
  const others = [];

  participantRankings.forEach(participant => {
    const participantName = participant.name.trim();
    const isCurrentUser = participantName.toLowerCase() === currentUser;

    const updatedHTML = participant.html.replace(
      new RegExp(`<h3>${participantName}</h3>`),
      `<h3>${isCurrentUser ? 'Your Ranking' : participantName}</h3>`
    );

    if (isCurrentUser) {
      yourHTML = updatedHTML;
    } else {
      others.push(updatedHTML);
    }
  });

  // Append your ranking first
  if (yourHTML) {
    const yourWrapper = document.createElement('div');
    yourWrapper.innerHTML = yourHTML;
    container.appendChild(yourWrapper);
  }

  // Append others
  others.forEach(html => {
    const wrapper = document.createElement('div');
    wrapper.innerHTML = html;
    container.appendChild(wrapper);
  });
}


</script>

<script>
      function show_snippet(id) {
        // id=id-1;
    const snippet = snippets.find(s => s.id === id);
    if (!snippet) return;

    document.getElementById('modal-snippet-title').innerText = snippet.title;

    const codeLines = snippet.code.trim().split('\n');

    // ‚úÖ Use innerHTML here to render styled spans correctly
    document.getElementById('modal-code-content').innerHTML = codeLines.join('\n');

    // ‚úÖ Line numbers are just plain numbers
    document.getElementById('modal-line-numbers').innerHTML = codeLines.map((_, i) => i + 1).join('<br>');

    document.getElementById('snippet-modal').style.display = 'block';

    applyModalTheme(); // Keep the theme consistent
    }

    
    function toggleModalTheme() {
      const body = document.body;
      const isLight = body.classList.contains("light-mode");
    
      if (isLight) {
        body.classList.remove("light-mode");
        body.classList.add("dark-mode");
        localStorage.setItem("codeTheme", "dark");
        document.getElementById('modal-theme-toggle').textContent = "Switch to Light Mode";
      } else {
        body.classList.remove("dark-mode");
        body.classList.add("light-mode");
        localStorage.setItem("codeTheme", "light");
        document.getElementById('modal-theme-toggle').textContent = "Switch to Dark Mode";
      }
    }
    
    function applyModalTheme() {
      const theme = localStorage.getItem('codeTheme') || 'light';
      document.body.classList.remove('light-mode', 'dark-mode');
      document.body.classList.add(theme + '-mode');
      document.getElementById('modal-theme-toggle').textContent =
        theme === 'light' ? "Switch to Dark Mode" : "Switch to Light Mode";
    }


</script>

<script>
      function compare(leftIds, rightIds) {
  const leftContainer = document.getElementById('compare-left');
  const rightContainer = document.getElementById('compare-right');
  leftContainer.innerHTML = '';
  rightContainer.innerHTML = '';

  const getSnippet = id => snippets.find(s => s.id === id);

  // Left side: stacked
  leftIds.forEach(id => {
    const snippet = getSnippet(id);
    if (snippet) {
      const box = document.createElement('div');
      box.className = 'snippet-box';
      box.innerHTML = `<h4>${snippet.title}</h4><pre class="code-content">${snippet.code}</pre>`;
      leftContainer.appendChild(box);
    }
  });

  // Right side: stacked
  rightIds.forEach(id => {
    const snippet = getSnippet(id);
    if (snippet) {
      const box = document.createElement('div');
      box.className = 'snippet-box';
      box.innerHTML = `<h4>${snippet.title}</h4><pre class="code-content">${snippet.code}</pre>`;
      rightContainer.appendChild(box);
    }
  });

  document.getElementById('compare-modal').style.display = 'block';
}
</script>

 <script>
    const disagreements = [
      {
        snippet: 3,
        text: `Snippet 3 (isMachineTypeDefined) appears to be a point of disagreement among the experts.
* Oscar ranked it as one of the easiest (Position 1), describing it as having straightforward logic. He noted that the presence of nested if statements or loops did not make it harder to understand. However, in his detailed comments, he did mention that it was unclear what a "synthetic field" is, and that the snippet might be harder to understand for someone unfamiliar with the constants used.
* Nadeeshan placed it in Position 4, stating that it was relatively hard to understand due to unfamiliarity with CoffMachineType. He emphasized that the snippet needs more context to be understood, and highlighted an unusual use of a getter with an argument ‚Äî specifically pointing to a line where null is passed, which he found unnecessary and confusing.
* Martin, who placed it in Position 6, noted that the method required bottom-up reasoning, meaning it was necessary to carefully examine each line to figure out what the method was doing. He pointed to the use of Java‚Äôs reflective features and the unclear nature of the type variable (possibly representing a non-standard enumeration) as contributing factors to its complexity. He also remarked that the overall purpose of the method was not easily discernible from the code alone.`
      },
      {
        snippet: 2,
        text: `Snippet 2 (isRemote) appears to be a point of partial disagreement among the experts.
* Nadeeshan considers it easy to understand and places it in the easiest position, alongside Snippet 1. He believes it has a meaningful method name, clear internal method invocations, and a straightforward switch statement.
* Oscar also finds the snippet relatively easy, but slightly more difficult than Snippet 1 (isValidProjectName). He expressed uncertainty about the meaning of isFilesystemPath and the use of the URI scheme, stating:
‚ÄúI am not familiar with a URI's scheme and why implementing that logic (in Snippet 2) is enough to check if it is remote.‚Äù
* Martin also places Snippet 2 in Position 1 (easiest) and describes it as generally clear. He notes:
‚ÄúThere are some subtleties here (how do we know that 'jar' and 'file' are the only URI schemes that are not remote? I think that's domain knowledge...), but overall the purpose is clear and easy to understand from the code's structure.‚Äù However, unlike Nadeeshan and Oscar, Martin ranked Snippet 1 slightly lower, placing it in Position 2, indicating that he finds Snippet 2 just a bit easier due to its shorter and simpler set of rules.`
      },
      {
        snippet: 7,
        text: `Snippet 7 (lowestPositiveRoot) also caused disagreement among the experts.
* Martin considers it moderately difficult and placed it in the middle (Position 4), grouped with Snippet 4. He explained:
‚ÄúThese two snippets are moderately complex string and float algorithms, respectively. I don't differentiate between them, since both are tricky to get right but are doing something pretty well understood.‚Äù
He also noted that Snippet 7 ‚Äúcalls back to grade school math pretty aggressively (e.g., through naming its parameters a, b, and c), and that makes it easier to understand the overall purpose by recognizing the quadratic formula. The swap block (lines 10‚Äì14) is also an easily recognizable pattern to swap via a temporary variable. Overall, then, this is relatively straightforward.‚Äù
* Oscar placed this snippet slightly earlier (Position 3) and commented:
‚ÄúEasy after remembering the formula; logic is clear with basic math review.‚Äù
* Nadeeshan, however, ranked Snippet 7 as the most difficult (Position 8). He found the method name misleading and the logic unclear, even after testing it with dummy values. He wrote:
‚ÄúSnippet 7‚Äôs logic is in contradiction with the method name. I thought it returns the lowest positive root from three numbers, but line 2 is unclear.‚Äù`
      },
      {
        snippet: 5,
        text: `Snippet 5 (deleteRecursively) is another point of disagreement among the experts.
* Oscar placed it in the easiest position (Position 1). He stated that he is ‚Äúfamiliar with the visitor pattern‚Äù and that ‚Äúidentifiers help clarify‚Äù. He described the snippet as having straightforward logic and noted that it was hard for him to distinguish between Snippets 1, 3, and 5 in terms of comprehensibility, as all seemed similarly clear to him.
* Nadeeshan, who placed it in Position 6, described it as:
‚ÄúHarder due to unclear postVisitDirectory. Assumes dir is a Path object passed from FileVisitor.‚Äù
However, he also acknowledged that ‚ÄúSnippet 5 has clear logic.‚Äù
This suggests that while the overall intent was understandable, specific implementation details (e.g., method assumptions and API context) made it more difficult for him.
* Martin placed Snippet 5 in Position 5 and offered a nuanced perspective:
‚ÄúThis was easy for me to understand, but it required domain-specific knowledge of how Java handles file system operations that I do have: I immediately recognized the structure of the walkFileTree call with the anonymous visitor, and knew that I only needed to look at the names of the overridden methods and their bodies (i.e., lines 8 and 13) to figure out what the method does.‚Äù
He also grouped this snippet with Snippets 4 and 7, noting:
‚ÄúThese three snippets are actually pretty similar: all are implementations of some kind of simple specification that's a bit tricky to get right in practice.‚Äù`
      },
      {
        snippet: 8,
        text: `There is a small disagreement among the experts regarding the ranking of Snippet 8 (atan2).
* Nadeeshan, unlike the others who placed this snippet in Position 8 (hardest), ranked it in Position 5. He considered it to be easier to understand than Snippets 6 (encodedLength) and 7 (lowestPositiveRoot).
However, he also acknowledged its difficulty, describing it as:
‚ÄúDifficult due to math background required and unclear method purpose.‚Äù
This suggests that while he found it conceptually challenging, he still viewed it as more comprehensible than snippets that involved domain-specific programming knowledge or misleading logic.
* Oscar and Martin both ranked Snippet 8 as the most difficult (Position 8). Oscar noted:
‚ÄúFor obvious reasons, atan2 is harder to understand: I don't remember how atan works, the code contains cryptic instructions, and I don't know what atanUnchecked is doing ‚Äî also, the identifiers here don't help.‚Äù
* Martin shared a similar view, stating that the snippet requires two kinds of domain-specific knowledge ‚Äî numerical methods and trigonometry ‚Äî as opposed to just one in Snippet 6, which focuses on encoding.`
      }
    ];

    const username = localStorage.getItem("username") || "anonymous";
    const snippetOrder = JSON.parse(sessionStorage.getItem('snippetOrder') || localStorage.getItem('snippetOrder') || '[]');

    let index = 0;

    function personalizeText(text, originalSnippetNumber) {
      const dynamicSnippetNum = snippetOrder ? snippetOrder.indexOf(originalSnippetNumber) + 1 : originalSnippetNumber;
      return text
        .replaceAll(`Snippet ${originalSnippetNumber}`, `Snippet ${dynamicSnippetNum}`)
        .replace(/\b(Oscar|Martin|Nadeeshan)\b/g, name => name.toLowerCase() === username.toLowerCase() ? 'you' : name);
    }


    const round2Responses = disagreements.map((_, i) => {
    const key = `round2_response_${i}`;
    const raw = sessionStorage.getItem(key) || localStorage.getItem(key);
    try {
        return raw ? JSON.parse(raw) : {};
    } catch {
        return {};
    }
    });



    function personalize(text, username, snippetMap) {
    const nameMap = {
        'Oscar': 'Oscar',
        'Martin': 'Martin',
        'Nadeeshan': 'Nadeeshan'
    };

    // Replace name with "you" if username matches
    Object.keys(nameMap).forEach(name => {
        const regex = new RegExp(`\\b${name}\\b`, 'g');
        if (username.toLowerCase() === name.toLowerCase()) {
        text = text.replace(regex, 'you');
        }
    });

    // Replace "Snippet X" with local snippet number
    for (let originalId = 1; originalId <= 8; originalId++) {
        const localId = snippetMap[originalId];
        const regex = new RegExp(`Snippet ${originalId}\\b`, 'g');
        text = text.replace(regex, `Snippet ${localId}`);
    }

    return text;
    }


    function getLocalSnippetMapping() {
        const stored = sessionStorage.getItem('snippetOrder') || localStorage.getItem('snippetOrder');
        if (!stored) return null;

        try {
            const parsed = JSON.parse(stored); // e.g., [3,1,4,7,8,2,6,5]
            const mapping = {};
            parsed.forEach((originalId, localIndex) => {
            mapping[originalId] = localIndex + 1; // original ID -> local snippet number
            });
            return mapping;
        } catch (e) {
            console.error("Failed to parse snippetOrder:", e);
            return null;
        }
    }


    function getRound2Response(i) {
        const key = `round2_response_${i}`;
        const raw = sessionStorage.getItem(key) || localStorage.getItem(key);
        try {
            return raw ? JSON.parse(raw) : {};
        } catch {
            return {};
        }
    }


    function render() {
        const container = document.getElementById('disagreement-box');
        const entry = disagreements[index];
        const localSnippets = getLocalSnippetMapping();
        const username = sessionStorage.getItem('participantName') || localStorage.getItem('participantName') || 'anonymous';

        container.innerHTML = `
            <div class="disagreement-text" style="margin-bottom: 20px;">
            ${personalize(entry.text, username, localSnippets)}
            </div>
        `;

        const questionsContainer = document.getElementById('question-box');

        questionsContainer.innerHTML = `
          <div>
            <label><strong>1. Do any of your fellow experts' concerns resonate with you?</strong></label><br>
            <textarea id="q1" placeholder="Your response..."></textarea>
          </div>

          <div>
            <label><strong>2. Has their feedback changed or clarified your understanding of the snippet?</strong></label><br>
            <textarea id="q2" placeholder="Your response..."></textarea>
          </div>

          <div>
            <label><strong>3. Would you consider changing your ranking for this snippet after reviewing all the feedback?</strong></label><br>
            <textarea id="q3" placeholder="Your response..."></textarea>
          </div>
        `;


        // Restore saved answers
        const saved = getRound2Response(index);
        document.getElementById('q1').value = saved.q1 || '';
        document.getElementById('q2').value = saved.q2 || '';
        document.getElementById('q3').value = saved.q3 || '';

        // ‚úÖ Show/hide previous button
        document.getElementById('prevBtn').style.display = index === 0 ? 'none' : 'inline-block';
        }




    function next() {
        const q1 = document.getElementById('q1').value.trim();
        const q2 = document.getElementById('q2').value.trim();
        const q3 = document.getElementById('q3').value.trim();

        if (!q1 || !q2 || !q3) {
            showValidationMessage("‚ö†Ô∏è Please answer all three questions before continuing.");
            return;
        }

        saveRound2Response(index, { q1, q2, q3 });

        if (index < disagreements.length - 1) {
            index++;
            render();
        } else {
            window.location.href = 'phase2.html';
        }
    }


    function prev() {
        const q1 = document.getElementById('q1').value.trim();
        const q2 = document.getElementById('q2').value.trim();
        const q3 = document.getElementById('q3').value.trim();

        // Save current responses before moving back
        saveRound2Response(index, { q1, q2, q3 });

        if (index > 0) {
            index--;
            render();
        }
    }



  </script>
  <script>
    function saveRound2Response(stepIndex, responseObj) {
        const key = `round2_response_${stepIndex}`;
        const json = JSON.stringify(responseObj);

        sessionStorage.setItem(key, json);
        document.cookie = `${key}=${encodeURIComponent(json)}; path=/; max-age=${60 * 60 * 24 * 30}`;
    }
  </script>

<script>
    function showValidationMessage(msg) {
      alert(msg); // You can replace this with a styled modal if you prefer
    }
</script>
  
<script>
      function loadCards() {
      const container = document.getElementById('cards');
      snippets.forEach(snippet => {
        const card = document.createElement('div');
        card.className = 'card';
        card.draggable = true;
        card.id = `snippet-${snippet.id}`;
        card.innerHTML = `
          <strong>${snippet.title}</strong>
          <br><label><input type="checkbox" onchange="togglePreview(${snippet.id}, this)"> View</label>
        `;
        card.addEventListener('dragstart', () => card.classList.add('dragging'));
        card.addEventListener('dragend', () => card.classList.remove('dragging'));
        container.appendChild(card);
      });

      document.querySelectorAll('.ranking-slot').forEach(slot => {
        slot.addEventListener('dragover', e => {
          e.preventDefault();
          const dragging = document.querySelector('.dragging');
          if (dragging) slot.appendChild(dragging);
          saveState();
        });
      });
    }

    function loadState() {
      let saved = sessionStorage.getItem('phase3_ranking') || localStorage.getItem("phase3_ranking");

      if (!saved) {
        const cookieMatch = document.cookie.match(/(?:^|; )phase3_ranking=([^;]*)/);
        if (cookieMatch) {
          saved = decodeURIComponent(cookieMatch[1]);  // ‚úÖ decode before parsing
          sessionStorage.setItem('phase3_ranking', saved);
        }
      }

      if (!saved) return;

      try {
        const parsed = JSON.parse(saved);  // now valid JSON
        Object.entries(parsed).forEach(([rank, ids]) => {
          const slot = document.querySelector(`.ranking-slot[data-rank='${rank}']`);
          ids.forEach(id => {
            const el = document.getElementById(id);
            if (el && slot) slot.appendChild(el);
          });
        });
      } catch (e) {
        console.error('Failed to parse phase3_ranking JSON:', e);
      }
    } 
</script>

<script>
      function saveState() {
      const positions = {};
      document.querySelectorAll('.ranking-slot').forEach((slot, index) => {
        positions[index + 1] = Array.from(slot.children).map(el => el.id);
      });
      const json = JSON.stringify(positions);
      sessionStorage.setItem('phase3_ranking', json);
      document.cookie = `phase3_ranking=${encodeURIComponent(json)}; path=/; max-age=${60 * 60 * 24 * 30}`;

      /* Check if the phase is completed */
      if (areAllCardsRanked()) {
        document.getElementById('continueBtn').style.display = 'inline-block';
        document.getElementById('continueBtn').style.backgroundColor = '#4CAF50';
        document.getElementById('continueBtn').style.animation = 'glowPulse 1.5s infinite alternate';
        sessionStorage.setItem('phase2Complete', 'true');
        document.cookie = `phase2Complete=true; path=/; max-age=${60 * 60 * 24 * 30}`;

        // ‚úÖ Also update the status bar
        const phase3Link = document.getElementById('link-phase3');
        if (phase3Link) {
          phase3Link.classList.remove('disabled');
        }
      } else {
        sessionStorage.removeItem('phase2Complete');
        document.cookie = `phase2Complete=; path=/; max-age=0`;
        document.getElementById('continueBtn').style.display = 'none';
        const phase3Link = document.getElementById('link-phase3');
        if (phase3Link) {
          phase3Link.classList.add('disabled');
        }
      }

    }
</script>

<script>
      function show_snippet(id) {
    const snippet = snippets.find(s => s.id === id);
    if (!snippet) return;

    document.getElementById('modal-snippet-title').innerText = snippet.title;

    const codeLines = snippet.code.trim().split('\n');

    // ‚úÖ Use innerHTML here to render styled spans correctly
    document.getElementById('modal-code-content').innerHTML = codeLines.join('\n');

    // ‚úÖ Line numbers are just plain numbers
    document.getElementById('modal-line-numbers').innerHTML = codeLines.map((_, i) => i + 1).join('<br>');

    document.getElementById('snippet-modal').style.display = 'block';

    applyModalTheme(); // Keep the theme consistent
    }

    
    function toggleModalTheme() {
      const body = document.body;
      const isLight = body.classList.contains("light-mode");
    
      if (isLight) {
        body.classList.remove("light-mode");
        body.classList.add("dark-mode");
        localStorage.setItem("codeTheme", "dark");
        document.getElementById('modal-theme-toggle').textContent = "Switch to Light Mode";
      } else {
        body.classList.remove("dark-mode");
        body.classList.add("light-mode");
        localStorage.setItem("codeTheme", "light");
        document.getElementById('modal-theme-toggle').textContent = "Switch to Dark Mode";
      }
    }
    
    function applyModalTheme() {
      const theme = localStorage.getItem('codeTheme') || 'light';
      document.body.classList.remove('light-mode', 'dark-mode');
      document.body.classList.add(theme + '-mode');
      document.getElementById('modal-theme-toggle').textContent =
        theme === 'light' ? "Switch to Dark Mode" : "Switch to Light Mode";
    }
</script>

<script>
  function togglePhaseSection() {
    const content = document.getElementById("phase-section-content");
    const button = document.querySelector(".phase-wrapper .toggle-btn");

    if (content.style.display === "none") {
      content.style.display = "block";
      button.textContent = "Hide";
    } else {
      content.style.display = "none";
      button.textContent = "Show";
    }
  }

</script>
<footer
  style="margin-top: 40px; padding-top: 20px; border-top: 1px solid #ccc; text-align: center; font-size: 14px; color: #666;">
  Please contact us if you have any questions or issues: <a href="mailto:ea442@njit.edu">ea442@njit.edu</a>
</footer>
</body>
</html>
