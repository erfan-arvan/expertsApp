<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>Phase 3: Reflect on Expert Disagreements</title>
  <style>
    body {
      font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
      margin: 0 40px 40px 40px;
      /* top right bottom left */
      background-color: #f4f4f4;
      color: #333;
    }
  
    .instructions {
      background-color: #fff;
      padding: 20px;
      border-radius: 8px;
      margin-bottom: 20px;
      box-shadow: 0 2px 8px rgba(0, 0, 0, 0.1);
    }
  
    .ranking-row {
      display: flex;
      gap: 10px;
      overflow-x: visible;
      margin-bottom: 10px;
    }
  
    .ranking-row-numbers {
      display: flex;
      gap: 10px;
      margin-bottom: 0;
    }

    .ranking-number {
      flex: 1;
      text-align: center;
      color: #009999;
    }
  
    .card {
      background: #fff;
      border: 1px solid #ccc;
      border-radius: 6px;
      padding: 8px;
      margin: 5px;
      cursor: grab;
    }
  
    .card.dragging {
      opacity: 0.5;
    }
  
    .preview-area {
      display: flex;
      gap: 20px;
      flex-wrap: wrap;
      margin-top: 20px;
    }
  
    .snippet-preview-box {
      flex: 1 1 45%;
      min-width: 300px;
      border-radius: 8px;
      overflow: hidden;
      box-shadow: 0 2px 8px rgba(0, 0, 0, 0.1);
      background-color: #ffffff;
      border: 1px solid #ddd;
    }
  
    .snippet-header {
      background-color: #f5f5f5;
      padding: 10px 15px;
      font-weight: bold;
      font-size: 16px;
      border-bottom: 1px solid #ccc;
    }
  
    .code-box {
      font-family: 'Courier New', Courier, monospace;
      white-space: pre-wrap;
      overflow-x: auto;
      padding: 15px;
      font-size: 14px;
      color: #333;
      background-color: #f9f9f9;
    }
  
    #theme-toggle {
      background-color: #333;
      color: white;
      border: none;
      padding: 6px 12px;
      border-radius: 5px;
      cursor: pointer;
      margin-bottom: 20px;
    }
  
    #continueBtn {
      background-color: #4CAF50;
      color: white;
      border: none;
      padding: 12px 24px;
      font-size: 16px;
      border-radius: 6px;
      cursor: pointer;
      box-shadow: 0 0 10px #4CAF50;
    }
  
    #continueBtn:hover {
      background-color: #45a049;
      animation: glowPulse 1.5s infinite alternate;
    }
  
    @keyframes glowPulse {
      0% {
        box-shadow: 0 0 10px #4CAF50;
      }
  
      100% {
        box-shadow: 0 0 20px #4CAF50, 0 0 30px #4CAF50;
      }
    }
  
    /*.status-bar {
        background-color: #333;
        color: white;
        padding: 10px 20px;
        display: flex;
        justify-content: center;
        gap: 30px;
        margin-top: 0;
        position: static; 
      }*/
  
    .status-bar {
      background-color: #333;
      color: white;
      padding: 10px 20px;
      display: flex;
      justify-content: center;
      gap: 30px;
      position: fixed;
      top: 0;
      left: 0;
      right: 0;
      z-index: 1000;
    }
  
    .phase-link {
      color: white;
      text-decoration: none;
      font-weight: bold;
      padding: 8px 12px;
      border-radius: 4px;
      transition: background-color 0.2s;
    }
  
    .phase-link:hover:not(.disabled) {
      background-color: #4CAF50;
    }
  
    .phase-link.active {
      background-color: #4CAF50;
    }
  
    .phase-link.disabled {
      pointer-events: none;
      opacity: 0.5;
      cursor: not-allowed;
    }
  
    /*For snippet cards*/
    #cards {
      display: flex;
      gap: 8px;
      overflow-x: auto;
      padding: 10px 0;
      flex-wrap: nowrap;
    }
  
    button {
      padding: 10px 20px;
      margin-right: 10px;
      font-size: 16px;
      border: none;
      border-radius: 5px;
      background-color: #4CAF50;
      color: white;
      cursor: pointer;
    }
  
    button:hover {
      background-color: #45a049;
    }
  
    button[disabled] {
      background-color: #888;
      cursor: not-allowed;
    }
  
    /*dark/light mode*/
    /* Light mode preview styles */
    /* === Default (light mode) === */
    .card {
      background-color: #ffffff;
      border-color: #ccc;
      color: #333;
    }
  
    .snippet-preview-box {
      background-color: #fefefe;
      border: 1px solid #bbb;
    }
  
    .code-box {
      background-color: #f9f9f9;
      color: #222;
    }
  
    /* === Dark mode overrides === */
    body.dark-mode .card {
      background-color: #2a2a2a;
      border-color: #555;
      color: #ddd;
    }
  
    body.dark-mode .snippet-preview-box {
      background-color: #1e1e1e;
      border: 1px solid #444;
    }
  
    body.dark-mode .code-box {
      background-color: #2d2d2d;
      color: #ddd;
    }
  
  
    /*code box*/
    /* Basic syntax highlighting classes */
    .keyword {
      color: #0000ff;
      font-weight: bold;
    }
  
    .type {
      color: #007070;
    }
  
    .function {
      color: #7928a1;
      font-weight: bold;
    }
  
    .literal {
      color: #009999;
    }
  
    .string {
      color: #a31515;
    }
  
    .comment {
      color: #6a9955;
      font-style: italic;
    }
  
    .number {
      color: #098658;
    }
  
    /* Dark mode overrides */
    .dark-mode .keyword {
      color: #82aaff;
    }
  
    .dark-mode .type {
      color: #89ddff;
    }
  
    .dark-mode .function {
      color: #c792ea;
    }
  
    .dark-mode .literal {
      color: #ffcb6b;
    }
  
    .dark-mode .string {
      color: #c3e88d;
    }
  
    .dark-mode .comment {
      color: #7f848e;
    }
  
    .dark-mode .number {
      color: #f78c6c;
    }
  
    html {
      scroll-behavior: smooth;
    }
  
    a {
      color: #4CAF50;
      text-decoration: none;
    }
  
    a:hover {
      text-decoration: underline;
    }

      .participant-section {
      margin-bottom: 10px;
    }

    .participant-section-wide{
      height: 100px;
    }

    .ranking-row {
      display: flex;
      gap: 10px;
      margin-top: 10px;
    }

    .ranking-labels {
      display: flex;
      gap: 10px;
      margin-bottom: 5px;
    }

    .ranking-label {
      flex: 1;
      text-align: center;
      font-weight: bold;
      color: #009999;
    }

    .ranking-slot {
      flex: 1;
      min-height: 30px;
      border: 2px dashed #4CAF50;
      background-color: #e8f5e9;
      border-radius: 6px;
      padding-left: 1px;
      padding-right: 1px;

      display: flex;           /* make contents align inline */
      flex-wrap: wrap;         /* allow wrapping to next line */
      gap: 5px;                /* optional: spacing between items */
      justify-content: center; /* optional: center items horizontally */
      align-items: center;     /* optional: center items vertically */
    }

    .ranking-slot button {
      display: inline-block;         /* allows buttons to sit next to each other */
      width: auto;                   /* removes the full-width constraint */
      margin: 1px;                   /* spacing around each button */
      padding: 1px 5px;             /* more natural button padding */
      border: none;
      border-radius: 4px;
      background-color: #4CAF50;
      color: white;
      font-size: 12px;
      font-weight: bold;
      cursor: pointer;
      flex: 0 0 auto;                /* optional: don't grow/shrink in flex layout */
    }


    .ranking-slot button:hover {
      background-color: #45a049;
      position: relative;
    }

    .ranking-label:last-child {
      color: red;
    }

    .snippet-1 { background-color: #4CAF50; color: white; } /* Green */
    .snippet-2 { background-color: #2196F3; color: white; } /* Blue */
    .snippet-3 { background-color: #f44336; color: white; } /* Red */
    .snippet-4 { background-color: #FF9800; color: white; } /* Orange */
    .snippet-5 { background-color: #9C27B0; color: white; } /* Purple */
    .snippet-6 { background-color: #3F51B5; color: white; } /* Indigo */
    .snippet-7 { background-color: #009688; color: white; } /* Teal */
    .snippet-8 { background-color: #795548; color: white; } /* Brown */

    button.snippet-1 { background-color: #4CAF50; color: white; }
    button.snippet-2 { background-color: #2196F3; color: white; }
    button.snippet-3 { background-color: #f44336; color: white; }
    button.snippet-4 { background-color: #FF9800; color: white; }
    button.snippet-5 { background-color: #9C27B0; color: white; }
    button.snippet-6 { background-color: #3F51B5; color: white; }
    button.snippet-7 { background-color: #009688; color: white; }
    button.snippet-8 { background-color: #795548; color: white; }


.reasoning-point {
  position: absolute;
  width: 10px;
  height: 10px;
  background: white;
  border: 2px solid black;
  border-radius: 50%;
  cursor: pointer;
  z-index: 10;
  transition: transform 0.2s ease;
}

.reasoning-point:hover {
  transform: scale(1.2);
}

.tooltip-box {
  position: absolute;
  background-color: #333;
  color: white;
  padding: 10px 15px;
  border-radius: 8px;
  font-size: 14px;
  max-width: 400px;
  box-shadow: 0 4px 12px rgba(0,0,0,0.3);
  display: none;
  z-index: 99;
}

.reasoning-container {
  position: relative;
}

/* Show tooltip on hover */
.reasoning-point:hover + .tooltip-box {
  display: block;
}

.snippet-box {
  background: #f9f9f9;
  border: 1px solid #ccc;
  border-radius: 6px;
  padding: 10px;
  margin-bottom: 10px;
  font-family: 'Courier New', monospace;
  white-space: pre-wrap;
  overflow-x: auto;
}

/*.code-content {*/
/*  background-color: #f0f0f0;*/
/*  padding: 10px;*/
/*  border-radius: 4px;*/
/*}*/

.participant {
      background: #f9f9f9;
      border-left: 4px solid #aaa;
      padding: 10px;
      margin-bottom: 10px;
    }
    .participant h4 {
      margin-top: 0;
    }


    #modal-code {
  background-color: #2d2d2d;
  color: #ccc;
  padding: 20px;
  border-bottom-left-radius: 8px;
  border-bottom-right-radius: 8px;
  overflow-x: auto;
  font-family: 'Courier New', Courier, monospace;
  font-size: 15px;
  line-height: 1.5;
}

.light-mode #modal-code {
  background-color: #f0f0f0;
  color: #333;
}
.code-container {
  display: grid;
  grid-template-columns: auto 1fr;
  background-color: inherit;
  color: inherit;
  font-family: 'Courier New', Courier, monospace;
  font-size: 15px;
  line-height: 1.5;
  padding: 20px;
  overflow-x: auto;
}

.line-numbers {
  text-align: right;
  padding-right: 10px;
  user-select: none;
  color: #888;
}

.code-content {
  white-space: pre;
}

#code {
  background-color: #2d2d2d;
  color: #ccc;
  padding: 20px;
  border-bottom-left-radius: 8px;
  border-bottom-right-radius: 8px;
  overflow-x: auto;
  font-family: 'Courier New', Courier, monospace;
  font-size: 15px;
  line-height: 1.5;
}

.light-mode #code {
  background-color: #f0f0f0;
  color: #333;
}
/* LIGHT MODE styles */
.keyword     { color: #0000ff; font-weight: bold; }
.type        { color: #007070; }
.function    { color: #7928a1; font-weight: bold; }
.literal     { color: #009999; }
.string      { color: #a31515; }
.comment     { color: #6a9955; font-style: italic; }
.number      { color: #098658; }

/* DARK MODE overrides */
.dark-mode .keyword  { color: #82aaff; }
.dark-mode .type     { color: #89ddff; }
.dark-mode .function { color: #c792ea; }
.dark-mode .literal  { color: #ffcb6b; }
.dark-mode .string   { color: #c3e88d; }
.dark-mode .comment  { color: #7f848e; }
.dark-mode .number   { color: #f78c6c; }

a {
    color: #4CAF50;
    text-decoration: none;
}
a:hover {
    text-decoration: underline;
}


.sticky-menu {
  position: fixed;
  bottom: 0;
  left: 0;
  right: 0;
  background: #ffffff;
  padding: 10px 0;
  border-top: 1px solid #ddd;
  display: flex;
  justify-content: center;
  gap: 12px;
  z-index: 1000;
  box-shadow: 0 -2px 6px rgba(0,0,0,0.06);
}

.sticky-menu button {
  background: #ffffff;
  color: #333;
  font-weight: 500;
  border: 1px solid #ccc;
  border-radius: 6px;
  padding: 8px 14px;
  cursor: pointer;
  transition: background 0.2s, box-shadow 0.2s;
}

.sticky-menu button:hover {
  background: #f3f3f3;
  box-shadow: 0 2px 4px rgba(0,0,0,0.08);
}

    .disagreement-box {
      background: white;
      padding: 20px;
      border-radius: 8px;
      box-shadow: 0 2px 8px rgba(0,0,0,0.1);
      margin-bottom: 20px;
    }
    textarea {
      width: 100%;
      height: 120px;
      padding: 10px;
      border-radius: 5px;
      border: 1px solid #ccc;
      font-size: 14px;
    }
    button {
      background-color: #4CAF50;
      color: white;
      border: none;
      padding: 10px 20px;
      font-size: 16px;
      margin-top: 20px;
      border-radius: 5px;
      cursor: pointer;
    }
    button:hover {
      background-color: #45a049;
    }
    .navigation {
      display: flex;
      justify-content: space-between;
      margin-top: 20px;
    }

    .content-wrapper {
      display: flex;
      gap: 20px;
      align-items: flex-start;
      margin-top: 20px;
    }

    .disagreement-box, .question-box {
      flex: 1;
      background: white;
      padding: 20px;
      border-radius: 8px;
      box-shadow: 0 2px 8px rgba(0,0,0,0.1);
    }

    textarea {
      width: 100%;
      height: 120px;
      padding: 10px;
      border-radius: 5px;
      border: 1px solid #ccc;
      font-size: 14px;
      resize: vertical;
    }

    .question-box .navigation {
      display: flex;
      justify-content: space-between;
      margin-top: 20px;
    }

    button {
      background-color: #4CAF50;
      color: white;
      border: none;
      padding: 10px 20px;
      font-size: 16px;
      border-radius: 5px;
      cursor: pointer;
    }

    button:hover {
      background-color: #45a049;
    }
    .content-wrapper {
  display: flex;
  gap: 20px;
  align-items: flex-start;
  margin-top: 20px;
}

.disagreement-box, .right-panel {
  flex: 1;
  background: white;
  padding: 20px;
  border-radius: 8px;
  box-shadow: 0 2px 8px rgba(0,0,0,0.1);
}

.question-box textarea {
  width: 100%;
  height: 120px;
  padding: 10px;
  font-size: 14px;
  border: 1px solid #ccc;
  border-radius: 5px;
  resize: vertical;
}

.right-panel .navigation {
  display: flex;
  justify-content: space-between;
  margin-top: 20px;
}


.toggle-btn {
  padding: 6px 12px;
  font-size: 14px;
  border-radius: 5px;
  background-color: #ffc800;
  border: 1px solid #aaa;
  cursor: pointer;
  color: #222;
}

/* This is no longer fixed height */
.phase-bar {
  position: fixed;
  top: 50px;
  left: 0;
  right: 0;
  background: #fff;
  z-index: 999;
  box-shadow: 0 2px 4px rgba(0,0,0,0.1);
  border-bottom: 1px solid #ccc;
  transition: max-height 0.3s ease;
}

/* Static header */
.phase-header {
  display: flex;
  justify-content: space-between;
  align-items: center;
  padding: 10px 20px;
}

/* Collapsible section ‚Äî scrollable */


/* Slim header */
.phase-header {
  display: flex;
  justify-content: space-between;
  align-items: center;
  padding: 8px 16px;
}

/* Title inline */
.phase-title {
  font-weight: 600;
  color: #333;
}

/* body {
  margin-top: 140px;
} */

#scroll-trigger-element {
  opacity: 0;
  transition: opacity 0.4s ease;
  pointer-events: none;
}

#scroll-trigger-element.visible {
  opacity: 1;
  pointer-events: auto;
}


#phase-section-content {
  overflow: auto;
  min-height: 50px;
  height: 200px; /* default */
  resize: none;  /* disable built-in resizing ‚Äî we use custom handle */
  /* margin-bottom: 100px; */
  overflow-y: visible;
  padding: 10px 20px;
  /*display: none;*/
}

#phase2-resize-handle {
  height: 10px;
  background: #ccc;
  cursor: ns-resize;
  position: relative;
  /*display: none;*/
}

    .fade {
      transition: opacity 0.4s ease;
      opacity: 1;
    }
    .fade.hidden {
      opacity: 0;
    }

  </style>
</head>
<body>

<div class="status-bar">
  <div class="user-dropdown" style="position: relative;">
    <div style="padding: 8px 12px; color: gainsboro; font-weight: bold;"><span id="user-info"></span> (<button
        onclick="logout()"
        style="color: white; background: none; border: none; cursor: pointer; margin: 0;padding: 0;">üö™ Logout</button>)
    </div>
  </div>
  <a href="round2.html" class="phase-link" id="link-home">üè† Home</a>
  <a href="round2-phase1.html" class="phase-link" id="link-phase1">Phase 1</a>
  <a href="round2-phase2.html" class="phase-link disabled" id="link-phase2">Phase 2</a>
  <a href="round2-phase3.html" class="phase-link disabled" id="link-phase3">Phase 3</a>
  <a href="round2-phase4.html" class="phase-link disabled" id="link-phase4">Phase 4</a>
  <a href="round2-phase5.html" class="phase-link disabled" id="link-phase5">Phase 5</a>
  <a href="round2-review.html" class="phase-link disabled" id="link-review">Review & Submit</a>
</div>
<div id="scroll-trigger-element">
  <div id="phase2-section" class="phase-bar">
    <div class="phase-header">
      <span class="phase-title">üìå Need to revisit the rankings and reasoning? Click "Show" to view.</span>
      <button onclick="togglePhaseSection()" class="toggle-btn">Hide</button>
    </div>



    <div id="phase-section-content" class="phase-section" style="margin-top: 15px; ">

            <div class="ranking-labels" style="margin-top: 10px;">
        <div class="ranking-label">1 (easiest)</div>
        <div class="ranking-label">2</div>
        <div class="ranking-label">3</div>
        <div class="ranking-label">4</div>
        <div class="ranking-label">5</div>
        <div class="ranking-label">6</div>
        <div class="ranking-label">7</div>
        <div class="ranking-label">8 (hardest)</div>
      </div>
    <div class="participant-section">
      <strong>expertC</strong>
      <div class="ranking-row">
        <div class="ranking-slot" style="position: relative;">
          <button class="snippet-4" onclick="show_snippet(4)">indexOfIgnoreCa</button>
<button class="snippet-5" onclick="show_snippet(5)">deleteRecursive</button>
            <div class="reasoning-point" onclick="compare([4],[5])" style="position: absolute; top: -7px; right: 50px;"></div>
            <div class="tooltip-box" style="position: absolute; top: 25px; left: 10px; width: 360px;">üí° <strong>Reason:</strong><br>I can go line by line through each and know what each line does. All variable names/method names make sense. Error cases are clear.<br><br>The business logic is straightforward based on the method name/signature.</div>
            <div class="reasoning-point" onclick="compare([4,5],[2,1])" style="position: absolute; top: 10px; right: -12px;"></div>
            <div class="tooltip-box" style="top: 35px; right: -160px;">Position 2 requires more knowledge of the domain, like why are &#x27;file&#x27; and &#x27;jar&#x27; unique cases in isRemote.<br><br>for isValidProjectName, I would almost put that in position 1 but I only knocked it down because of the unclear reason for line 13 having two checks (why a separate letter or digit check? could be performance reasons, not sure)</div>
          </div>

          <div class="ranking-slot" style="position: relative;">
          <button class="snippet-2" onclick="show_snippet(2)">isRemote</button>
<button class="snippet-1" onclick="show_snippet(1)">isValidProjectN</button>
            <div class="reasoning-point" onclick="compare([2],[1])" style="position: absolute; top: -7px; right: 50px;"></div>
            <div class="tooltip-box" style="position: absolute; top: 25px; left: 10px; width: 360px;">üí° <strong>Reason:</strong><br>Kinda explained in the last one. Requires some business knowledge or knowledge of the unique cases here</div>
            <div class="reasoning-point" onclick="compare([2,1],[3])" style="position: absolute; top: 10px; right: -12px;"></div>
            <div class="tooltip-box" style="top: 35px; right: -160px;">isMachineTypeDefined requires even more business knowledge about the domain, is this any machine? only coffee machines? is &quot;Coff&quot; even &quot;Coffee&quot; for sure?. I can make better guesses for Position 2 stuff.<br><br>This also uses advanced Java stuff that is not very common, checking class declared fields. I usually stay away from doing that</div>
          </div>

          <div class="ranking-slot" style="position: relative;">
          <button class="snippet-3" onclick="show_snippet(3)">isMachineTypeDe</button>
            <div class="reasoning-point" onclick="compare([3],[8])" style="position: absolute; top: 10px; right: -12px;"></div>
            <div class="tooltip-box" style="top: 35px; right: -160px;">At least in isMachienTypeDefined I can take good guesses at the logic, and at minimum the method name makes it clear what it&#x27;s trying to check for.<br><br>atan2 requires either math knowledge or context in the package - I still don&#x27;t know if it&#x27;s a V2 or squared<br><br>Depending on a user knowing math is difficult, I would add more comments</div>
          </div>

          <div class="ranking-slot" style="position: relative;">
          
          </div>

          <div class="ranking-slot" style="position: relative;">
          
          </div>

          <div class="ranking-slot" style="position: relative;">
          <button class="snippet-8" onclick="show_snippet(8)">atan2</button>
            <div class="reasoning-point" onclick="compare([8],[7])" style="position: absolute; top: 10px; right: -12px;"></div>
            <div class="tooltip-box" style="top: 35px; right: -160px;">lowestPositiveRoot is even more complicated math in my mind. Also it&#x27;s confusing why line 10-17 are written the way they are, I think it could be combined and simplified</div>
          </div>

          <div class="ranking-slot" style="position: relative;">
          <button class="snippet-7" onclick="show_snippet(7)">lowestPositiveR</button>
            <div class="reasoning-point" onclick="compare([7],[6])" style="position: absolute; top: 10px; right: -12px;"></div>
            <div class="tooltip-box" style="top: 35px; right: -160px;">I put CharSequence as most difficult because it&#x27;s doing bitwise stuff and UTF stuff I&#x27;m not familiar with. Based on the comment about being optimized, I think it&#x27;s complicated on purpose so that it&#x27;s efficient. What&#x27;s good for computers isn&#x27;t always good for humans</div>
          </div>

          <div class="ranking-slot" style="position: relative;">
          <button class="snippet-6" onclick="show_snippet(6)">encodedLength</button>
          </div>
      </div>
    </div>

    <div class="participant-section">
      <strong>expertB</strong>
      <div class="ranking-row">
        <div class="ranking-slot" style="position: relative;">
          <button class="snippet-1" onclick="show_snippet(1)">isValidProjectN</button>
            <div class="reasoning-point" onclick="compare([1],[2])" style="position: absolute; top: 10px; right: -12px;"></div>
            <div class="tooltip-box" style="top: 35px; right: -160px;">Because the problem of defining a valid project name is more straightforward than that of defining a URI as local. The URI class is one of those classes that you don&#x27;t use everyday and you need to go to check the documentation to remember how it is composed. On the other hand the valid project name function is very self explanatory.</div>
          </div>

          <div class="ranking-slot" style="position: relative;">
          <button class="snippet-2" onclick="show_snippet(2)">isRemote</button>
            <div class="reasoning-point" onclick="compare([2],[5])" style="position: absolute; top: 10px; right: -12px;"></div>
            <div class="tooltip-box" style="top: 35px; right: -160px;">While reading the `deleteRecursively` method for the first time I was looking for the recursion pattern in the code and instead the code used the Files.walkFileTree method to traverse the files. Because of this reading this code was a bit more confusing than the snippet checking whether a URI is remote.</div>
          </div>

          <div class="ranking-slot" style="position: relative;">
          <button class="snippet-5" onclick="show_snippet(5)">deleteRecursive</button>
            <div class="reasoning-point" onclick="compare([5],[7])" style="position: absolute; top: 10px; right: -12px;"></div>
            <div class="tooltip-box" style="top: 35px; right: -160px;">the deleteRecursively method is quite explanatory if you ignore the &quot;recursively&quot; part of the name. Normally following these kind of operations is easier to understand than doing math in code. Because of this even though I would say they are quite similar it&#x27;s a bit easier to understand one over the other.</div>
          </div>

          <div class="ranking-slot" style="position: relative;">
          <button class="snippet-7" onclick="show_snippet(7)">lowestPositiveR</button>
            <div class="reasoning-point" onclick="compare([7],[4])" style="position: absolute; top: 10px; right: -12px;"></div>
            <div class="tooltip-box" style="top: 35px; right: -160px;">Given that the lowestPositiveRoot method implements the well known quadratic equation it&#x27;s easier to follow this code over the indexOfIgnoreCase. Also because the indexOfIgnoreCase method is more or less reinventing the wheel as these operations could be easily implemented parsing the CharSequences to String and using the built in methods to find substrings and bringing all values to lower or upper case.</div>
          </div>

          <div class="ranking-slot" style="position: relative;">
          <button class="snippet-4" onclick="show_snippet(4)">indexOfIgnoreCa</button>
            <div class="reasoning-point" onclick="compare([4],[8,6,3])" style="position: absolute; top: 10px; right: -12px;"></div>
            <div class="tooltip-box" style="top: 35px; right: -160px;">Given that most of the functions in position 8 are a bit hacky/cryptic and most likely yield wrong results, it&#x27;s difficult to follow these methods. The indexOfIgnoreCase is still easier to understand as it&#x27;s easy to know what to expect of such a method.</div>
          </div>

          <div class="ranking-slot" style="position: relative;">
          
          </div>

          <div class="ranking-slot" style="position: relative;">
          
          </div>

          <div class="ranking-slot" style="position: relative;">
          <button class="snippet-6" onclick="show_snippet(6)">encodedLength</button>
<button class="snippet-8" onclick="show_snippet(8)">atan2</button>
<button class="snippet-3" onclick="show_snippet(3)">isMachineTypeDe</button>
            <div class="reasoning-point" onclick="compare([8],[6,3])" style="position: absolute; top: -7px; right: 50px;"></div>
            <div class="tooltip-box" style="position: absolute; top: 25px; left: 10px; width: 360px;">üí° <strong>Reason:</strong><br>As all these functions are either a bit hacky or have straight errors it&#x27;s difficult to follow what they do and it takes a lot of time to &quot;mentally debug&quot; their code. So, I think they are more or less equally hard to comprehend</div>
          </div>
      </div>
    </div>

    <div class="participant-section">
      <strong>expertA</strong>
      <div class="ranking-row">
        <div class="ranking-slot" style="position: relative;">
          <button class="snippet-2" onclick="show_snippet(2)">isRemote</button>
<button class="snippet-1" onclick="show_snippet(1)">isValidProjectN</button>
            <div class="reasoning-point" onclick="compare([1],[2])" style="position: absolute; top: -7px; right: 50px;"></div>
            <div class="tooltip-box" style="position: absolute; top: 25px; left: 10px; width: 360px;">üí° <strong>Reason:</strong><br>Short snippets. The purpose of local variables and called methods is clear.</div>
            <div class="reasoning-point" onclick="compare([1,2],[3,5])" style="position: absolute; top: 10px; right: -12px;"></div>
            <div class="tooltip-box" style="top: 35px; right: -160px;">They do not require a lot of experience or knowledge about the API elements being called.</div>
          </div>

          <div class="ranking-slot" style="position: relative;">
          
          </div>

          <div class="ranking-slot" style="position: relative;">
          
          </div>

          <div class="ranking-slot" style="position: relative;">
          <button class="snippet-3" onclick="show_snippet(3)">isMachineTypeDe</button>
<button class="snippet-5" onclick="show_snippet(5)">deleteRecursive</button>
            <div class="reasoning-point" onclick="compare([3],[5])" style="position: absolute; top: -7px; right: 50px;"></div>
            <div class="tooltip-box" style="position: absolute; top: 25px; left: 10px; width: 360px;">üí° <strong>Reason:</strong><br>Purpose is simple enough but requires specific knowledge about the API to easily understand their purpose.</div>
            <div class="reasoning-point" onclick="compare([3,5],[4])" style="position: absolute; top: 10px; right: -12px;"></div>
            <div class="tooltip-box" style="top: 35px; right: -160px;">Everything was clear from the naming of all the elements. In Position 5, there are some local variables with names that are not descriptive enough.</div>
          </div>

          <div class="ranking-slot" style="position: relative;">
          <button class="snippet-4" onclick="show_snippet(4)">indexOfIgnoreCa</button>
            <div class="reasoning-point" onclick="compare([4],[7])" style="position: absolute; top: 10px; right: -12px;"></div>
            <div class="tooltip-box" style="top: 35px; right: -160px;">Naming of elements provide a good picture of the purpose of the method. For position 7, the names are not descriptive at all; not even if the reader has the specific knowledge.</div>
          </div>

          <div class="ranking-slot" style="position: relative;">
          
          </div>

          <div class="ranking-slot" style="position: relative;">
          <button class="snippet-7" onclick="show_snippet(7)">lowestPositiveR</button>
            <div class="reasoning-point" onclick="compare([7],[8,6])" style="position: absolute; top: 10px; right: -12px;"></div>
            <div class="tooltip-box" style="top: 35px; right: -160px;">The name of the method gives a good (but not complete) idea of its purpose. In Position 8, nothing seems to be descriptive enough to decipher their purpose.</div>
          </div>

          <div class="ranking-slot" style="position: relative;">
          <button class="snippet-6" onclick="show_snippet(6)">encodedLength</button>
<button class="snippet-8" onclick="show_snippet(8)">atan2</button>
            <div class="reasoning-point" onclick="compare([8],[6])" style="position: absolute; top: -7px; right: 50px;"></div>
            <div class="tooltip-box" style="position: absolute; top: 25px; left: 10px; width: 360px;">üí° <strong>Reason:</strong><br>suffer from the same issue: names that do not really convey the purpose of the method. Also, the existence of some magic numbers with unclear meaning.</div>
          </div>
      </div>
    </div>

    <div class="participant-section">
      <strong>expertE</strong>
      <div class="ranking-row">
        <div class="ranking-slot" style="position: relative;">
          <button class="snippet-1" onclick="show_snippet(1)">isValidProjectN</button>
            <div class="reasoning-point" onclick="compare([1],[2])" style="position: absolute; top: 10px; right: -12px;"></div>
            <div class="tooltip-box" style="top: 35px; right: -160px;">I found the project name validation snippet easier to understand than the URI one because everything it does is right there in front of you and self-contained. It just walks through a series of simple checks on a single string: null, leading dot, length range, and allowed characters. The loop is straightforward, the conditions are easy to read, and the intent matches the method name exactly.<br><br>The isRemote method is still pretty readable, but it pulls in a bit more context. You have to reason about URI schemes and what counts as ‚Äúremote‚Äù.  And, there‚Äôs also a dependency on isFilesystemPath(uri), whose behavior you don‚Äôt see in this snippet and must infer. That extra bit of indirection and the need to think and infer about external behavior makes it slightly less immediate to understand than the project name validator.</div>
          </div>

          <div class="ranking-slot" style="position: relative;">
          <button class="snippet-2" onclick="show_snippet(2)">isRemote</button>
            <div class="reasoning-point" onclick="compare([2],[4])" style="position: absolute; top: 10px; right: -12px;"></div>
            <div class="tooltip-box" style="top: 35px; right: -160px;">The isRemote snippet is easier to understand because it‚Äôs shorter, more linear, and deals with only a couple of simple conditions. You can read straight through it and immediately see the intent: check a few properties of the URI and return true or false based on the scheme. There are no loops and the branching stays relatively shallow.<br><br>The indexOfIgnoreCase snippet, while still readable, requires a little more mental work to parse out its logic. It has more parameters to consider, several edge-case checks, and a loop that searches through the characters. You also have to reason about the starting position, the calculated end boundary, and infer what regionMatches does. None of the code is overly complex, but there are simply more moving parts than in isRemote, which makes it take a bit more effort to follow.</div>
          </div>

          <div class="ranking-slot" style="position: relative;">
          <button class="snippet-4" onclick="show_snippet(4)">indexOfIgnoreCa</button>
            <div class="reasoning-point" onclick="compare([4],[5])" style="position: absolute; top: 10px; right: -12px;"></div>
            <div class="tooltip-box" style="top: 35px; right: -160px;">The substring search method is easier to understand because everything it‚Äôs doing is contained within the method itself. Even though it has a loop and a few boundary checks, the overall idea is straightforward: adjust the starting position, calculate how far you can search, and then scan through the string looking for a match. The control flow is familiar and the logic stays localized.<br><br>Conversely, the recursive delete method requires understanding how Files.walkFileTree works and how the SimpleFileVisitor callbacks interact with it. The actual deletion logic is simple, but the pattern itself isn‚Äôt something you interpret linearly‚Äîyou have to mentally connect the visitor methods to the traversal process and understand that the framework is controlling the recursion. Because the behavior depends on the external file-tree traversal API rather than just the code in front of you, it takes more effort to follow and understand what‚Äôs happening in the function.</div>
          </div>

          <div class="ranking-slot" style="position: relative;">
          <button class="snippet-5" onclick="show_snippet(5)">deleteRecursive</button>
            <div class="reasoning-point" onclick="compare([5],[7])" style="position: absolute; top: 10px; right: -12px;"></div>
            <div class="tooltip-box" style="top: 35px; right: -160px;">The recursive delete snippet is easier to understand because the overall intent is clear right away: walk through a directory tree and delete everything in it. Even though it uses walkFileTree, the logic inside the visitor is simple‚Äîdelete each file, then delete each directory. Once you recognize the pattern, the flow is pretty easy to follow.<br><br>The quadratic-root snippet requires more mental work because you have to track the math. You need to remember how the discriminant works, how the quadratic formula is applied, and why the roots are swapped. The code itself isn‚Äôt really complicated ‚Äî it‚Äôs the underlying math that makes you pause. A brief comment explaining the steps of the quadratic calculation would make it easier to understand more quickly. The method is still readable, but you do have to think through the algebra and the ordering logic, which makes it a bit more involved than just iterating over a file tree and deleting entries.</div>
          </div>

          <div class="ranking-slot" style="position: relative;">
          <button class="snippet-7" onclick="show_snippet(7)">lowestPositiveR</button>
            <div class="reasoning-point" onclick="compare([7],[3])" style="position: absolute; top: 10px; right: -12px;"></div>
            <div class="tooltip-box" style="top: 35px; right: -160px;">The quadratic-root snippet, even though it requires some math, has a very linear and predictable flow. You compute the discriminant, calculate two roots, reorder them if necessary, and then return the smallest positive one. The logic is contained entirely within the method, and once you understand the math, the code itself is straightforward and easy to follow, particularly with the variables named appropriately.<br><br>The machine-type snippet is harder because it relies heavily on reflection, which is much less intuitive to read. Instead of simply working with local variables, the code dynamically inspects fields on another class, checks their modifiers, and retrieves values at runtime. Understanding what‚Äôs happening means keeping track of the reflection API, the meaning of synthetic fields, and why static final fields are being filtered. Without comments, you also have to infer why reflection is even being used. All of that requires more mental overhead and analysis outside of the function itself than following the quadratic formula.</div>
          </div>

          <div class="ranking-slot" style="position: relative;">
          <button class="snippet-3" onclick="show_snippet(3)">isMachineTypeDe</button>
            <div class="reasoning-point" onclick="compare([3],[6])" style="position: absolute; top: 10px; right: -12px;"></div>
            <div class="tooltip-box" style="top: 35px; right: -160px;">The machine-type snippet is easier to understand because, even though it uses reflection, the overall idea is straightforward: loop through a set of constants and check whether any of them match the input value. Once you recognize the pattern, the flow is pretty direct, and most of the complexity comes from the API calls rather than any tricky or confusing logic.<br><br>The UTF-8 encoded-length snippet is more difficult because the logic is dense and optimized in ways that aren‚Äôt immediately obvious or intuitive. You have to understand character ranges, multi-byte UTF-8 encoding rules, and why certain bit-level expressions, like ((0x7f - c) &gt;&gt;&gt; 31), work the way they do. There‚Äôs also an abrupt jump to a helper method when a non-ASCII, non-2-byte character is found, which adds another layer you have to understand and think about. The method is correct but compact and ‚Äúclever,‚Äù so it takes more effort to unpack than the reflection loop.</div>
          </div>

          <div class="ranking-slot" style="position: relative;">
          <button class="snippet-6" onclick="show_snippet(6)">encodedLength</button>
            <div class="reasoning-point" onclick="compare([6],[8])" style="position: absolute; top: 10px; right: -12px;"></div>
            <div class="tooltip-box" style="top: 35px; right: -160px;">The UTF-8 length calculation snippet is tricky because of the bit-level optimizations, but the overall structure is still pretty logical. It walks through the characters, handles ASCII first, then moves on to multi-byte ranges, and finally checks for overflow. Even if you don‚Äôt fully understand the condensed/clever arithmetic, you can still follow the high-level idea.<br><br>The atan2 snippet is harder because the flow is much less intuitive. It uses unusual NaN-detection tricks like n != n and n - n != n - n, which aren‚Äôt patterns most developers use or encounter, since they would typically rely on built-in helper functions. On top of that, the method branches into several quadrant-handling cases, and the fallback returns involve expressions like x + HALF_PI, which require you to reason about what x actually represents at that point. Without comments, you have to mentally reconstruct how each case produces the correct angle. All of that makes the atan2 code more confusing and less straightforward than the UTF-8 length calculation.</div>
          </div>

          <div class="ranking-slot" style="position: relative;">
          <button class="snippet-8" onclick="show_snippet(8)">atan2</button>
          </div>
      </div>
    </div>

    <div class="participant-section">
      <strong>expertD</strong>
      <div class="ranking-row">
        <div class="ranking-slot" style="position: relative;">
          <button class="snippet-2" onclick="show_snippet(2)">isRemote</button>
            <div class="reasoning-point" onclick="compare([2],[3])" style="position: absolute; top: 10px; right: -12px;"></div>
            <div class="tooltip-box" style="top: 35px; right: -160px;">isRemote is a small and very clear code, it does not have a complicated objective and avoids using fragments or variables that are outside the code that can be seen, so the entire context is immediately understood.</div>
          </div>

          <div class="ranking-slot" style="position: relative;">
          <button class="snippet-3" onclick="show_snippet(3)">isMachineTypeDe</button>
            <div class="reasoning-point" onclick="compare([3],[4])" style="position: absolute; top: 10px; right: -12px;"></div>
            <div class="tooltip-box" style="top: 35px; right: -160px;">The declaration of the names in IsMachineTypeDefined is clearer to me, allowing me to know what the focus of the code is.</div>
          </div>

          <div class="ranking-slot" style="position: relative;">
          <button class="snippet-4" onclick="show_snippet(4)">indexOfIgnoreCa</button>
            <div class="reasoning-point" onclick="compare([4],[1])" style="position: absolute; top: 10px; right: -12px;"></div>
            <div class="tooltip-box" style="top: 35px; right: -160px;">The isValidProjectName code can be simplified. It is understandable, but it does not take full advantage of Java&#x27;s capabilities to be concise.</div>
          </div>

          <div class="ranking-slot" style="position: relative;">
          <button class="snippet-1" onclick="show_snippet(1)">isValidProjectN</button>
            <div class="reasoning-point" onclick="compare([1],[5])" style="position: absolute; top: 10px; right: -12px;"></div>
            <div class="tooltip-box" style="top: 35px; right: -160px;">The use of tags in the deleteRecursively code does not seem appropriate to me, nor does the way a method is defined within a method without defining any class.</div>
          </div>

          <div class="ranking-slot" style="position: relative;">
          <button class="snippet-5" onclick="show_snippet(5)">deleteRecursive</button>
            <div class="reasoning-point" onclick="compare([5],[8])" style="position: absolute; top: 10px; right: -12px;"></div>
            <div class="tooltip-box" style="top: 35px; right: -160px;">atan2 has the peculiarity of not using variable names to describe the use of variables, so the code feels like reading a mathematical formula rather than defining an algorithm.</div>
          </div>

          <div class="ranking-slot" style="position: relative;">
          <button class="snippet-8" onclick="show_snippet(8)">atan2</button>
            <div class="reasoning-point" onclick="compare([8],[7])" style="position: absolute; top: 10px; right: -12px;"></div>
            <div class="tooltip-box" style="top: 35px; right: -160px;">Both functions share the mathematical vision, but the order of lowestPositiveRoot does not allow me to see the mathematical procedure in parts. Instead, I must continually review the definition of how a variable acts in order to know what role the variable plays in the function. So, both codes have the same readability, but the code in position 7 requires more time to understand.</div>
          </div>

          <div class="ranking-slot" style="position: relative;">
          <button class="snippet-7" onclick="show_snippet(7)">lowestPositiveR</button>
            <div class="reasoning-point" onclick="compare([7],[6])" style="position: absolute; top: 10px; right: -12px;"></div>
            <div class="tooltip-box" style="top: 35px; right: -160px;">The order of the CharSequence procedure leaves me quite confused, in terms of the variable names, the use of the operation with letters and their hex values, the use of disordered operators such as ‚Äú&gt;&gt;&gt;,‚Äù and the flow of what the result is seems very abstract. You have to reread it several times to understand the purpose of the method, and it seems like a complicated problem.</div>
          </div>

          <div class="ranking-slot" style="position: relative;">
          <button class="snippet-6" onclick="show_snippet(6)">encodedLength</button>
          </div>
      </div>
    </div>
      </div>

    <!-- üîß Grip to resize #phase-section-content -->
    <div id="phase2-resize-handle"></div>
  </div>
</div>




<div id="instructions-box" style="background-color: #fff; padding: 20px; border-radius: 8px; margin-bottom: 20px; box-shadow: 0 2px 8px rgba(0,0,0,0.1); margin-top: 80px;">
  <div style="display: flex; justify-content: space-between; align-items: center;">
    <h2 style="margin: 0;">Phase 3: Reflect on Expert Disagreements</h2>
    <button id="instructions-content-btn" onclick="toggleInstructions()" style="padding: 6px 12px; font-size: 14px; border-radius: 5px; background-color: #ffffff; border: none; cursor: pointer; color: #222; border: solid;">Hide</button>
  </div>

  <div id="instructions-content" style="margin-top: 15px;">
  <p>In this phase, you will reflect on the disagreements between experts like yourself. For each disagreement point:</p>
  <ol>
    <li>Read the full explanation on the left.</li>
    <li>Answer the questions on the right.</li>
    <li>Click ‚ÄúNext‚Äù to continue.</li>
  </ol>
  <p>While answering questions, use the sticky bar button to view the rankings and reasoning.</p>

    <!-- <p><strong>Important:</strong> Please fill the ranking positions from left to right. If you leave any positions empty (e.g., due to grouping multiple snippets in one position), leave the rightmost positions empty.</p> -->
     
          <p><strong>Please complete this phase using your own judgment</strong>. <span><strong>Do not consult with anyone else or use generative AI tools (ChatGPT, GitHub Copilot, etc.), search engines, or external websites</strong></span>. Your judgment is essential to the validity of our study.</p>
  </div>
</div>


  <div class="ranking-row-numbers" id="rankingRow" style="display: none;">
    <p class="ranking-number">Position 1 <span style="color: green;">(easiest)</span></p>
    <p class="ranking-number">Position 2</p>
    <p class="ranking-number">Position 3</p>
    <p class="ranking-number">Position 4</p>
    <p class="ranking-number">Position 5</p>
    <p class="ranking-number">Position 6</p>
    <p class="ranking-number">Position 7</p>
    <p class="ranking-number">Position 8 <span style="color: red;">(hardest)</span></p> 
  </div>
  <div class="ranking-row" id="rankingRow" style="display: none;">
    <!-- 8 drop zones -->
    <div class="ranking-slot" data-rank="1"></div>
    <div class="ranking-slot" data-rank="2"></div>
    <div class="ranking-slot" data-rank="3"></div>
    <div class="ranking-slot" data-rank="4"></div>
    <div class="ranking-slot" data-rank="5"></div>
    <div class="ranking-slot" data-rank="6"></div>
    <div class="ranking-slot" data-rank="7"></div>
    <div class="ranking-slot" data-rank="8"></div>
  </div>

  <div id="cards" style="margin-bottom: 20px; display: none;"></div>


  <div id="snippet-bar" style="display: none; justify-content: space-between; align-items: center; padding: 10px 15px; background-color: #f5f5f5; border-radius: 6px; margin-bottom: 15px; box-shadow: 0 1px 3px rgba(0,0,0,0.1);">
    <h3 style="margin: 0; font-size: 16px; color: #333;">
      üîç Snippet Preview & Compare <span style="font-weight: normal;">(click on view checkboxes to preview or compare snippets)</span>
    </h3>
        <button id="theme-toggle" onclick="toggleTheme()" style="padding: 6px 12px; font-size: 14px; border-radius: 5px; background-color: #333; color: white; border: none; cursor: pointer;">
      Switch to Dark Mode
    </button>
  </div>
  
  <div class="preview-area" id="previewArea"></div>

  <div class="content-wrapper">
    <div id="disagreement-box" class="disagreement-box">
      <!-- Disagreement content here -->
    </div>
  
    <div class="right-panel">
      <div id="question-box" class="question-box">
        <!-- JS will populate this -->
      </div>
  
      <div class="navigation">
        <button onclick="prev()" id="prevBtn">‚¨ÖÔ∏è Previous</button>
        <button onclick="next()" id="nextBtn">Next ‚û°Ô∏è</button>
      </div>
      <div style="margin-top: 30px;">
        <button id="continueBtn" onclick="goToPhase4()" style="padding: 10px 20px; font-size: 16px; border: none; border-radius: 5px; background-color: gray; color: white; cursor: pointer;">Continue to Phase 4 ‚û°Ô∏è</button>
      </div>
    </div>
  </div>


  <div id="validation-modal" style="
  display: none;
  position: fixed;
  top: 30%;
  left: 50%;
  transform: translate(-50%, -50%);
  background-color: #fff0f0;
  color: #660000;
  border: 1px solid #ff9999;
  padding: 20px;
  border-radius: 10px;
  width: 440px;
  box-shadow: 0 4px 16px rgba(0,0,0,0.2);
  z-index: 1002;
  text-align: center;
  font-family: 'Segoe UI', Tahoma, sans-serif;
  ">
    <p id="validation-message" style="font-weight: bold;"></p>
    <button onclick="document.getElementById('validation-modal').style.display = 'none';" style="
      margin-top: 15px;
      padding: 8px 14px;
      background-color: #ff9999;
      color: white;
      border: none;
      border-radius: 5px;
      cursor: pointer;
    ">OK</button>
  </div>

  <div id="snippet-modal" style="display:none; position:fixed; top:10%; left:50%; transform:translateX(-50%); width:80%; max-height:80%; overflow-y:auto; background:#fff; border:1px solid #ccc; padding:20px; border-radius:8px; box-shadow:0 4px 16px rgba(0,0,0,0.2); z-index:1002;">
  <div style="display:flex; justify-content:space-between; align-items:center; margin-bottom:15px;">
    <h3 id="modal-snippet-title" style="margin:0;">Snippet</h3>
    <div>
      <button onclick="toggleModalTheme()" id="modal-theme-toggle" style="margin-right: 10px; padding: 6px 12px; border-radius: 5px; border: none; background-color: #333; color: white; cursor: pointer;">Switch to Light Mode</button>
      <span onclick="document.getElementById('snippet-modal').style.display='none'" style="cursor:pointer; font-size:20px; font-weight:bold;">&times;</span>
    </div>
  </div>

  <div class="code-container" id="modal-code">
    <div class="line-numbers" id="modal-line-numbers"></div>
    <div class="code-content" id="modal-code-content"></div>
  </div>
</div>


<div id="compare-modal" style="display:none; position:fixed; top:10%; left:50%; transform:translateX(-50%); width:90%; max-height:80%; overflow-y:auto; background:#fff; border:1px solid #ccc; padding:20px; border-radius:8px; box-shadow:0 4px 16px rgba(0,0,0,0.2); z-index:1002;">
  <div style="display:flex; justify-content:space-between; align-items:center; margin-bottom:15px;">
    <h3 style="margin:0;">Compare Snippets</h3>
    <span onclick="document.getElementById('compare-modal').style.display='none'" style="cursor:pointer; font-size:20px; font-weight:bold;">&times;</span>
  </div>

  <div id="compare-columns" style="display: flex; gap: 20px; ">
    <div id="compare-left" style="flex: 1; overflow-x: auto;" ></div>
    <div id="compare-right" style="flex: 1; overflow-x: auto;"></div>
  </div>
</div>

<script src="js/round1Disagreements.js"></script>

<script>
  function showValidationMessage(msg) {
    document.getElementById('validation-message').innerText = msg;
    document.getElementById('validation-modal').style.display = 'block';
  }
</script>

<script>
  const originalSnippets = [
    {
      id: 1,
      title: "Snippet 1",
      code: `
<span class="keyword">public static</span> <span class="type">boolean</span> <span class="function">isValidProjectName</span>(<span class="type">String</span> name) {
    <span class="keyword">if</span> (name == <span class="literal">null</span>) {
        <span class="keyword">return</span> <span class="literal">false</span>;
    }
    <span class="keyword">if</span> (name.<a href="#" class="standard-method function" onclick="openJavadocModal('https://docs.oracle.com/javase/8/docs/api/java/lang/String.html#startsWith-java.lang.String-')">startsWith</a>(<span class="string">"."</span>)) {
        <span class="keyword">return</span> <span class="literal">false</span>;
    }
    <span class="keyword">if</span> ((name.<a href="#" class="standard-method function" onclick="openJavadocModal('https://docs.oracle.com/javase/8/docs/api/java/lang/String.html#length--')">length</a>() < <span class="number">1</span>) || (name.<a href="#" class="standard-method function" onclick="openJavadocModal('https://docs.oracle.com/javase/8/docs/api/java/lang/String.html#length--')">length</a>() > MAX_NAME_LENGTH)) {
        <span class="keyword">return</span> <span class="literal">false</span>;
    }
    <span class="keyword">for</span> (<span class="type">int</span> i = <span class="number">0</span>; i < name.<a href="#" class="standard-method function" onclick="openJavadocModal('https://docs.oracle.com/javase/8/docs/api/java/lang/String.html#length--')">length</a>(); i++) {
        <span class="type">char</span> c = name.<a href="#" class="standard-method function" onclick="openJavadocModal('https://docs.oracle.com/javase/8/docs/api/java/lang/String.html#charAt-int-')">charAt</a>(i);
        <span class="keyword">if</span> (!Character.<a href="#" class="standard-method function" onclick="openJavadocModal('https://docs.oracle.com/javase/8/docs/api/java/lang/Character.html#isLetterOrDigit-char-')">isLetterOrDigit</a>(c) && !VALID_NAME_SET.<a href="#" class="standard-method function" onclick="openJavadocModal('https://docs.oracle.com/javase/8/docs/api/java/util/Set.html#contains-java.lang.Object-')">contains</a>(c)) {
            <span class="keyword">return</span> <span class="literal">false</span>;
        }
    }
    <span class="keyword">return</span> <span class="literal">true</span>;
}
`
          },
          {
            id: 2,
            title: "Snippet 2",
            code: `
<span class="keyword">public static</span> <span class="type">boolean</span> <span class="function">isRemote</span>(<span class="type">URI</span> uri) {
    <span class="keyword">if</span> (<span class="function">isFilesystemPath</span>(uri)) {
        <span class="keyword">return</span> <span class="literal">false</span>;
    }
    <span class="type">String</span> scheme = uri.<a href="#" class="standard-method function" onclick="openJavadocModal('https://docs.oracle.com/javase/8/docs/api/java/net/URI.html#getScheme--')">getScheme</a>();
    <span class="keyword">if</span> (scheme == <span class="literal">null</span>) {
        <span class="keyword">return</span> <span class="literal">false</span>;
    }
    <span class="keyword">switch</span> (scheme) {
        <span class="keyword">case</span> <span class="string">"file"</span>:
        <span class="keyword">case</span> <span class="string">"jar"</span>:
            <span class="keyword">return</span> <span class="literal">false</span>;
        <span class="keyword">default</span>:
            <span class="keyword">break</span>;
    }
    <span class="keyword">return</span> <span class="literal">true</span>;
}
`            
          },
          {
            id: 3,
            title: "Snippet 3",
            code: `
<span class="keyword">public static</span> <span class="type">boolean</span> <span class="function">isMachineTypeDefined</span>(<span class="type">short</span> type) {
    <span class="keyword">if</span> (type == IMAGE_FILE_MACHINE_UNKNOWN) {
        <span class="comment">// Unsupported machine type</span>
        <span class="keyword">return</span> <span class="literal">false</span>;
    }
    <span class="keyword">for</span> (<span class="type">Field</span> field : CoffMachineType.<span class="function">class</span>.<a href="#" class="standard-method function" onclick="openJavadocModal('https://docs.oracle.com/javase/8/docs/api/java/lang/Class.html#getDeclaredFields--')">getDeclaredFields</a>()) {
        <span class="keyword">if</span> (!field.<a href="#" class="standard-method function" onclick="openJavadocModal('https://docs.oracle.com/javase/8/docs/api/java/lang/reflect/Field.html#isSynthetic--')">isSynthetic</a>()) {
            <span class="type">int</span> modifiers = field.<a href="#" class="standard-method function" onclick="openJavadocModal('https://docs.oracle.com/javase/8/docs/api/java/lang/reflect/Field.html#getModifiers--')">getModifiers</a>();
            <span class="keyword">if</span> (<a href="#" class="standard-method function" onclick="openJavadocModal('https://docs.oracle.com/javase/8/docs/api/java/lang/reflect/Modifier.html#isFinal-int-')">Modifier.isFinal</a>(modifiers) && <a href="#" class="standard-method function" onclick="openJavadocModal('https://docs.oracle.com/javase/8/docs/api/java/lang/reflect/Modifier.html#isStatic-int-')">Modifier.isStatic</a>(modifiers)) {
                <span class="keyword">try</span> {
                    <span class="keyword">if</span> (field.<a href="#" class="standard-method function" onclick="openJavadocModal('https://docs.oracle.com/javase/8/docs/api/java/lang/reflect/Field.html#getShort-java.lang.Object-')">getShort</a>(<span class="literal">null</span>) == type) {
                        <span class="keyword">return</span> <span class="literal">true</span>;
                    }
                } <span class="keyword">catch</span> (<span class="type">IllegalAccessException</span> e) {
                    <span class="keyword">continue</span>;
                }
            }
        }
    }
    <span class="keyword">return</span> <span class="literal">false</span>;
}
`            
          },
          {
            id: 4,
            title: "Snippet 4",
code: `<span class="keyword">public static</span> <span class="type">int</span> <span class="function">indexOfIgnoreCase</span>(<span class="type">CharSequence</span> str, <span class="type">CharSequence</span> searchStr, <span class="type">int</span> startPos) {
    <span class="keyword">if</span> (str == <span class="literal">null</span> || searchStr == <span class="literal">null</span>) {
        <span class="keyword">return</span> INDEX_NOT_FOUND;
    }
    <span class="keyword">if</span> (startPos < <span class="number">0</span>) {
        startPos = <span class="number">0</span>;
    }
    <span class="type">int</span> searchStrLen = searchStr.<a href="#" class="standard-method function" onclick="openJavadocModal('https://docs.oracle.com/javase/8/docs/api/java/lang/CharSequence.html#length--')">length</a>();
    <span class="type">int</span> endLimit = str.<a href="#" class="standard-method function" onclick="openJavadocModal('https://docs.oracle.com/javase/8/docs/api/java/lang/CharSequence.html#length--')">length</a>() - searchStrLen + <span class="number">1</span>;
    <span class="keyword">if</span> (startPos > endLimit) {
        <span class="keyword">return</span> INDEX_NOT_FOUND;
    }
    <span class="keyword">if</span> (searchStrLen == <span class="number">0</span>) {
        <span class="keyword">return</span> startPos;
    }
    <span class="keyword">for</span> (<span class="type">int</span> i = startPos; i < endLimit; i++) {
        <span class="keyword">if</span> (<span class="function">regionMatches</span>(str, <span class="literal">true</span>, i, searchStr, <span class="number">0</span>, searchStrLen)) {
            <span class="keyword">return</span> i;
        }
    }
    <span class="keyword">return</span> INDEX_NOT_FOUND;
}`
          },              
          {
            id: 5,
            title: "Snippet 5",
            code: `
<span class="keyword">public static</span> <span class="type">boolean</span> <span class="function">deleteRecursively</span>(@Nullable <span class="type">Path</span> root) <span class="keyword">throws</span> <span class="type">IOException</span> {
    <span class="keyword">if</span> (root == <span class="literal">null</span>) <span class="keyword">return</span> <span class="literal">false</span>;
    <span class="keyword">if</span> (!<a href="#" class="standard-method function" onclick="openJavadocModal('https://docs.oracle.com/javase/8/docs/api/java/nio/file/Files.html#exists-java.nio.file.Path-java.nio.file.LinkOption...-')">Files.exists</a>(root)) <span class="keyword">return</span> <span class="literal">false</span>;

    <a href="#" class="standard-method function" onclick="openJavadocModal('https://docs.oracle.com/javase/8/docs/api/java/nio/file/Files.html#walkFileTree-java.nio.file.Path-java.nio.file.FileVisitor-')">Files.walkFileTree</a>(root, <span class="keyword">new</span> <span class="type">SimpleFileVisitor</span>&lt;&gt;() {
        @Override
        <span class="keyword">public</span> <span class="type">FileVisitResult</span> <span class="function">visitFile</span>(<span class="type">Path</span> file, <span class="type">BasicFileAttributes</span> attrs) <span class="keyword">throws</span> <span class="type">IOException</span> {
            <a href="#" class="standard-method function" onclick="openJavadocModal('https://docs.oracle.com/javase/8/docs/api/java/nio/file/Files.html#delete-java.nio.file.Path-')">Files.delete</a>(file);
            <span class="keyword">return</span> FileVisitResult.CONTINUE;
        }
        @Override
        <span class="keyword">public</span> <span class="type">FileVisitResult</span> <span class="function">postVisitDirectory</span>(<span class="type">Path</span> dir, <span class="type">IOException</span> exc) <span class="keyword">throws</span> <span class="type">IOException</span> {
            <a href="#" class="standard-method function" onclick="openJavadocModal('https://docs.oracle.com/javase/8/docs/api/java/nio/file/Files.html#delete-java.nio.file.Path-')">Files.delete</a>(dir);
            <span class="keyword">return</span> FileVisitResult.CONTINUE;
        }
    });

    <span class="keyword">return</span> <span class="literal">true</span>;
}
`            
      },
      {
        id: 6,
        title: "Snippet 6",
        code: `
<span class="keyword">public static</span> <span class="type">int</span> <span class="function">encodedLength</span>(<span class="type">CharSequence</span> sequence) {
    <span class="comment">// Optimized implementation</span>
    <span class="type">int</span> utf16Length = sequence.<a href="#" class="standard-method function" onclick="openJavadocModal('https://docs.oracle.com/javase/8/docs/api/java/lang/CharSequence.html#length--')">length</a>();
    <span class="type">int</span> utf8Length = utf16Length;
    <span class="type">int</span> i = <span class="number">0</span>;

    <span class="keyword">while</span> (i < utf16Length && sequence.<a href="#" class="standard-method function" onclick="openJavadocModal('https://docs.oracle.com/javase/8/docs/api/java/lang/CharSequence.html#charAt-int-')">charAt</a>(i) < <span class="literal">0x80</span>) {
        i++;
    }

    <span class="keyword">for</span> (; i < utf16Length; i++) {
        <span class="type">char</span> c = sequence.<a href="#" class="standard-method function" onclick="openJavadocModal('https://docs.oracle.com/javase/8/docs/api/java/lang/CharSequence.html#charAt-int-')">charAt</a>(i);
        <span class="keyword">if</span> (c < <span class="literal">0x800</span>) {
            utf8Length += ((<span class="literal">0x7f</span> - c) >>> <span class="number">31</span>);
        } <span class="keyword">else</span> {
            utf8Length += <span class="function">encodedLengthGeneral</span>(sequence, i);
            <span class="keyword">break</span>;
        }
    }

    <span class="keyword">if</span> (utf8Length < utf16Length) {
        <span class="keyword">throw new</span> <span class="type">IllegalArgumentException</span>(
            <span class="string">"UTF-8 length does not fit in int: "</span> + (utf8Length + (<span class="literal">1L</span> << <span class="number">32</span>)));
    }

    <span class="keyword">return</span> utf8Length;
}
`        
      },
      {
        id: 7,
        title: "Snippet 7",
        code: `
<span class="keyword">public static</span> <span class="type">float</span> <span class="function">lowestPositiveRoot</span>(<span class="type">float</span> a, <span class="type">float</span> b, <span class="type">float</span> c) {
    <span class="type">float</span> det = b * b - <span class="number">4</span> * a * c;
    <span class="keyword">if</span> (det < <span class="number">0</span>) <span class="keyword">return</span> <span class="type">Float</span>.NaN;

    <span class="type">float</span> sqrtD = (<span class="type">float</span>)<span class="type">Math</span>.<a href="#" class="standard-method function" onclick="openJavadocModal('https://docs.oracle.com/javase/8/docs/api/java/lang/Math.html#sqrt-double-')">sqrt</a>(det);
    <span class="type">float</span> invA = <span class="number">1</span> / (<span class="number">2</span> * a);
    <span class="type">float</span> r1 = (-b - sqrtD) * invA;
    <span class="type">float</span> r2 = (-b + sqrtD) * invA;

    <span class="keyword">if</span> (r1 > r2) {
        <span class="type">float</span> tmp = r2;
        r2 = r1;
        r1 = tmp;
    }

    <span class="keyword">if</span> (r1 > <span class="number">0</span>) <span class="keyword">return</span> r1;
    <span class="keyword">if</span> (r2 > <span class="number">0</span>) <span class="keyword">return</span> r2;
    <span class="keyword">return</span> <span class="type">Float</span>.NaN;
}
`        
      },
      {
        id: 8,
        title: "Snippet 8",
        code: `
<span class="keyword">public static</span> <span class="type">float</span> <span class="function">atan2</span>(<span class="type">float</span> y, <span class="type">float</span> x) {
    <span class="type">float</span> n = y / x;

    <span class="keyword">if</span> (n != n)
        n = (y == x ? <span class="number">1f</span> : <span class="number">-1f</span>);
    <span class="keyword">else if</span> (n - n != n - n)
        x = <span class="number">0f</span>;

    <span class="keyword">if</span> (x > <span class="number">0</span>)
        <span class="keyword">return</span> <span class="function">atanUnchecked</span>(n);
    <span class="keyword">else if</span> (x < <span class="number">0</span>) {
        <span class="keyword">if</span> (y >= <span class="number">0</span>) <span class="keyword">return</span> <span class="function">atanUnchecked</span>(n) + PI;
        <span class="keyword">return</span> <span class="function">atanUnchecked</span>(n) - PI;
    } <span class="keyword">else if</span> (y > <span class="number">0</span>)
        <span class="keyword">return</span> x + HALF_PI;
    <span class="keyword">else if</span> (y < <span class="number">0</span>)
        <span class="keyword">return</span> x - HALF_PI;

    <span class="keyword">return</span> x + y;
}
`        
      }
    ];
  

  function getStoredSnippetOrder() {
    const stored = sessionStorage.getItem('snippetOrder') || localStorage.getItem('snippetOrder');
    if (stored) {
      try {
        const parsed = JSON.parse(stored);
        if (Array.isArray(parsed) && parsed.length === 8) return parsed;
      } catch {}
    }
    return null;
  }

  // Apply the stored snippet order
  const order = getStoredSnippetOrder();
  const snippets = [];

  if (order) {
    order.forEach((index, newId) => {
      snippet = { ...originalSnippets[index - 1] }; 
      snippet.id = newId + 1;
      snippet.title = `Snippet ${newId + 1}`;
      snippets.push(snippet);
    });
  } else {
    alert("‚ö†Ô∏è Missing snippet order. Please login again.");
    window.location.href = '/';
  }

  console.log("Applied snippet order:", snippets.map(s => s.title));

</script>
<script>
  window.onload = () => {
      // remapSnippetReferences(participantRankings);
      // renderParticipantRankings();
      render();
      attachAutosaveListeners();
      loadCards();
      loadState();
      applyTheme();
      displayUserName();

    const continueBtn = document.getElementById('continueBtn');
    if (sessionStorage.getItem('round2-phase3-complete') === 'true' || localStorage.getItem('round2-phase2-complete') === 'true') {
      if (continueBtn) {
        continueBtn.style.display = 'inline-block';
        continueBtn.style.backgroundColor = '#4CAF50';
        continueBtn.style.animation = 'glowPulse 1.5s infinite alternate';
      }
    }

    // Unlock and highlight status bar
    if (isComplete('round2-phase1-complete')) document.getElementById('link-phase2').classList.remove('disabled');
    if (isComplete('round2-phase2-complete')) document.getElementById('link-phase3').classList.remove('disabled');
    if (isComplete('round2-phase3-complete')) document.getElementById('link-phase4').classList.remove('disabled');
    if (isComplete('round2-phase4-complete')) document.getElementById('link-phase5').classList.remove('disabled');
    if (isComplete('round2-phase5-complete')) document.getElementById('link-review').classList.remove('disabled');

    const current = window.location.pathname.split('/').pop();
    if (current.includes('phase1')) document.getElementById('link-phase1').classList.add('active');
    else if (current.includes('phase2')) document.getElementById('link-phase2').classList.add('active');
    else if (current.includes('phase3')) document.getElementById('link-phase3').classList.add('active');
    else if (current.includes('phase4')) document.getElementById('link-phase4').classList.add('active');
    else if (current.includes('phase5')) document.getElementById('link-phase5').classList.add('active');
    else if (current.includes('review')) document.getElementById('link-review').classList.add('active');

    if (sessionStorage.getItem('round2-phase3-complete') === 'true' || localStorage.getItem('round2-phase3-complete') === 'true') {
      document.getElementById('continueBtn').style.display = 'inline-block';
      document.getElementById('continueBtn').style.backgroundColor = '#4CAF50';
      document.getElementById('continueBtn').style.animation = 'glowPulse 1.5s infinite alternate';
    }

    setInterval(() => {
      try {
        saveToServer();
        console.log("[Auto-Save] Progress saved to server.");
      } catch (e) {
        console.warn("[Auto-Save] Failed to save:", e);
      }
    }, 120000); // every 2 minutes
  };

  function loadCards() {
    const container = document.getElementById('cards');
    snippets.forEach(snippet => {
      const card = document.createElement('div');
      card.className = 'card';
      card.draggable = true;
      card.id = `snippet-${snippet.id}`;
      card.innerHTML = `
          <strong>${snippet.title}</strong>
          <br><label><input type="checkbox" onchange="togglePreview(${snippet.id}, this)"> View</label>
        `;
      card.addEventListener('dragstart', () => card.classList.add('dragging'));
      card.addEventListener('dragend', () => card.classList.remove('dragging'));
      container.appendChild(card);
    });

    document.querySelectorAll('.ranking-slot').forEach(slot => {
      slot.addEventListener('dragover', e => {
        e.preventDefault();
        const dragging = document.querySelector('.dragging');
        if (dragging) slot.appendChild(dragging);
        saveState();
      });
    });
  }

  function togglePreview(id, checkbox) {
    const previewArea = document.getElementById('previewArea');
    const snippet = snippets.find(s => s.id === id);
    const existing = document.getElementById(`preview-${id}`);

    if (checkbox.checked && !existing) {
      const wrapper = document.createElement('div');
      wrapper.id = `preview-${id}`;
      wrapper.className = 'snippet-preview-box';

      const header = document.createElement('div');
      header.className = 'snippet-header';
      header.textContent = snippet.title;

      const codeBox = document.createElement('div');
      codeBox.className = 'code-box';
      codeBox.innerHTML = snippet.code;

      wrapper.appendChild(header);
      wrapper.appendChild(codeBox);
      previewArea.appendChild(wrapper);
    } else if (!checkbox.checked && existing) {
      previewArea.removeChild(existing);
    }
  }

  function saveState() {
    const positions = {};
    document.querySelectorAll('.ranking-slot').forEach((slot, index) => {
      positions[index + 1] = Array.from(slot.children).map(el => el.id);
    });
    const json = JSON.stringify(positions);
    sessionStorage.setItem('phase3_ranking', json);
    document.cookie = `phase3_ranking=${encodeURIComponent(json)}; path=/; max-age=${60 * 60 * 24 * 30}`;

    /* Check if the phase is completed */
    if (areAllDisagreementsAnswered()) {
      console.log("areAllDisagreementsAnswered4");
      document.getElementById('continueBtn').style.display = 'inline-block';
      document.getElementById('continueBtn').style.backgroundColor = '#4CAF50';
      document.getElementById('continueBtn').style.animation = 'glowPulse 1.5s infinite alternate';
      sessionStorage.setItem('round2-phase2-complete', 'true');
      document.cookie = `round2-phase2-complete=true; path=/; max-age=${60 * 60 * 24 * 30}`;

      // ‚úÖ Also update the status bar
      const phase4Link = document.getElementById('link-phase4');
      if (phase4Link) {
        phase4Link.classList.remove('disabled');
      }
    } else {
      sessionStorage.removeItem('phase2Complete');
      document.cookie = `phase2Complete=; path=/; max-age=0`;
      document.getElementById('continueBtn').style.display = 'none';
      const phase4Link = document.getElementById('link-phase4');
      if (phase4Link) {
        phase4Link.classList.add('disabled');
      }
    }

  }

  function loadState() {
    let saved = sessionStorage.getItem('phase3_ranking') || localStorage.getItem('phase3_ranking');


    if (!saved) return;

    try {
      const parsed = JSON.parse(saved);  // now valid JSON
      Object.entries(parsed).forEach(([rank, ids]) => {
        const slot = document.querySelector(`.ranking-slot[data-rank='${rank}']`);
        ids.forEach(id => {
          const el = document.getElementById(id);
          if (el && slot) slot.appendChild(el);
        });
      });
    } catch (e) {
      console.error('Failed to parse phase3_ranking JSON:', e);
    }
  }


  function toggleTheme() {
    const body = document.body;
    const isDark = body.classList.contains('dark-mode');

    if (isDark) {
      body.classList.remove('dark-mode');
      localStorage.setItem('codeTheme', 'light');
      document.getElementById('theme-toggle').textContent = 'Switch to Dark Mode';
    } else {
      body.classList.add('dark-mode');
      localStorage.setItem('codeTheme', 'dark');
      document.getElementById('theme-toggle').textContent = 'Switch to Light Mode';
    }
  }

  function applyTheme() {
    const theme = localStorage.getItem('codeTheme') || 'light';
    const btn = document.getElementById('theme-toggle');

    if (theme === 'dark') {
      document.body.classList.add('dark-mode');
      if (btn) btn.textContent = 'Switch to Light Mode';
    } else {
      document.body.classList.remove('dark-mode');
      if (btn) btn.textContent = 'Switch to Dark Mode';
    }
  }

  function goToPhase4() {
    const q1 = document.getElementById('q1').value.trim();
    const q2 = document.getElementById('q2').value.trim();
    const q3 = document.getElementById('q3').value.trim();

    if (!q1 || !q2 || !q3) {
        showValidationMessage("‚ö†Ô∏è Please answer all three questions before continuing.");
        return;
    }

    saveRound2Response(index, { q1, q2, q3 });
    next();
    if (areAllDisagreementsAnswered()) {
      location.href = '/round2-phase4.html';
    } else { showValidationMessage("‚ö†Ô∏è Please answer all questions") };
  }

  /*For the instructions section*/
  function toggleInstructions() {
    const content = document.getElementById("instructions-content");
    const button = event.target;

    if (content.style.display === "none") {
      content.style.display = "block";
      button.textContent = "Hide";
    } else {
      content.style.display = "none";
      button.textContent = "Show";
    }
  }

  function getLocalStorage(name) {
    const match = document.cookie.match(new RegExp('(^| )' + name + '=([^;]+)'));
    return match ? decodeURIComponent(match[2]) : null;
  }

  function isComplete(key) {
    return sessionStorage.getItem(key) === 'true' || localStorage.getItem(key) === 'true';
  }

  function areAllCardsRanked() {
    const allCards = document.querySelectorAll('.card');
    const assignedCardIds = new Set();

    document.querySelectorAll('.ranking-slot').forEach(slot => {
      slot.querySelectorAll('.card').forEach(card => {
        assignedCardIds.add(card.id);
      });
    });

    return allCards.length === assignedCardIds.size;
  }


</script>

<script>
  function displayUserName() {
    const name = sessionStorage.getItem('participantName') || localStorage.getItem('participantName');
    if (name) {
      document.getElementById('user-info').textContent = `üë§ ${name}`;
    }
  }
</script>

<script>
  function isLoggedIn() {
    const name = sessionStorage.getItem('participantName') || localStorage.getItem('participantName');
    const order = sessionStorage.getItem('snippetOrder') || localStorage.getItem('snippetOrder');
    return name && order;
  }

  function checkLogin() {
    if (!isLoggedIn()) {
      alert('You must be logged in to access this page. Redirecting to the homepage.');
      window.location.href = '/';
    }
  }

  function checkPhase1Completion() {
    if (!isPhaseComplete('round2-phase1-complete')) {
      alert('Please complete Phase 1 before continuing.');
      window.location.href = 'round2-phase1.html';
    }
  }

  function isPhaseComplete(phaseKey) {
    const sessionVal = sessionStorage.getItem(phaseKey);
    const cookieVal = localStorage.getItem(phaseKey);
    return sessionVal === 'true' || cookieVal === 'true';
  }

  window.addEventListener('load', checkLogin);
  window.addEventListener('load', checkPhase1Completion);
</script>


<script>
  // Toggle logout menu visibility
  // document.addEventListener('DOMContentLoaded', () => {
  //   const userInfo = document.getElementById('user-info');
  //   const logoutMenu = document.getElementById('logout-menu');

  //   userInfo.addEventListener('click', () => {
  //     logoutMenu.style.display = logoutMenu.style.display === 'block' ? 'none' : 'block';
  //   });

  //   // Hide the menu if clicked outside
  //   document.addEventListener('click', (event) => {
  //     if (!event.target.closest('.user-dropdown')) {
  //       logoutMenu.style.display = 'none';
  //     }
  //   });
  // });

  // Clear storage and redirect to login
  function logout() {
    sessionStorage.clear();
    localStorage.clear();


    // Clear all cookies
    document.cookie.split(";").forEach(cookie => {
      const name = cookie.split("=")[0].trim();
      document.cookie = `${name}=; expires=Thu, 01 Jan 1970 00:00:00 UTC; path=/;`;
    });

    window.location.href = 'round2.html';
  }
</script>

<script>
async function saveToServer() {
  const name = sessionStorage.getItem('participantName') || localStorage.getItem('participantName') || 'Anonymous';
  const username = localStorage.getItem('username') || 'anonymous';

  // Phase 1 data
  const phase1 = {};
  for (let i = 1; i <= 8; i++) {
    const summary = sessionStorage.getItem(`summary${i}`) || localStorage.getItem(`summary${i}`) || '';
    const comp = sessionStorage.getItem(`compSummary${i}`) || localStorage.getItem(`compSummary${i}`) || '';
    phase1[`snippet${i}`] = { summary, comprehensibility: comp };
  }

  // Phase 2 & 3 data
  let phase2 = {}, phase3 = {};
  try {
    phase2 = JSON.parse(sessionStorage.getItem('phase3_ranking') || localStorage.getItem('phase3_ranking') || '{}');
    phase3 = JSON.parse(sessionStorage.getItem('phase3_reasoning') || localStorage.getItem('phase3_reasoning') || '{}');
  } catch (e) {
    console.warn("‚ö†Ô∏è Error parsing phase2 or phase3 data", e);
  }

  // Round 2 responses
  const round2Responses = {};
  for (let i = 0; i <= 5; i++) {
    const key = `round2_response_${i}`;
    const val = localStorage.getItem(key) || sessionStorage.getItem(key);
    if (val) {
      try {
        round2Responses[key] = JSON.parse(val);
      } catch (e) {
        round2Responses[key] = val;
      }
    }
  }

  // Completion flags
  const phaseCompletion = {};
  for (let i = 1; i <= 5; i++) {
    const key = `round2-phase${i}-complete`;
    phaseCompletion[key] = sessionStorage.getItem(key) || localStorage.getItem(key) || 'false';
  }

  // Other flags
  const flags = {
    codeTheme: localStorage.getItem('codeTheme') || 'light',
    submitted: '0',
    studyRound: '2'
  };

  // Final payload
  const payload = {
    username,
    participantName: name,
    phase1,
    phase2,
    phase3,
    ...round2Responses,
    ...phaseCompletion,
    ...flags
  };

  const payloadStr = JSON.stringify(payload);

  // Hash function
  async function hashString(str) {
    const buffer = new TextEncoder().encode(str);
    const digest = await crypto.subtle.digest('SHA-256', buffer);
    return [...new Uint8Array(digest)].map(b => b.toString(16).padStart(2, '0')).join('');
  }

  const currentHash = await hashString(payloadStr);
  const previousHash = sessionStorage.getItem('lastPayloadHash_round2');

  if (currentHash === previousHash) {
    console.log('üü° Payload unchanged, not sending to server.');
    return;
  }

  sessionStorage.setItem('lastPayloadHash_round2', currentHash);

  const blob = new Blob([payloadStr], { type: 'application/json' });
  navigator.sendBeacon('/submit_round2', blob);

  console.log('‚úÖ Round 2 payload sent to server:', payload);
}


  window.addEventListener('beforeunload', function (e) {
    saveToServer();
  });


</script>

<script>
function remapSnippetReferences(rankings) {
  console.log('sessionStorage:', sessionStorage.getItem('snippetOrder'));
  console.log('cookie:', document.cookie);

  if (!Array.isArray(rankings)) {
    console.error('remapSnippetReferences: rankings is not a valid array.');
    return;
  }

  // Get snippet order from sessionStorage or cookies
  function getSnippetOrder() {
    const key = 'snippetOrder';
    const sessionValue = sessionStorage.getItem(key) || localStorage.getItem(key);
    if (sessionValue) return JSON.parse(sessionValue);

    const cookieMatch = document.cookie
      .split('; ')
      .find(row => row.startsWith(key + '='));
    if (cookieMatch) {
      const cookieValue = decodeURIComponent(cookieMatch.split('=')[1]);
      return JSON.parse(cookieValue);
    }
    return [];
  }

  const snippetOrder = getSnippetOrder();
  if (!Array.isArray(snippetOrder) || snippetOrder.length !== 8) {
    console.warn('Invalid or missing snippetOrder:', snippetOrder);
    return;
  }

  // Reverse mapping: actual snippet number ‚Üí new visual snippet #
  const map = {};
  for (let i = 0; i < 8; i++) {
    map[snippetOrder[i]] = i + 1;
  }

  rankings.forEach(participant => {
    let updated = participant.html;

    // Replace Snippet X (text label)
    updated = updated.replace(/\bSnippet (\d)\b/g, (_, num) => {
      const mapped = map[parseInt(num)];
      return `Snippet ${mapped}`;
    });

    // Replace show_snippet(X)
    updated = updated.replace(/show_snippet\((\d)\)/g, (_, num) => {
      const mapped = map[parseInt(num)];
      return `show_snippet(${mapped})`;
    });

    // Replace compare([X,...],[Y,...])
    updated = updated.replace(/compare\(\[([^\]]*)\],\s*\[([^\]]*)\]\)/g, (_, group1, group2) => {
      const mapGroup = g =>
        g.split(',')
         .map(x => {
           const trimmed = x.trim();
           return trimmed ? map[parseInt(trimmed)] : '';
         })
         .filter(x => x !== '')
         .join(',');
      return `compare([${mapGroup(group1)}], [${mapGroup(group2)}])`;
    });

    participant.html = updated;
  });
}


function renderParticipantRankings() {
  const container = document.querySelector('.phase-section');
  if (!container) {
    console.error('No .phase-section container found.');
    return;
  }

  container.innerHTML = ''; // Clear existing content

  const currentUser = (sessionStorage.getItem('username') || localStorage.getItem('username') || '').trim().toLowerCase();

  let yourHTML = '';
  const others = [];

  participantRankings.forEach(participant => {
    const participantName = participant.name.trim();
    const isCurrentUser = participantName.toLowerCase() === currentUser;

    const updatedHTML = participant.html.replace(
      new RegExp(`<h3>${participantName}</h3>`),
      `<h3>${isCurrentUser ? 'Your Ranking' : participantName}</h3>`
    );

    if (isCurrentUser) {
      yourHTML = updatedHTML;
    } else {
      others.push(updatedHTML);
    }
  });

  // Append your ranking first
  if (yourHTML) {
    const yourWrapper = document.createElement('div');
    yourWrapper.innerHTML = yourHTML;
    container.appendChild(yourWrapper);
  }

  // Append others
  others.forEach(html => {
    const wrapper = document.createElement('div');
    wrapper.innerHTML = html;
    container.appendChild(wrapper);
  });
}


</script>

<script>
      function show_snippet(id) {
        // id=id-1;
    const snippet = snippets.find(s => s.id === id);
    if (!snippet) return;

    document.getElementById('modal-snippet-title').innerText = snippet.title;

    const codeLines = snippet.code.trim().split('\n');

    // ‚úÖ Use innerHTML here to render styled spans correctly
    document.getElementById('modal-code-content').innerHTML = codeLines.join('\n');

    // ‚úÖ Line numbers are just plain numbers
    document.getElementById('modal-line-numbers').innerHTML = codeLines.map((_, i) => i + 1).join('<br>');

    document.getElementById('snippet-modal').style.display = 'block';

    applyModalTheme(); // Keep the theme consistent
    }

    
    function toggleModalTheme() {
      const body = document.body;
      const isLight = body.classList.contains("light-mode");
    
      if (isLight) {
        body.classList.remove("light-mode");
        body.classList.add("dark-mode");
        localStorage.setItem("codeTheme", "dark");
        document.getElementById('modal-theme-toggle').textContent = "Switch to Light Mode";
      } else {
        body.classList.remove("dark-mode");
        body.classList.add("light-mode");
        localStorage.setItem("codeTheme", "light");
        document.getElementById('modal-theme-toggle').textContent = "Switch to Dark Mode";
      }
    }
    
    function applyModalTheme() {
      const theme = localStorage.getItem('codeTheme') || 'light';
      document.body.classList.remove('light-mode', 'dark-mode');
      document.body.classList.add(theme + '-mode');
      document.getElementById('modal-theme-toggle').textContent =
        theme === 'light' ? "Switch to Dark Mode" : "Switch to Light Mode";
    }


</script>

<script>
      function compare(leftIds, rightIds) {
  const leftContainer = document.getElementById('compare-left');
  const rightContainer = document.getElementById('compare-right');
  leftContainer.innerHTML = '';
  rightContainer.innerHTML = '';

  const getSnippet = id => snippets.find(s => s.id === id);

  // Left side: stacked
  leftIds.forEach(id => {
    const snippet = getSnippet(id);
    if (snippet) {
      const box = document.createElement('div');
      box.className = 'snippet-box';
      box.innerHTML = `<h4>${snippet.title}</h4><pre class="code-content">${snippet.code}</pre>`;
      leftContainer.appendChild(box);
    }
  });

  // Right side: stacked
  rightIds.forEach(id => {
    const snippet = getSnippet(id);
    if (snippet) {
      const box = document.createElement('div');
      box.className = 'snippet-box';
      box.innerHTML = `<h4>${snippet.title}</h4><pre class="code-content">${snippet.code}</pre>`;
      rightContainer.appendChild(box);
    }
  });

  document.getElementById('compare-modal').style.display = 'block';
}
</script>

 <script>
const disagreements = [
{
  snippet: "isValidProjectName, isRemote",
  title: "Comparison-based disagreement: isValidProjectName vs. isRemote",
  text: `
<p>
  Experts largely consider <strong>isValidProjectName</strong> and <strong>isRemote</strong> among
  the easier methods in the set ‚Äî but they disagree on <em>which one is easier</em> and why.
  The debate centers on the role of <em>domain knowledge</em> and <em>redundancy of checks</em>.
</p>

<h4>isValidProjectName ‚Äî disagreement mainly on length & redundancy</h4>
<ul>
  <li>
    <strong>Experts A, B, and E</strong> ranked it in Position 1.
    <ul>
      <li>Expert A: ‚Äúsimple to understand‚Äù with very clear naming and a fully self-contained purpose.</li>
      <li>Expert B: ‚Äúvery self explanatory,‚Äù especially compared to <code>isRemote</code> which relies on URI semantics.</li>
      <li>Expert E: praised that ‚Äúeverything it does is right there in front of you,‚Äù no hidden helpers.</li>
    </ul>
  </li>

  <li>
    <strong>Expert C</strong> placed it slightly harder (Position 2),
    questioning why both alphanumeric and valid-character checks were needed and noting
    the bit of domain reasoning required.
  </li>

  <li>
    <strong>Expert D</strong> ranked it noticeably harder (Position 4),
    finding the long chain of validations less ‚Äúcompact‚Äù than their preferred style.
  </li>
</ul>

<h4>isRemote ‚Äî disagreement mainly on hidden knowledge & external behavior</h4>
<ul>
  <li>
    <strong>Experts A and D</strong> ranked it as one of the easiest (Position 1),
    praising its concise structure and clear conditional flow.
  </li>

  <li>
    <strong>Experts B, C, and E</strong> placed it at Position 2 instead:
    <ul>
      <li>Expert E: clear overall, but requires understanding URI schemes and <code>isFilesystemPath(uri)</code>.</li>
      <li>Expert B: evaluating ‚Äúlocal vs remote‚Äù is less straightforward than project-name validation.</li>
      <li>Expert C: domain knowledge needed to understand why <code>'file'</code> and <code>'jar'</code> differ from others.</li>
    </ul>
  </li>
</ul>

<p>
  <strong>Overall</strong>, the experts split into two camps:
</p>

<ul>
  <li>
    Those who prefer <strong>compact, structure-driven code</strong> ‚Üí
    rate <code>isRemote</code> easier and penalize <code>isValidProjectName</code> for length/repetition
    (Experts A, D).
  </li>
  <li>
    Those who prefer <strong>fully self-contained logic with minimal domain reliance</strong> ‚Üí
    rate <code>isValidProjectName</code> easier and see <code>isRemote</code> as slightly harder
    (Experts B, C, E).
  </li>
</ul>

<p>
  The disagreement highlights two competing views of what makes code easy:
  simplicity in <em>structure</em> versus simplicity in <em>domain assumptions</em>.
</p>
`
},


{
  snippet: "isMachineTypeDefined",
  text: `
<p>
  <strong>isMachineTypeDefined</strong> is one of the most divisive methods, with experts placing it
  anywhere from near-easy to the hardest in the set.
</p>

<ul>
  <li>
    <strong>Expert D</strong> placed <code>isMachineTypeDefined</code> toward the easy side at Position 2.
    <ul>
      <li>
        They described it as ‚Äúclear, concise,‚Äù praising how reflection is used in a straightforward
        way to iterate over constants and check for a match. Even though reflection requires some
        prior knowledge, they felt the intent remained easy to follow.
      </li>
    </ul>
  </li>

  <li>
    <strong>Expert C</strong> placed it in Position 3.
    <ul>
      <li>
        They said the control flow is understandable but expressed uncertainty about what each field
        represents and what <code>isSynthetic</code> is doing. They noted that the method ‚Äúrequires
        business knowledge about the domain,‚Äù and that using reflection to inspect declared fields
        is ‚Äúadvanced Java stuff that is not very common.‚Äù
      </li>
    </ul>
  </li>

  <li>
    <strong>Expert A</strong> placed it in Position 4.
    <ul>
      <li>
        They wrote that the method is ‚Äúsimple to comprehend for someone familiar with reflection‚Äù
        but still requires specific API knowledge. They viewed it similarly to
        <code>deleteRecursively</code> in terms of difficulty and noted that both methods require
        more contextual knowledge than the simplest ones like <code>isValidProjectName</code>.
      </li>
    </ul>
  </li>

  <li>
    <strong>Expert E</strong> placed it significantly harder, at Position 6.
    <ul>
      <li>
        They explained that although the reflective loop is recognizable once you see that it's
        iterating over constants, the method still relies on understanding modifiers, synthetic vs
        non-synthetic fields, and why reflection is being used at all. They consistently judged it
        harder than more linear, mathematical methods like <code>lowestPositiveRoot</code>.
      </li>
    </ul>
  </li>

  <li>
    <strong>Expert B</strong> placed <code>isMachineTypeDefined</code> at the extreme hard end
    (Position 8).
    <ul>
      <li>
        They called it ‚Äúdifficult to comprehend,‚Äù arguing that the name implies a general
        MachineType check, yet the implementation is tied specifically to
        <code>CoffMachineType</code>. They also noted that one path always triggers a null-pointer
        exception. They grouped it with <code>encodedLength</code> and <code>atan2</code> as ‚Äúhacky
        or cryptic‚Äù functions full of hidden assumptions and errors requiring significant ‚Äúmental
        debugging.‚Äù
      </li>
    </ul>
  </li>
</ul>

<p>
  <strong>Overall</strong>, experts disagreed sharply depending on how comfortable they are with
  reflection, how much domain context they inferred or expected, and how they assessed the clarity
  and intention behind the method‚Äôs structure.
</p>
`
},


 {
  snippet: "indexOfIgnoreCase",
  text: `
<p>
  <strong>indexOfIgnoreCase</strong> shows varied difficulty assessments, with experts split
  between viewing it as one of the easiest methods and placing it solidly in the mid-range.
</p>

<ul>
  <li>
    <strong>Expert C</strong> placed <code>indexOfIgnoreCase</code> in Position 1.
    <ul>
      <li>
        They said it ‚Äúflowed very naturally,‚Äù with each condition playing an obvious role in the
        search logic. They grouped it with <code>deleteRecursively</code>, explaining that both
        methods can be followed line by line, with meaningful variable names and straightforward
        logic.
      </li>
    </ul>
  </li>

  <li>
    <strong>Experts E and D</strong> placed <code>indexOfIgnoreCase</code> in Position 3.
    <ul>
      <li>
        <strong>Expert E</strong> emphasized that the method's control flow is clear and the
        earlier return checks are intuitive. They also contrasted it with more complicated methods
        such as reflection-based ones or UTF-8 encoding, noting that
        <code>indexOfIgnoreCase</code> is fully self-contained.
      </li>
      <li>
        <strong>Expert D</strong> described it as structurally clear and readable, though more
        complex than the very simplest methods.
      </li>
    </ul>
  </li>

  <li>
    <strong>Experts A and B</strong> placed it at Position 5.
    <ul>
      <li>
        <strong>Expert A</strong> acknowledged that the implementation is generally expected but
        pointed out naming issues (e.g., ‚Äústr,‚Äù ‚ÄúendLimit‚Äù), saying these reduce readability. They
        felt this pushes the method slightly harder than some reflection-based ones because the
        naming obscures intent.
      </li>
      <li>
        <strong>Expert B</strong> called the method ‚Äúok‚Äù but noted that the number of intermediate
        values and the hand-rolled search logic makes it less transparent than shorter, simpler
        methods. They said <code>deleteRecursively</code> is easier to follow once one ignores its
        misleading name, and they argued that <code>lowestPositiveRoot</code> can be easier than
        <code>indexOfIgnoreCase</code> because the latter is ‚Äúreinventing the wheel‚Äù instead of
        using built-in substring operations.
      </li>
    </ul>
  </li>
</ul>

<p>
  <strong>Overall</strong>, <code>indexOfIgnoreCase</code> is a clear point of disagreement about
  what counts as truly easy code: some see it as a straightforward implementation of string search,
  while others find its naming, intermediate variables, and reinvention of built-in functionality
  enough to place it in a more effortful mid-range tier.
</p>
`
},

 {
  snippet: "lowestPositiveRoot",
  text: `
<p>
  <strong>lowestPositiveRoot</strong> shows disagreement about how much mathematical familiarity
  should influence perceived difficulty.
</p>

<ul>
  <li>
    <strong>Expert B</strong> placed <code>lowestPositiveRoot</code> in Position 4.
    <ul>
      <li>
        They described the method as ‚Äúalright,‚Äù explaining that implementing a well-known quadratic
        formula makes it easier to follow than methods like <code>indexOfIgnoreCase</code>. Although
        variable names like ‚Äúdet‚Äù and ‚Äúinv‚Äù are not ideal, the mathematical structure is familiar.
      </li>
    </ul>
  </li>

  <li>
    <strong>Expert E</strong> placed it in Position 5.
    <ul>
      <li>
        They noted that once you recognize the flow as a direct translation of how one solves a
        quadratic equation by hand, the logic becomes easy to track. Still, they acknowledged it
        requires some mathematical background. They contrasted it with reflection-heavy methods,
        saying <code>lowestPositiveRoot</code> has a linear and self-contained structure.
      </li>
    </ul>
  </li>

  <li>
    <strong>Experts A, C, and D</strong> all placed <code>lowestPositiveRoot</code> at Position 7.
    <ul>
      <li>
        <strong>Expert A</strong> wrote ‚ÄúNot good,‚Äù highlighting that it requires previous
        knowledge of the quadratic formula and that abbreviated names like ‚Äúdet,‚Äù ‚ÄúsqrtD,‚Äù ‚ÄúinvA,‚Äù
        ‚Äúr1,‚Äù and ‚Äúr2‚Äù provide no clarity to someone unfamiliar with the math involved.
      </li>
      <li>
        <strong>Expert C</strong> said they were ‚Äúnot familiar enough‚Äù with the abbreviations and
        felt uncertain about the purpose of swapping the roots. They compared it unfavorably to
        <code>encodedLength</code>, saying <code>lowestPositiveRoot</code> involves ‚Äúeven more
        complicated math.‚Äù
      </li>
      <li>
        <strong>Expert D</strong> similarly argued that the unclear variable names and reliance on
        unannotated mathematical steps make the method ‚Äúquite difficult to understand,‚Äù even though
        the underlying idea is just the quadratic formula.
      </li>
    </ul>
  </li>
</ul>

<p>
  <strong>Overall</strong>, <code>lowestPositiveRoot</code> ranges from moderately complex to one
  of the hardest methods, depending on the expert's mathematical comfort level, expectations about
  naming clarity, and tolerance for compact representations of formulas.
</p>
`
},


 {
  snippet: "atan2",
  text: `
<p>
  <strong>atan2</strong> is part of the most contested hardest cluster, with experts sharply
  divided on its difficulty.
</p>

<ul>
  <li>
    <strong>Experts A and B</strong> placed <code>atan2</code> in Position 8.
    <ul>
      <li>
        <strong>Expert A</strong> said that even though names like ‚Äúatan‚Äù and ‚ÄúHALF_PI‚Äù hint at
        trigonometry, ‚Äúneither the method name nor the local variables shed any light on the
        purpose of the method.‚Äù They described it as ‚Äúciphered,‚Äù understandable only with prior
        mathematical knowledge, and criticized its use of magic numbers. They also compared it to
        <code>encodedLength</code>, arguing that both methods fail to convey their purpose clearly.
      </li>
      <li>
        <strong>Expert B</strong> called the method ‚Äúterrible,‚Äù noting that one of the early
        branches seems to do nothing and that the final return value does not align with what one
        expects from an atan2-style computation. They grouped it with
        <code>encodedLength</code> and <code>isMachineTypeDefined</code> as methods that are ‚Äúhacky
        or cryptic,‚Äù containing errors or confusing design choices that require heavy mental
        debugging.
      </li>
    </ul>
  </li>

  <li>
    <strong>Expert E</strong> also placed <code>atan2</code> in Position 8.
    <ul>
      <li>
        They said understanding it requires reasoning about numerical methods and trigonometry.
        They contrasted it with <code>encodedLength</code>, saying that even though the UTF-8 code
        uses tricky bit-level logic, it still has an overall logical structure, whereas
        <code>atan2</code> has a much less intuitive flow. They highlighted unusual constructs like
        <code>n != n</code> for NaN detection and quadrant-dependent arithmetic like
        <code>x + HALF_PI</code>, which require reconstructing the intended behavior.
      </li>
    </ul>
  </li>

  <li>
    <strong>Experts C and D</strong> placed <code>atan2</code> in Position 6.
    <ul>
      <li>
        <strong>Expert C</strong> criticized the extremely short variable names (‚Äúx,‚Äù ‚Äúy,‚Äù ‚Äún‚Äù) and
        said the early if/else block adjusts values in edge cases without making the purpose clear.
        They said that at least in <code>isMachineTypeDefined</code> they could infer some logic
        from the name, whereas <code>atan2</code> requires specific mathematical or library context.
        However, they still found it slightly easier than <code>encodedLength</code>, which they
        described as involving unfamiliar bitwise and UTF-8 concepts.
      </li>
      <li>
        <strong>Expert D</strong> said the overall intention is broadly understandable, but the
        cryptic naming, lack of braces, and complex control flow make the method harder to parse.
        They placed it above the most cryptic low-level encoding code but still within the harder
        tier.
      </li>
    </ul>
  </li>
</ul>

<p>
  These differences show that some experts viewed <code>atan2</code> as opaque without strong
  numerical-method and trigonometry background, while others judged it slightly more accessible
  than the trickiest low-level encoding logic but still difficult due to its unconventional flow,
  naming, and mathematical assumptions.
</p>
`
}
];

  const snippetMap = {
  1: "isValidProjectName",
  2: "isRemote",
  3: "isMachineTypeDefined",
  4: "indexOfIgnoreCase",
  5: "deleteRecursively",
  6: "encodedLength",
  7: "lowestPositiveRoot",
  8: "atan2"
};

function linkifySnippets(text) {
  for (const [id, name] of Object.entries(snippetMap)) {
    const pattern = new RegExp(`\\b${name}\\b`, "g");   // whole word match
    const replacement = `<a onclick="show_snippet(${id})">${name}</a>`;
    text = text.replace(pattern, replacement);
  }
  return text;
}

disagreements.forEach(d => {
  d.text = linkifySnippets(d.text);
});


    const username = localStorage.getItem("username") || "anonymous";
    const snippetOrder = JSON.parse(sessionStorage.getItem('snippetOrder') || localStorage.getItem('snippetOrder') || '[]');

    let index = 0;

    function personalizeText(text, originalSnippetNumber) {
      const dynamicSnippetNum = snippetOrder ? snippetOrder.indexOf(originalSnippetNumber) + 1 : originalSnippetNumber;
      return text
        .replaceAll(`Snippet ${originalSnippetNumber}`, `Snippet ${dynamicSnippetNum}`)
        .replace(/\b(Oscar|Martin|Nadeeshan)\b/g, name => name.toLowerCase() === username.toLowerCase() ? `${name} (you)` : name);
    }


    const round2Responses = disagreements.map((_, i) => {
    const key = `round2_response_${i}`;
    const raw = sessionStorage.getItem(key) || localStorage.getItem(key);
    try {
        return raw ? JSON.parse(raw) : {};
    } catch {
        return {};
    }
    });



function personalize(text, username, snippetMap) {
    // console.log("üîç Initial text:", text);
    // console.log("üë§ Username:", username);
    // console.log("üß≠ Snippet map (original ‚ûù local):", snippetMap);

    // Replace expert name with "you"
    ['Oscar', 'Martin', 'Nadeeshan'].forEach(name => {
      const regex = new RegExp(`\\b${name}\\b`, 'g');
      if (username.toLowerCase() === name.toLowerCase()) {
        console.log(`üë§ Replacing name '${name}' with '${name} (you)'`);
        text = text.replace(regex, `${name} (you)`);
      }
    });


    // Replace all "Snippet X (functionName)" and "Snippet X" in one pass
    text = text.replace(/Snippet (\d+)(?: \((.*?)\))?/g, (match, origId, funcName) => {
        const originalId = parseInt(origId);
        const localId = snippetMap[originalId];

        if (!localId) {
            console.warn(`‚ö†Ô∏è Unknown original snippet: ${originalId}`);
            return match;
        }

        const link = `<a href="javascript:void(0)" onclick="show_snippet(${localId})">Snippet ${localId}</a>`;
        const result = funcName ? `${link} (${funcName})` : link;
        // console.log(`üîÅ ${match} ‚ûù ${result}`);
        return result;
    });

    // console.log("‚úÖ Final personalized text:", text);
    return text;
}



    function getLocalSnippetMapping() {
        const stored = sessionStorage.getItem('snippetOrder') || localStorage.getItem('snippetOrder');
        if (!stored) return null;

        try {
            const parsed = JSON.parse(stored); // e.g., [3,1,4,7,8,2,6,5]
            const mapping = {};
            parsed.forEach((originalId, localIndex) => {
            mapping[originalId] = localIndex + 1; // original ID -> local snippet number
            });
            return mapping;
        } catch (e) {
            console.error("Failed to parse snippetOrder:", e);
            return null;
        }
    }

function markCurrentUserName(text, username) {
  return text.replace(/\b(Oscar|Martin|Nadeeshan)\b/g, name =>
    name.toLowerCase() === username.toLowerCase() ? `${name} (you)` : name
  );
}

    function getRound2Response(i) {
        const key = `round2_response_${i}`;
        const raw = sessionStorage.getItem(key) || localStorage.getItem(key);
        try {
            return raw ? JSON.parse(raw) : {};
        } catch {
            return {};
        }
    }


    function render() {
    const container = document.getElementById('disagreement-box');
    const entry = disagreements[index];
    const localSnippets = getLocalSnippetMapping();
    const username = sessionStorage.getItem('username') || localStorage.getItem('username') || 'anonymous';

    // ‚ñë‚ñë‚ñë NEW HEADER FORMAT ‚ñë‚ñë‚ñë
    const heading = entry.title
        ? `Disagreement ${index + 1}: ${entry.title}`
        : `Disagreement ${index + 1}`;

    container.innerHTML = `
        <h3 style="margin-bottom: 10px;">${heading}</h3>
        <div class="disagreement-text" style="margin-bottom: 20px;">
            ${personalize(entry.text, username, localSnippets)}
        </div>
    `;

        const questionsContainer = document.getElementById('question-box');

        questionsContainer.innerHTML = `
          <div>
            <label><strong>1. Do any of your fellow experts' concerns resonate with you?</strong></label><br>
            <textarea id="q1" placeholder="Your response..."></textarea>
          </div>

          <div>
            <label><strong>2. Has their feedback changed or clarified your understanding of the snippet?</strong></label><br>
            <textarea id="q2" placeholder="Your response..."></textarea>
          </div>

          <div>
            <label><strong>3. Would you consider changing your ranking for this snippet after reviewing all the feedback?</strong></label><br>
            <textarea id="q3" placeholder="Your response..."></textarea>
          </div>
        `;


        // Restore saved answers
        const saved = getRound2Response(index);
        document.getElementById('q1').value = saved.q1 || '';
        document.getElementById('q2').value = saved.q2 || '';
        document.getElementById('q3').value = saved.q3 || '';

        // ‚úÖ Show/hide previous button
        // document.getElementById('prevBtn').style.display = index === 0 ? 'none' : 'inline-block';


          const nextBtn = document.getElementById("nextBtn");
          if (index === disagreements.length - 1) {
              nextBtn.disabled = true;
              nextBtn.innerText = "Done"; // optional
              if(areAllDisagreementsAnswered){
                  sessionStorage.setItem("round2-phase3-complete","true");
                  localStorage.setItem("round2-phase3-complete","true");
                  console.log("areAllDisagreementsAnswered3");
                  const continueBtn = document.getElementById('continueBtn');
                  continueBtn.style.display = 'inline-block';
                  continueBtn.style.backgroundColor = '#4CAF50';
                  continueBtn.style.animation = 'glowPulse 1.5s infinite alternate';
                  const phase4Link = document.getElementById('link-phase4');
                  if (phase4Link) {
                    phase4Link.classList.remove('disabled');
                  }
              } else{
                  sessionStorage.setItem("round2-phase3-complete","false");
                  localStorage.setItem("round2-phase3-complete","false");
              }
          } else {
              nextBtn.disabled = false;
              nextBtn.innerText = "Next"; // optional
          }

        const prevBtn = document.getElementById("prevBtn");
        prevBtn.disabled = index === 0;
        // prevBtn.style.display = index === 0 ? 'none' : 'inline-block';

    }




    function next() {
        const q1 = document.getElementById('q1').value.trim();
        const q2 = document.getElementById('q2').value.trim();
        const q3 = document.getElementById('q3').value.trim();

        if (!q1 || !q2 || !q3) {
            showValidationMessage("‚ö†Ô∏è Please answer all three questions before continuing.");
            return;
        }

        saveRound2Response(index, { q1, q2, q3 });

        if (index < disagreements.length - 1) {
            index++;
            render();
        } else {
            window.location.href = 'round2-phase4.html';
        }
        const el = document.getElementById('disagreement-box');
        const top = el.getBoundingClientRect().top + window.scrollY - 300;

        window.scrollTo({ top, behavior: 'smooth' });
      }


    function prev() {
        const q1 = document.getElementById('q1').value.trim();
        const q2 = document.getElementById('q2').value.trim();
        const q3 = document.getElementById('q3').value.trim();

        // Save current responses before moving back
        saveRound2Response(index, { q1, q2, q3 });

        if (index > 0) {
            index--;
            render();
        }
        const el = document.getElementById('disagreement-box');
        const top = el.getBoundingClientRect().top + window.scrollY - 300;

        window.scrollTo({ top, behavior: 'smooth' });
    }



  </script>
  <script>
    function saveRound2Response(stepIndex, responseObj) {
        const key = `round2_response_${stepIndex}`;
        const json = JSON.stringify(responseObj);

        sessionStorage.setItem(key, json);
        // document.cookie = `${key}=${encodeURIComponent(json)}; path=/; max-age=${60 * 60 * 24 * 30}`;
        localStorage.setItem(key,json);
    }
  </script>

  <script>

// Debounce utility
function debounce(fn, delay = 1000) {
  let timeoutId;
  return (...args) => {
    clearTimeout(timeoutId);
    timeoutId = setTimeout(() => fn(...args), delay);
  };
}

// Create the debounced version once
const debouncedSaveToServer = debounce(saveToServer, 1000);

// Attach autosave listeners
function attachAutosaveListeners() {
  ['q1', 'q2', 'q3'].forEach(id => {
    const textarea = document.getElementById(id);
    if (textarea) {
      textarea.addEventListener('input', () => {
        const q1 = document.getElementById('q1').value.trim();
        const q2 = document.getElementById('q2').value.trim();
        const q3 = document.getElementById('q3').value.trim();

        saveRound2Response(index, { q1, q2, q3 });
        debouncedSaveToServer(); // ‚úÖ debounced save
      });
    } else {
      console.warn(`‚ùó Missing textarea: #${id}`);
    }
  });
}




  </script>

<script>
    function showValidationMessage(msg) {
      alert(msg); // You can replace this with a styled modal if you prefer
    }
</script>
  
<script>
      function loadCards() {
      const container = document.getElementById('cards');
      snippets.forEach(snippet => {
        const card = document.createElement('div');
        card.className = 'card';
        card.draggable = true;
        card.id = `snippet-${snippet.id}`;
        card.innerHTML = `
          <strong>${snippet.title}</strong>
          <br><label><input type="checkbox" onchange="togglePreview(${snippet.id}, this)"> View</label>
        `;
        card.addEventListener('dragstart', () => card.classList.add('dragging'));
        card.addEventListener('dragend', () => card.classList.remove('dragging'));
        container.appendChild(card);
      });

      document.querySelectorAll('.ranking-slot').forEach(slot => {
        slot.addEventListener('dragover', e => {
          e.preventDefault();
          const dragging = document.querySelector('.dragging');
          if (dragging) slot.appendChild(dragging);
          saveState();
        });
      });
    }

    function loadState() {
      let saved = sessionStorage.getItem('phase3_ranking') || localStorage.getItem("phase3_ranking");

      if (!saved) {
        const cookieMatch = document.cookie.match(/(?:^|; )phase3_ranking=([^;]*)/);
        if (cookieMatch) {
          saved = decodeURIComponent(cookieMatch[1]);  // ‚úÖ decode before parsing
          sessionStorage.setItem('phase3_ranking', saved);
        }
      }

      if (!saved) return;

      try {
        const parsed = JSON.parse(saved);  // now valid JSON
        Object.entries(parsed).forEach(([rank, ids]) => {
          const slot = document.querySelector(`.ranking-slot[data-rank='${rank}']`);
          ids.forEach(id => {
            const el = document.getElementById(id);
            if (el && slot) slot.appendChild(el);
          });
        });
      } catch (e) {
        console.error('Failed to parse phase3_ranking JSON:', e);
      }
    } 

    function areAllDisagreementsAnswered() {
              const q1 = document.getElementById('q1').value.trim();
        const q2 = document.getElementById('q2').value.trim();
        const q3 = document.getElementById('q3').value.trim();

        if (!q1 || !q2 || !q3) {
            // showValidationMessage("‚ö†Ô∏è Please answer all three questions before continuing.");
            return;
        }
  for (let i = 0; i < disagreements.length; i++) {
    const key = `round2_response_${i}`;
    const dataStr = sessionStorage.getItem(key) || localStorage.getItem(key);

    if (!dataStr) return false;

    try {
      const data = JSON.parse(dataStr);
      const q1 = data.q1?.trim();
      const q2 = data.q2?.trim();
      const q3 = data.q3?.trim();

      if (!q1 || !q2 || !q3) return false;
    } catch (e) {
      console.warn(`Invalid JSON for key ${key}`);
      return false;
    }
  }
  return true;
}

</script>

<script>
      function saveState() {
      const positions = {};
      document.querySelectorAll('.ranking-slot').forEach((slot, index) => {
        positions[index + 1] = Array.from(slot.children).map(el => el.id);
      });
      const json = JSON.stringify(positions);
      sessionStorage.setItem('phase3_ranking', json);
      document.cookie = `phase3_ranking=${encodeURIComponent(json)}; path=/; max-age=${60 * 60 * 24 * 30}`;

      /* Check if the phase is completed */
      if (areAllDisagreementsAnswered()) {
        console.log("areAllDisagreementsAnswered6");
        document.getElementById('continueBtn').style.display = 'inline-block';
        document.getElementById('continueBtn').style.backgroundColor = '#4CAF50';
        document.getElementById('continueBtn').style.animation = 'glowPulse 1.5s infinite alternate';
        sessionStorage.setItem('round2-phase2-complete', 'true');
        document.cookie = `round2-phase2-complete=true; path=/; max-age=${60 * 60 * 24 * 30}`;

        // ‚úÖ Also update the status bar
        const phase3Link = document.getElementById('link-phase3');
        if (phase3Link) {
          phase3Link.classList.remove('disabled');
        }
      } else {
        sessionStorage.removeItem('phase2Complete');
        document.cookie = `phase2Complete=; path=/; max-age=0`;
        document.getElementById('continueBtn').style.display = 'none';
        const phase3Link = document.getElementById('link-phase3');
        if (phase3Link) {
          phase3Link.classList.add('disabled');
        }
      }

    }
</script>

<script>
      function show_snippet(id) {
    const snippet = originalSnippets.find(s => s.id === id);
    if (!snippet) return;

    document.getElementById('modal-snippet-title').innerText = snippet.title;

    const codeLines = snippet.code.trim().split('\n');

    // ‚úÖ Use innerHTML here to render styled spans correctly
    document.getElementById('modal-code-content').innerHTML = codeLines.join('\n');

    // ‚úÖ Line numbers are just plain numbers
    document.getElementById('modal-line-numbers').innerHTML = codeLines.map((_, i) => i + 1).join('<br>');

    document.getElementById('snippet-modal').style.display = 'block';

    applyModalTheme(); // Keep the theme consistent
    }

    
    function toggleModalTheme() {
      const body = document.body;
      const isLight = body.classList.contains("light-mode");
    
      if (isLight) {
        body.classList.remove("light-mode");
        body.classList.add("dark-mode");
        localStorage.setItem("codeTheme", "dark");
        document.getElementById('modal-theme-toggle').textContent = "Switch to Light Mode";
      } else {
        body.classList.remove("dark-mode");
        body.classList.add("light-mode");
        localStorage.setItem("codeTheme", "light");
        document.getElementById('modal-theme-toggle').textContent = "Switch to Dark Mode";
      }
    }
    
    function applyModalTheme() {
      const theme = localStorage.getItem('codeTheme') || 'light';
      document.body.classList.remove('light-mode', 'dark-mode');
      document.body.classList.add(theme + '-mode');
      document.getElementById('modal-theme-toggle').textContent =
        theme === 'light' ? "Switch to Dark Mode" : "Switch to Light Mode";
    }
</script>

<script>
window.addEventListener('DOMContentLoaded', () => {
  const section = document.getElementById('phase-section-content');
  const handle = document.getElementById('phase2-resize-handle');

  if (!section || !handle) {
    console.warn("Resizable elements not found");
    return;
  }

  const savedHeight = localStorage.getItem('phaseSectionHeight');
  if (savedHeight) section.style.height = savedHeight;

  let isResizing = false;

  handle.addEventListener('mousedown', () => {
    isResizing = true;
    document.body.style.cursor = 'ns-resize';
  });

  document.addEventListener('mousemove', (e) => {
    if (!isResizing) return;

    const newHeight = e.clientY - section.getBoundingClientRect().top;
    const clampedHeight = Math.max(newHeight, 50);
    section.style.height = clampedHeight + 'px';
    localStorage.setItem('phaseSectionHeight', section.style.height);
  });

  document.addEventListener('mouseup', () => {
    isResizing = false;
    document.body.style.cursor = '';
  });
});

</script>

<script>
window.addEventListener('scroll', function () {
  const el = document.getElementById('scroll-trigger-element');
  const content = document.getElementById("instructions-content");
  const button = document.getElementById("instructions-content-btn");
  const contentRanking = document.getElementById('phase-section-content');

  if (window.scrollY >= 200) {
    el.classList.add('visible');
    // content.style.display = "none";
    // button.textContent = "Show";
  }

  if (window.scrollY >= 70) {
    el.classList.add('visible');
    // content.style.display = "none";
    // button.textContent = "Show";
  } else if (window.getComputedStyle(contentRanking).display === "none") {
    el.classList.remove('visible');
  }
});

</script>

<script>

function togglePhaseSection() {
  const section = document.getElementById('phase-section-content');
  const handle = document.getElementById('phase2-resize-handle');
  const button = document.querySelector('.toggle-btn');

  // Correct way when default is visible (CSS: display:block)
  const isVisible = getComputedStyle(section).display !== 'none';

  // Toggle
  section.style.display = isVisible ? 'none' : 'block';
  handle.style.display = isVisible ? 'none' : 'block';

  // Adjust page layout
  const phaseBar = document.querySelector('.phase-bar');
  const body = document.body;
  setTimeout(() => {
    const extraHeight = phaseBar.offsetHeight;
    body.style.marginTop = `${extraHeight + 50}px`;
  }, 0);

  // Button label
  button.textContent = isVisible ? 'Show' : 'Hide';
}




</script>

<script>document.addEventListener("DOMContentLoaded", function () {
    const username = localStorage.getItem("username"); // e.g., "expertC"
    if (!username) return;

    const container = document.querySelector("#phase-section-content");
    if (!container) return;

    const sections = Array.from(container.querySelectorAll(".participant-section"));
    const match = sections.find(sec => {
        const strong = sec.querySelector("strong");
        return strong && strong.textContent.trim().toLowerCase() === username.trim().toLowerCase();
    });

    if (match) {
        // Move this participant-section to the top
        container.prepend(match);

        // Update its title: "expertC" -> "expertC (you)"
        const strong = match.querySelector("strong");
        if (strong) {
            const current = strong.textContent.trim();
            // avoid duplicating "(you)" if already present
            if (!/\(you\)/i.test(current)) {
                strong.textContent = current + " (you)";
            }
        }
    }
});
</script>

<footer
  style="margin-top: 40px; padding-top: 20px; border-top: 1px solid #ccc; text-align: center; font-size: 14px; color: #666;">
  Please contact us if you have any questions or issues: <a href="mailto:ea442@njit.edu">ea442@njit.edu</a>
</footer>
</body>
</html>
